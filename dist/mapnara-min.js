!function(){"use strict";function t(t,e,i){this.layer=t,this.tilePoint=e,this.zoom=i,this.gmx=t._gmx,this.tKey=e.x+":"+e.y,this.zKey=i+":"+this.tKey;var n=u;this.worldWidthMerc=n.worldWidthMerc;var o=n.getTileNumFromLeaflet(e,i);this.tbounds=n.getTileBounds(o.x,o.y,o.z),this.tpx=256*o.x,this.tpy=256*(1+o.y),this.gmxTilePoint=o,this.showRaster="rasterBGfunc"in t._gmx&&i>=t._gmx.minZoomRasters,this.rasters={},this.currentDrawDef=null,t._gmx.badTiles=t._gmx.badTiles||{}}!function(t,e,i){var n=t.L,o={};o.version="0.7.3","object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd&&define(o),o.noConflict=function(){return t.L=n,this},t.L=o,o.Util={extend:function(t){var e,i,n,o,r=Array.prototype.slice.call(arguments,1);for(i=0,n=r.length;n>i;i++){o=r[i]||{};for(e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),invokeEach:function(t,e,i){var n,o;if("object"==typeof t){o=Array.prototype.slice.call(arguments,3);for(n in t)e.apply(i,[n,t[n]].concat(o));return!0}return!1},limitExecByInterval:function(t,e,i){var n,o;return function r(){var s=arguments;return n?void(o=!0):(n=!0,setTimeout(function(){n=!1,o&&(r.apply(i,s),o=!1)},e),void t.apply(i,s))}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=o.extend({},t.options,e),t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var o=e[n];if(o===i)throw new Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(e)),o})},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,o=["webkit","moz","o","ms"];for(i=0;i<o.length&&!n;i++)n=t[o[i]+e];return n}function i(e){var i=+new Date,o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(e,o)}var n=0,r=t.requestAnimationFrame||e("RequestAnimationFrame")||i,s=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};o.Util.requestAnimFrame=function(e,n,s,a){return e=o.bind(e,n),s&&r===i?void e():r.call(t,e,a)},o.Util.cancelAnimFrame=function(e){e&&s.call(t,e)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=e,e.prototype=n;for(var r in this)this.hasOwnProperty(r)&&"prototype"!==r&&(e[r]=this[r]);t.statics&&(o.extend(e,t.statics),delete t.statics),t.includes&&(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),t.options&&n.options&&(t.options=o.extend({},n.options,t.options)),o.extend(n,t),n._initHooks=[];var s=this;return e.__super__=s.prototype,n.callInitHooks=function(){if(!this._initHooksCalled){s.prototype.callInitHooks&&s.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;e>t;t++)n._initHooks[t].call(this)}},e},o.Class.include=function(t){o.extend(this.prototype,t)},o.Class.mergeOptions=function(t){o.extend(this.prototype.options,t)},o.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var r="_leaflet_events";o.Mixin={},o.Mixin.Events={addEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addEventListener,this,e,i))return this;var n,s,a,l,h,u,c,d=this[r]=this[r]||{},p=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,s=t.length;s>n;n++)a={action:e,context:i||this},l=t[n],p?(h=l+"_idx",u=h+"_len",c=d[h]=d[h]||{},c[p]||(c[p]=[],d[u]=(d[u]||0)+1),c[p].push(a)):(d[l]=d[l]||[],d[l].push(a));return this},hasEventListeners:function(t){var e=this[r];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,i){if(!this[r])return this;if(!t)return this.clearAllEventListeners();if(o.Util.invokeEach(t,this.removeEventListener,this,e,i))return this;var n,s,a,l,h,u,c,d,p,m=this[r],f=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,s=t.length;s>n;n++)if(a=t[n],u=a+"_idx",c=u+"_len",d=m[u],e){if(l=f&&d?d[f]:m[a]){for(h=l.length-1;h>=0;h--)l[h].action!==e||i&&l[h].context!==i||(p=l.splice(h,1),p[0].action=o.Util.falseFn);i&&d&&0===l.length&&(delete d[f],m[c]--)}}else delete m[a],delete m[u],delete m[c];return this},clearAllEventListeners:function(){return delete this[r],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,n,s,a,l,h=o.Util.extend({},e,{type:t,target:this}),u=this[r];if(u[t])for(i=u[t].slice(),n=0,s=i.length;s>n;n++)i[n].action.call(i[n].context,h);a=u[t+"_idx"];for(l in a)if(i=a[l].slice())for(n=0,s=i.length;s>n;n++)i[n].action.call(i[n].context,h);return this},addOneTimeEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addOneTimeEventListener,this,e,i))return this;var n=o.bind(function(){this.removeEventListener(t,e,i).removeEventListener(t,n,i)},this);return this.addEventListener(t,e,i).addEventListener(t,n,i)}},o.Mixin.Events.on=o.Mixin.Events.addEventListener,o.Mixin.Events.off=o.Mixin.Events.removeEventListener,o.Mixin.Events.once=o.Mixin.Events.addOneTimeEventListener,o.Mixin.Events.fire=o.Mixin.Events.fireEvent,function(){var n="ActiveXObject"in t,r=n&&!e.addEventListener,s=navigator.userAgent.toLowerCase(),a=-1!==s.indexOf("webkit"),l=-1!==s.indexOf("chrome"),h=-1!==s.indexOf("phantom"),u=-1!==s.indexOf("android"),c=-1!==s.search("android [23]"),d=-1!==s.indexOf("gecko"),p=typeof orientation!=i+"",m=t.navigator&&t.navigator.msPointerEnabled&&t.navigator.msMaxTouchPoints&&!t.PointerEvent,f=t.PointerEvent&&t.navigator.pointerEnabled&&t.navigator.maxTouchPoints||m,g="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,_=e.documentElement,v=n&&"transition"in _.style,y="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!c,L="MozPerspective"in _.style,x="OTransition"in _.style,b=!t.L_DISABLE_3D&&(v||y||L||x)&&!h,P=!t.L_NO_TOUCH&&!h&&function(){var t="ontouchstart";if(f||t in _)return!0;var i=e.createElement("div"),n=!1;return i.setAttribute?(i.setAttribute(t,"return;"),"function"==typeof i[t]&&(n=!0),i.removeAttribute(t),i=null,n):!1}();o.Browser={ie:n,ielt9:r,webkit:a,gecko:d&&!a&&!t.opera&&!n,android:u,android23:c,chrome:l,ie3d:v,webkit3d:y,gecko3d:L,opera3d:x,any3d:b,mobile:p,mobileWebkit:p&&a,mobileWebkit3d:p&&y,mobileOpera:p&&t.opera,touch:P,msPointer:m,pointer:f,retina:g}}(),o.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=o.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=o.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,e,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===i||null===t?t:new o.Point(t,e,n)},o.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,r=t.max,s=r.x>=e.x&&n.x<=i.x,a=r.y>=e.y&&n.y<=i.y;return s&&a},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,e){return!t||t instanceof o.Bounds?t:new o.Bounds(t,e)},o.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},o.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new o.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i];if(!n&&t.currentStyle&&(n=t.currentStyle[i]),(!n||"auto"===n)&&e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},getViewportOffset:function(t){var i,n=0,r=0,s=t,a=e.body,l=e.documentElement;do{if(n+=s.offsetTop||0,r+=s.offsetLeft||0,n+=parseInt(o.DomUtil.getStyle(s,"borderTopWidth"),10)||0,r+=parseInt(o.DomUtil.getStyle(s,"borderLeftWidth"),10)||0,i=o.DomUtil.getStyle(s,"position"),s.offsetParent===a&&"absolute"===i)break;if("fixed"===i){n+=a.scrollTop||l.scrollTop||0,r+=a.scrollLeft||l.scrollLeft||0;break}if("relative"===i&&!s.offsetLeft){var h=o.DomUtil.getStyle(s,"width"),u=o.DomUtil.getStyle(s,"max-width"),c=s.getBoundingClientRect();("none"!==h||"none"!==u)&&(r+=c.left+s.clientLeft),n+=c.top+(a.scrollTop||l.scrollTop||0);break}s=s.offsetParent}while(s);s=t;do{if(s===a)break;n-=s.scrollTop||0,r-=s.scrollLeft||0,s=s.parentNode}while(s);return new o.Point(r,n)},documentIsLtr:function(){return o.DomUtil._docIsLtrCached||(o.DomUtil._docIsLtrCached=!0,o.DomUtil._docIsLtr="ltr"===o.DomUtil.getStyle(e.body,"direction")),o.DomUtil._docIsLtr},create:function(t,i,n){var o=e.createElement(t);return o.className=i,n&&n.appendChild(o),o},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=o.DomUtil._getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=o.Util.splitWords(e),r=0,s=n.length;s>r;r++)t.classList.add(n[r]);else if(!o.DomUtil.hasClass(t,e)){var a=o.DomUtil._getClass(t);o.DomUtil._setClass(t,(a?a+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):o.DomUtil._setClass(t,o.Util.trim((" "+o.DomUtil._getClass(t)+" ").replace(" "+e+" "," ")))},_setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},_getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(o){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},getTranslateString:function(t){var e=o.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",n=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+n},getScaleString:function(t,e){var i=o.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),n=" scale("+t+") ";return i+n},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&o.Browser.any3d?t.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),o.DomUtil.TRANSITION_END="webkitTransition"===o.DomUtil.TRANSITION||"OTransition"===o.DomUtil.TRANSITION?o.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in e)o.extend(o.DomUtil,{disableTextSelection:function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},enableTextSelection:function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)}});else{var i=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.extend(o.DomUtil,{disableTextSelection:function(){if(i){var t=e.documentElement.style;this._userSelect=t[i],t[i]="none"}},enableTextSelection:function(){i&&(e.documentElement.style[i]=this._userSelect,delete this._userSelect)}})}o.extend(o.DomUtil,{disableImageDrag:function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},enableImageDrag:function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)}})}(),o.LatLng=function(t,e,n){if(t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=t,this.lng=e,n!==i&&(this.alt=parseFloat(n))},o.extend(o.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),o.LatLng.prototype={equals:function(t){if(!t)return!1;t=o.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return e<=o.LatLng.MAX_MARGIN},toString:function(t){return"LatLng("+o.Util.formatNum(this.lat,t)+", "+o.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=o.latLng(t);var e=6378137,i=o.LatLng.DEG_TO_RAD,n=(t.lat-this.lat)*i,r=(t.lng-this.lng)*i,s=this.lat*i,a=t.lat*i,l=Math.sin(n/2),h=Math.sin(r/2),u=l*l+h*h*Math.cos(s)*Math.cos(a);return 2*e*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(t>i||i===e?e:t),new o.LatLng(this.lat,i)}},o.latLng=function(t,e){return t instanceof o.LatLng?t:o.Util.isArray(t)?"number"==typeof t[0]||"string"==typeof t[0]?new o.LatLng(t[0],t[1],t[2]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new o.LatLng(t.lat,"lng"in t?t.lng:t.lon):e===i?null:new o.LatLng(t,e)},o.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},o.LatLngBounds.prototype={extend:function(t){if(!t)return this;var e=o.latLng(t);return t=null!==e?e:o.latLngBounds(t),t instanceof o.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new o.LatLng(t.lat,t.lng),this._northEast=new o.LatLng(t.lat,t.lng)):t instanceof o.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,r=Math.abs(e.lng-i.lng)*t;return new o.LatLngBounds(new o.LatLng(e.lat-n,e.lng-r),new o.LatLng(i.lat+n,i.lng+r))},getCenter:function(){return new o.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new o.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof o.LatLng?o.latLng(t):o.latLngBounds(t);var e,i,n=this._southWest,r=this._northEast;return t instanceof o.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=r.lat&&e.lng>=n.lng&&i.lng<=r.lng},intersects:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),r=t.getNorthEast(),s=r.lat>=e.lat&&n.lat<=i.lat,a=r.lng>=e.lng&&n.lng<=i.lng;return s&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=o.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},o.latLngBounds=function(t,e){return!t||t instanceof o.LatLngBounds?t:new o.LatLngBounds(t,e)},o.Projection={},o.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),r=t.lng*e,s=n*e;return s=Math.log(Math.tan(Math.PI/4+s/2)),new o.Point(r,s)},unproject:function(t){var e=o.LatLng.RAD_TO_DEG,i=t.x*e,n=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new o.LatLng(n,i)}},o.Projection.LonLat={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new o.LatLng(t.y,t.x)}},o.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)},getSize:function(t){var e=this.scale(t);return o.point(e,e)}},o.CRS.Simple=o.extend({},o.CRS,{projection:o.Projection.LonLat,transformation:new o.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),o.CRS.EPSG3857=o.extend({},o.CRS,{code:"EPSG:3857",projection:o.Projection.SphericalMercator,transformation:new o.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),o.CRS.EPSG900913=o.extend({},o.CRS.EPSG3857,{code:"EPSG:900913"}),o.CRS.EPSG4326=o.extend({},o.CRS,{code:"EPSG:4326",projection:o.Projection.LonLat,transformation:new o.Transformation(1/360,.5,-1/360,.5)}),o.Map=o.Class.extend({includes:o.Mixin.Events,options:{crs:o.CRS.EPSG3857,fadeAnimation:o.DomUtil.TRANSITION&&!o.Browser.android23,trackResize:!0,markerZoomAnimation:o.DomUtil.TRANSITION&&o.Browser.any3d},initialize:function(t,e){e=o.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==i&&this.setView(o.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return e=e===i?this.getZoom():e,this._resetView(o.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),r=this.getSize().divideBy(2),s=t instanceof o.Point?t:this.latLngToContainerPoint(t),a=s.subtract(r).multiplyBy(1-1/n),l=this.containerPointToLatLng(r.add(a));return this.setView(l,e,{zoom:i})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():o.latLngBounds(t);var i=o.point(e.paddingTopLeft||e.padding||[0,0]),n=o.point(e.paddingBottomRight||e.padding||[0,0]),r=this.getBoundsZoom(t,!1,i.add(n)),s=n.subtract(i).divideBy(2),a=this.project(t.getSouthWest(),r),l=this.project(t.getNorthEast(),r),h=this.unproject(a.add(l).divideBy(2).add(s),r);return r=e&&e.maxZoom?Math.min(e.maxZoom,r):r,this.setView(h,r,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(o.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=o.latLngBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(t,e){var i=this.getCenter(),n=this._limitCenter(i,this._zoom,t);return i.equals(n)?this:this.panTo(n,e)},addLayer:function(t){var e=o.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=o.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&this.fire("layerremove",{layer:t}),this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(t){return t?o.stamp(t)in this._layers:!1},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),r=i.divideBy(2).round(),s=n.subtract(r);return s.x||s.y?(t.animate&&t.pan?this.panBy(s):(t.pan&&this._rawPanBy(s),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(t){this._container._leaflet=i}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new o.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom===i?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=o.latLngBounds(t);var n,r=this.getMinZoom()-(e?1:0),s=this.getMaxZoom(),a=this.getSize(),l=t.getNorthWest(),h=t.getSouthEast(),u=!0;i=o.point(i||[0,0]);do r++,n=this.project(h,r).subtract(this.project(l,r)).add(i),u=e?n.x<a.x||n.y<a.y:a.contains(n);while(u&&s>=r);return u&&e?null:e?r:r-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new o.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new o.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(o.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(o.point(t),e)},layerPointToLatLng:function(t){var e=o.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(o.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(o.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(o.latLng(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=o.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet)throw new Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;o.DomUtil.addClass(t,"leaflet-container"+(o.Browser.touch?" leaflet-touch":"")+(o.Browser.retina?" leaflet-retina":"")+(o.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=o.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,e),o.DomUtil.addClass(t.shadowPane,e),o.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return o.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;i>e;e++)this.addLayer(t[e])},_resetView:function(t,e,i,n){var r=this._zoom!==e;n||(this.fire("movestart"),r&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):o.DomUtil.setPosition(this._mapPane,new o.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var s=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!i}),s&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(r||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!i})},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-1/0,o=this._getZoomSpan();for(t in this._zoomBoundLayers){var r=this._zoomBoundLayers[t];isNaN(r.options.minZoom)||(e=Math.min(e,r.options.minZoom)),isNaN(r.options.maxZoom)||(n=Math.max(n,r.options.maxZoom))}t===i?this._layersMaxZoom=this._layersMinZoom=i:(this._layersMaxZoom=n,this._layersMinZoom=e),o!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(o.DomEvent){e=e||"on",o.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,n,r=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,n=r.length;n>i;i++)o.DomEvent[e](this._container,r[i],this._fireMouseEvent,this);this.options.trackResize&&o.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||o.DomEvent._skipped(t)||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!o.DomEvent._skipped(t)){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&o.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),n=this.containerPointToLayerPoint(i),r=this.layerPointToLatLng(n);this.fire(e,{latlng:r,layerPoint:n,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;e>t;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),r=this.getSize().divideBy(2),s=new o.Bounds(n.subtract(r),n.add(r)),a=this._getBoundsOffset(s,i,e);return this.unproject(n.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new o.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=this.project(e.getNorthWest(),i).subtract(t.min),r=this.project(e.getSouthEast(),i).subtract(t.max),s=this._rebound(n.x,-r.x),a=this._rebound(n.y,-r.y);return new o.Point(s,a)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),o.map=function(t,e){return new o.Map(t,e)},o.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),r=this.R_MAJOR,s=this.R_MINOR,a=t.lng*e*r,l=n*e,h=s/r,u=Math.sqrt(1-h*h),c=u*Math.sin(l);
c=Math.pow((1-c)/(1+c),.5*u);var d=Math.tan(.5*(.5*Math.PI-l))/c;return l=-r*Math.log(d),new o.Point(a,l)},unproject:function(t){for(var e,i=o.LatLng.RAD_TO_DEG,n=this.R_MAJOR,r=this.R_MINOR,s=t.x*i/n,a=r/n,l=Math.sqrt(1-a*a),h=Math.exp(-t.y/n),u=Math.PI/2-2*Math.atan(h),c=15,d=1e-7,p=c,m=.1;Math.abs(m)>d&&--p>0;)e=l*Math.sin(u),m=Math.PI/2-2*Math.atan(h*Math.pow((1-e)/(1+e),.5*l))-u,u+=m;return new o.LatLng(u*i,s)}},o.CRS.EPSG3395=o.extend({},o.CRS,{code:"EPSG:3395",projection:o.Projection.Mercator,transformation:function(){var t=o.Projection.Mercator,e=t.R_MAJOR,i=.5/(Math.PI*e);return new o.Transformation(i,.5,-i,.5)}()}),o.TileLayer=o.Class.extend({includes:o.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:o.Browser.mobile,updateWhenIdle:o.Browser.mobile},initialize:function(t,e){e=o.setOptions(this,e),e.detectRetina&&o.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=o.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=o.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,o,r=t.children,s=-e(1/0,-1/0);for(n=0,o=r.length;o>n;n++)r[n]!==this._container&&(i=parseInt(r[n].style.zIndex,10),isNaN(i)||(s=e(s,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(s)?s:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(o.Browser.ielt9)for(t in e)o.DomUtil.setOpacity(e[t],this.options.opacity);else o.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=o.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container";this._bgBuffer=o.DomUtil.create("div",e,this._container),this._tileContainer=o.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,n=this.options.tileSize;return i&&e>i&&(n=Math.round(t.getZoomScale(e)/t.getZoomScale(i)*n)),n},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),i=t.getZoom(),n=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var r=o.bounds(e.min.divideBy(n)._floor(),e.max.divideBy(n)._floor());this._addTilesFromCenterOut(r),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(r)}}},_addTilesFromCenterOut:function(t){var i,n,r,s=[],a=t.getCenter();for(i=t.min.y;i<=t.max.y;i++)for(n=t.min.x;n<=t.max.x;n++)r=new o.Point(n,i),this._tileShouldBeLoaded(r)&&s.push(r);var l=s.length;if(0!==l){s.sort(function(t,e){return t.distanceTo(a)-e.distanceTo(a)});var h=e.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=l,n=0;l>n;n++)this._addTile(s[n],h);this._tileContainer.appendChild(h)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=i.x)||t.y<0||t.y>=i.y)return!1}if(e.bounds){var n=e.tileSize,o=t.multiplyBy(n),r=o.add([n,n]),s=this._map.unproject(o),a=this._map.unproject(r);if(e.continuousWorld||e.noWrap||(s=s.wrap(),a=a.wrap()),!e.bounds.intersects([s,a]))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,o;for(o in this._tiles)e=o.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(i<t.min.x||i>t.max.x||n<t.min.y||n>t.max.y)&&this._removeTile(o)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(o.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),o.Browser.android||(e.onload=null,e.src=o.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();o.DomUtil.setPosition(n,i,o.Browser.chrome),this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this._getTileSize();return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return o.Util.template(this._url,o.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=o.DomUtil.create("img","leaflet-tile");return t.style.width=t.style.height=this._getTileSize()+"px",t.galleryimg="no",t.onselectstart=t.onmousemove=o.Util.falseFn,o.Browser.ielt9&&this.options.opacity!==i&&o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden"),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e),this.fire("tileloadstart",{tile:t,url:t.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&o.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(o.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==o.Util.emptyImageUrl&&(o.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),o.tileLayer=function(t,e){return new o.TileLayer(t,e)},o.TileLayer.WMS=o.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=o.extend({},this.defaultWmsParams),n=e.tileSize||this.options.tileSize;i.width=i.height=e.detectRetina&&o.Browser.retina?2*n:n;for(var r in e)this.options.hasOwnProperty(r)||"crs"===r||(i[r]=e[r]);this.wmsParams=i,o.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,o.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,i=this.options.tileSize,n=t.multiplyBy(i),r=n.add([i,i]),s=this._crs.project(e.unproject(n,t.z)),a=this._crs.project(e.unproject(r,t.z)),l=this._wmsVersion>=1.3&&this._crs===o.CRS.EPSG4326?[a.y,s.x,s.y,a.x].join(","):[s.x,a.y,a.x,s.y].join(","),h=o.Util.template(this._url,{s:this._getSubdomain(t)});return h+o.Util.getParamString(this.wmsParams,h,!0)+"&BBOX="+l},setParams:function(t,e){return o.extend(this.wmsParams,t),e||this.redraw(),this}}),o.tileLayer.wms=function(t,e){return new o.TileLayer.WMS(t,e)},o.TileLayer.Canvas=o.TileLayer.extend({options:{async:!1},initialize:function(t){o.setOptions(this,t)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTile:function(){var t=o.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=o.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),o.tileLayer.canvas=function(t){return new o.TileLayer.Canvas(t)},o.ImageOverlay=o.Class.extend({includes:o.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=o.latLngBounds(e),o.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&o.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},setUrl:function(t){this._url=t,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=o.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&o.Browser.any3d?o.DomUtil.addClass(this._image,"leaflet-zoom-animated"):o.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),o.extend(this._image,{galleryimg:"no",onselectstart:o.Util.falseFn,onmousemove:o.Util.falseFn,onload:o.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,n=e.getZoomScale(t.zoom),r=this._bounds.getNorthWest(),s=this._bounds.getSouthEast(),a=e._latLngToNewLayerPoint(r,t.zoom,t.center),l=e._latLngToNewLayerPoint(s,t.zoom,t.center)._subtract(a),h=a._add(l._multiplyBy(.5*(1-1/n)));i.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(h)+" scale("+n+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);o.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,e,i){return new o.ImageOverlay(t,e,i)},o.Icon=o.Class.extend({options:{className:""},initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n;return n=e&&"IMG"===e.tagName?this._createImg(i,e):this._createImg(i),this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i,n=this.options,r=o.point(n[e+"Size"]);i=o.point("shadow"===e?n.shadowAnchor||n.iconAnchor:n.iconAnchor),!i&&r&&(i=r.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+n.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),r&&(t.style.width=r.x+"px",t.style.height=r.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return o.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];o.Browser.retina&&"icon"===t&&(t+="-2x");var i=o.Icon.Default.imagePath;if(!i)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),o.Icon.Default.imagePath=function(){var t,i,n,o,r,s=e.getElementsByTagName("script"),a=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,i=s.length;i>t;t++)if(n=s[t].src,o=n.match(a))return r=n.split(a)[0],(r?r+"/":"")+"images"}(),o.Marker=o.Class.extend({includes:o.Mixin.Events,options:{icon:new o.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,n=i?"leaflet-zoom-animated":"leaflet-zoom-hide",r=t.icon.createIcon(this._icon),s=!1;r!==this._icon&&(this._icon&&this._removeIcon(),s=!0,t.title&&(r.title=t.title),t.alt&&(r.alt=t.alt)),o.DomUtil.addClass(r,n),t.keyboard&&(r.tabIndex="0"),this._icon=r,this._initInteraction(),t.riseOnHover&&o.DomEvent.on(r,"mouseover",this._bringToFront,this).on(r,"mouseout",this._resetZIndex,this);var a=t.icon.createShadow(this._shadow),l=!1;a!==this._shadow&&(this._removeShadow(),l=!0),a&&o.DomUtil.addClass(a,n),this._shadow=a,t.opacity<1&&this._updateOpacity();var h=this._map._panes;s&&h.markerPane.appendChild(this._icon),a&&l&&h.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&o.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&&o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];o.DomUtil.addClass(t,"leaflet-clickable"),o.DomEvent.on(t,"click",this._onMouseClick,this),o.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)o.DomEvent.on(t,e[i],this._fireMouseEvent,this);o.Handler.MarkerDrag&&(this.dragging=new o.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&o.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&o.DomEvent.preventDefault(t),"mousedown"!==t.type?o.DomEvent.stopPropagation(t):o.DomEvent.preventDefault(t)},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){o.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&o.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),o.marker=function(t,e){return new o.Marker(t,e)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;return i.innerHTML=n.html!==!1?n.html:"",n.bgPos&&(i.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.Map.mergeOptions({closePopupOnClick:!0}),o.Popup=o.Class.extend({includes:o.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){o.setOptions(this,t),this._source=e,this._animated=o.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout();var e=t.options.fadeAnimation;e&&o.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this.update(),e&&o.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),o.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&o.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=o.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=o.DomUtil.create("a",e+"-close-button",n),t.href="#close",t.innerHTML="&#215;",o.DomEvent.disableClickPropagation(t),o.DomEvent.on(t,"click",this._onCloseButtonClick,this));var r=this._wrapper=o.DomUtil.create("div",e+"-content-wrapper",n);o.DomEvent.disableClickPropagation(r),this._contentNode=o.DomUtil.create("div",e+"-content",r),o.DomEvent.disableScrollPropagation(this._contentNode),o.DomEvent.on(r,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",e+"-tip-container",n),this._tip=o.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,r=this.options.maxHeight,s="leaflet-popup-scrolled";r&&n>r?(e.height=r+"px",o.DomUtil.addClass(t,s)):o.DomUtil.removeClass(t,s),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=o.point(this.options.offset);e&&o.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);o.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,n=new o.Point(this._containerLeft,-e-this._containerBottom);this._animated&&n._add(o.DomUtil.getPosition(this._container));var r=t.layerPointToContainerPoint(n),s=o.point(this.options.autoPanPadding),a=o.point(this.options.autoPanPaddingTopLeft||s),l=o.point(this.options.autoPanPaddingBottomRight||s),h=t.getSize(),u=0,c=0;r.x+i+l.x>h.x&&(u=r.x+i-h.x+l.x),r.x-u-a.x<0&&(u=r.x-a.x),r.y+e+l.y>h.y&&(c=r.y+e-h.y+l.y),r.y-c-a.y<0&&(c=r.y-a.y),(u||c)&&t.fire("autopanstart").panBy([u,c])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)}}),o.popup=function(t,e){return new o.Popup(t,e)},o.Map.include({openPopup:function(t,e,i){if(this.closePopup(),!(t instanceof o.Popup)){var n=t;t=new o.Popup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),o.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var i=o.point(this.options.icon.options.popupAnchor||[0,0]);return i=i.add(o.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=o.extend({offset:i},e),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),t instanceof o.Popup?(o.setOptions(t,e),this._popup=t):this._popup=new o.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),o.LayerGroup=o.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return t?t in this._layers||this.getLayerId(t)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({includes:o.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:("on"in t&&t.on(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.off(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})):this},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},openPopup:function(t){for(var e in this._layers){this._layers[e].openPopup(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof o.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t=o.extend({layer:t.target,target:this},t),this.fire(t.type,t)}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Path=o.Class.extend({includes:[o.Mixin.Events],statics:{CLIP_PADDING:function(){var e=o.Browser.mobile?1280:2e3,i=(e/Math.max(t.outerWidth,t.outerHeight)-1)/2;return Math.max(0,Math.min(.5,i))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){o.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,o.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return o.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),o.Map.include({_updatePathViewport:function(){var t=o.Path.CLIP_PADDING,e=this.getSize(),i=o.DomUtil.getPosition(this._mapPane),n=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),r=n.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new o.Bounds(n,r)}}),o.Path.SVG_NS="http://www.w3.org/2000/svg",o.Browser.svg=!(!e.createElementNS||!e.createElementNS(o.Path.SVG_NS,"svg").createSVGRect),o.Path=o.Path.extend({statics:{SVG:o.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return e.createElementNS(o.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&o.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){(o.Browser.svg||!o.Browser.vml)&&o.DomUtil.addClass(this._path,"leaflet-clickable"),o.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;e<t.length;e++)o.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),n=e.containerPointToLayerPoint(i),r=e.layerPointToLatLng(n);this.fire(t.type,{latlng:r,layerPoint:n,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&o.DomEvent.preventDefault(t),"mousemove"!==t.type&&o.DomEvent.stopPropagation(t)
}}}),o.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=o.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&o.Browser.any3d?(o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,n=i.x-e.x,r=i.y-e.y,s=this._pathRoot,a=this._panes.overlayPane;o.Browser.mobileWebkit&&a.removeChild(s),o.DomUtil.setPosition(s,e),s.setAttribute("width",n),s.setAttribute("height",r),s.setAttribute("viewBox",[e.x,e.y,n,r].join(" ")),o.Browser.mobileWebkit&&a.appendChild(s)}}}),o.Path.include({bindPopup:function(t,e){return t instanceof o.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new o.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),o.Browser.vml=!o.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(n){return!1}}(),o.Path=o.Browser.svg||!o.Browser.vml?o.Path:o.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");o.DomUtil.addClass(t,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&o.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,t.dashStyle=i.dashArray?o.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):"",i.lineCap&&(t.endcap=i.lineCap.replace("butt","flat")),i.lineJoin&&(t.joinstyle=i.lineJoin)):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),o.Map.include(o.Browser.svg||!o.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=e.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),o.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),o.Path=o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?o.Path:o.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return o.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!o.Path._updateRequest&&(o.Path._updateRequest=o.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){o.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color)},_drawPath:function(){var t,e,i,n,r,s;for(this._ctx.beginPath(),t=0,i=this._parts.length;i>t;t++){for(e=0,n=this._parts[t].length;n>e;e++)r=this._parts[t][e],s=(0===e?"move":"line")+"To",this._ctx[s](r.x,r.y);this instanceof o.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill()),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(t){this._containsPoint(t.layerPoint)&&this.fire("click",t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),o.Map.include(o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?{}:{_initPathRoot:function(){var t,i=this._pathRoot;i||(i=this._pathRoot=e.createElement("canvas"),i.style.position="absolute",t=this._canvasCtx=i.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(i),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),n=this._pathRoot;o.DomUtil.setPosition(n,e),n.width=i.x,n.height=i.y,n.getContext("2d").translate(-e.x,-e.y)}}}),o.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,r=new o(n);r[0]=r[n-1]=1,this._simplifyDPStep(t,r,e,0,n-1);var s,a=[];for(s=0;n>s;s++)r[s]&&a.push(t[s]);return a},_simplifyDPStep:function(t,e,i,n,o){var r,s,a,l=0;for(s=n+1;o-1>=s;s++)a=this._sqClosestPointOnSegment(t[s],t[n],t[o],!0),a>l&&(r=s,l=a);l>i&&(e[r]=1,this._simplifyDPStep(t,e,i,n,r),this._simplifyDPStep(t,e,i,r,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,r=t.length;r>n;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return r-1>o&&i.push(t[r-1]),i},clipSegment:function(t,e,i,n){var o,r,s,a=n?this._lastCode:this._getBitCode(t,i),l=this._getBitCode(e,i);for(this._lastCode=l;;){if(!(a|l))return[t,e];if(a&l)return!1;o=a||l,r=this._getEdgeIntersection(t,e,o,i),s=this._getBitCode(r,i),o===a?(t=r,a=s):(e=r,l=s)}},_getEdgeIntersection:function(t,e,i,n){var r=e.x-t.x,s=e.y-t.y,a=n.min,l=n.max;return 8&i?new o.Point(t.x+r*(l.y-t.y)/s,l.y):4&i?new o.Point(t.x+r*(a.y-t.y)/s,a.y):2&i?new o.Point(l.x,t.y+s*(l.x-t.x)/r):1&i?new o.Point(a.x,t.y+s*(a.x-t.x)/r):void 0},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var r,s=e.x,a=e.y,l=i.x-s,h=i.y-a,u=l*l+h*h;return u>0&&(r=((t.x-s)*l+(t.y-a)*h)/u,r>1?(s=i.x,a=i.y):r>0&&(s+=l*r,a+=h*r)),l=t.x-s,h=t.y-a,n?l*l+h*h:new o.Point(s,a)}},o.Polyline=o.Path.extend({initialize:function(t,e){o.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";e>t;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(o.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,n=1/0,r=this._parts,s=null,a=0,l=r.length;l>a;a++)for(var h=r[a],u=1,c=h.length;c>u;u++){e=h[u-1],i=h[u];var d=o.LineUtil._sqClosestPointOnSegment(t,e,i,!0);n>d&&(n=d,s=o.LineUtil._sqClosestPointOnSegment(t,e,i))}return s&&(s.distance=Math.sqrt(n)),s},getBounds:function(){return new o.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,n,r=e?t:[];for(i=0,n=t.length;n>i;i++){if(o.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;r[i]=o.latLng(t[i])}return r},_initEvents:function(){o.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=o.Path.VML,n=0,r=t.length,s="";r>n;n++)e=t[n],i&&e._round(),s+=(n?"L":"M")+e.x+" "+e.y;return s},_clipPoints:function(){var t,e,i,n=this._originalPoints,r=n.length;if(this.options.noClip)return void(this._parts=[n]);this._parts=[];var s=this._parts,a=this._map._pathViewport,l=o.LineUtil;for(t=0,e=0;r-1>t;t++)i=l.clipSegment(n[t],n[t+1],a,t),i&&(s[e]=s[e]||[],s[e].push(i[0]),(i[1]!==n[t+1]||t===r-2)&&(s[e].push(i[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=o.LineUtil,i=0,n=t.length;n>i;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),o.Path.prototype._updatePath.call(this))}}),o.polyline=function(t,e){return new o.Polyline(t,e)},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,e){var i,n,r,s,a,l,h,u,c,d=[1,4,2,8],p=o.LineUtil;for(n=0,h=t.length;h>n;n++)t[n]._code=p._getBitCode(t[n],e);for(s=0;4>s;s++){for(u=d[s],i=[],n=0,h=t.length,r=h-1;h>n;r=n++)a=t[n],l=t[r],a._code&u?l._code&u||(c=p._getEdgeIntersection(l,a,u,e),c._code=p._getBitCode(c,e),i.push(c)):(l._code&u&&(c=p._getEdgeIntersection(l,a,u,e),c._code=p._getBitCode(c,e),i.push(c)),i.push(a));t=i}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},initialize:function(t,e){o.Polyline.prototype.initialize.call(this,t,e),this._initWithHoles(t)},_initWithHoles:function(t){var e,i,n;if(t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),e=0,i=this._holes.length;i>e;e++)n=this._holes[e]=this._convertLatLngs(this._holes[e]),n[0].equals(n[n.length-1])&&n.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(o.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,n;for(t=0,i=this._holes.length;i>t;t++)for(this._holePoints[t]=[],e=0,n=this._holes[t].length;n>e;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},setLatLngs:function(t){return t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0]?(this._initWithHoles(t),this.redraw()):o.Polyline.prototype.setLatLngs.call(this,t)},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,n=this._parts.length;n>i;i++){var r=o.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);r.length&&e.push(r)}this._parts=e}},_getPathPartStr:function(t){var e=o.Polyline.prototype._getPathPartStr.call(this,t);return e+(o.Browser.svg?"z":"x")}}),o.polygon=function(t,e){return new o.Polygon(t,e)},function(){function t(t){return o.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){n>i?t.setLatLngs(e[i++]):this.removeLayer(t)},this);n>i;)this.addLayer(new t(e[i++],this._options));return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t.push(e.getLatLngs())}),t}})}o.MultiPolyline=t(o.Polyline),o.MultiPolygon=t(o.Polygon),o.multiPolyline=function(t,e){return new o.MultiPolyline(t,e)},o.multiPolygon=function(t,e){return new o.MultiPolygon(t,e)}}(),o.Rectangle=o.Polygon.extend({initialize:function(t,e){o.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=o.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,e){return new o.Rectangle(t,e)},o.Circle=o.Path.extend({initialize:function(t,e,i){o.Path.prototype.initialize.call(this,i),this._latlng=o.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=o.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,i=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var t=this._getLngRadius(),e=360*(this._mRadius/40075017),i=this._latlng;return new o.LatLngBounds([i.lat-e,i.lng-t],[i.lat+e,i.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":o.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return 360*(this._mRadius/40075017)},_getLngRadius:function(){return this._getLatRadius()/Math.cos(o.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),o.circle=function(t,e,i){return new o.Circle(t,e,i)},o.CircleMarker=o.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){o.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){o.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(t){return o.Circle.prototype.setLatLng.call(this,t),this._popup&&this._popup._isOpen&&this._popup.setLatLng(t),this},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius}}),o.circleMarker=function(t,e){return new o.CircleMarker(t,e)},o.Polyline.include(o.Path.CANVAS?{_containsPoint:function(t,e){var i,n,r,s,a,l,h,u=this.options.weight/2;for(o.Browser.touch&&(u+=10),i=0,s=this._parts.length;s>i;i++)for(h=this._parts[i],n=0,a=h.length,r=a-1;a>n;r=n++)if((e||0!==n)&&(l=o.LineUtil.pointToSegmentDistance(t,h[r],h[n]),u>=l))return!0;return!1}}:{}),o.Polygon.include(o.Path.CANVAS?{_containsPoint:function(t){var e,i,n,r,s,a,l,h,u=!1;if(o.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(r=0,l=this._parts.length;l>r;r++)for(e=this._parts[r],s=0,h=e.length,a=h-1;h>s;a=s++)i=e[s],n=e[a],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(u=!u);return u}}:{}),o.Circle.include(o.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),o.CircleMarker.include(o.Path.CANVAS?{_updateStyle:function(){o.Path.prototype._updateStyle.call(this)}}:{}),o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,e){o.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,r=o.Util.isArray(t)?t:t.features;if(r){for(e=0,i=r.length;i>e;e++)n=r[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(r[e]);return this}var s=this.options;if(!s.filter||s.filter(t)){var a=o.GeoJSON.geometryToLayer(t,s.pointToLayer,s.coordsToLatLng,s);return a.feature=o.GeoJSON.asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),s.onEachFeature&&s.onEachFeature(t,a),this.addLayer(a)}},resetStyle:function(t){var e=this.options.style;e&&(o.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,e,i,n){var r,s,a,l,h="Feature"===t.type?t.geometry:t,u=h.coordinates,c=[];switch(i=i||this.coordsToLatLng,h.type){case"Point":return r=i(u),e?e(t,r):new o.Marker(r);case"MultiPoint":for(a=0,l=u.length;l>a;a++)r=i(u[a]),c.push(e?e(t,r):new o.Marker(r));return new o.FeatureGroup(c);case"LineString":return s=this.coordsToLatLngs(u,0,i),new o.Polyline(s,n);case"Polygon":if(2===u.length&&!u[1].length)throw new Error("Invalid GeoJSON object.");return s=this.coordsToLatLngs(u,1,i),new o.Polygon(s,n);case"MultiLineString":return s=this.coordsToLatLngs(u,1,i),new o.MultiPolyline(s,n);case"MultiPolygon":return s=this.coordsToLatLngs(u,2,i),new o.MultiPolygon(s,n);case"GeometryCollection":for(a=0,l=h.geometries.length;l>a;a++)c.push(this.geometryToLayer({geometry:h.geometries[a],type:"Feature",properties:t.properties},e,i,n));return new o.FeatureGroup(c);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new o.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){var n,o,r,s=[];for(o=0,r=t.length;r>o;o++)n=e?this.coordsToLatLngs(t[o],e-1,i):(i||this.coordsToLatLng)(t[o]),s.push(n);return s},latLngToCoords:function(t){var e=[t.lng,t.lat];return t.alt!==i&&e.push(t.alt),e},latLngsToCoords:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(o.GeoJSON.latLngToCoords(t[i]));return e},getFeature:function(t,e){return t.feature?o.extend({},t.feature,{geometry:e}):o.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var s={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.latLngToCoords(this.getLatLng())})}};o.Marker.include(s),o.Circle.include(s),o.CircleMarker.include(s),o.Polyline.include({toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"LineString",coordinates:o.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),o.Polygon.include({toGeoJSON:function(){var t,e,i,n=[o.GeoJSON.latLngsToCoords(this.getLatLngs())];if(n[0].push(n[0][0]),this._holes)for(t=0,e=this._holes.length;e>t;t++)i=o.GeoJSON.latLngsToCoords(this._holes[t]),i.push(i[0]),n.push(i);return o.GeoJSON.getFeature(this,{type:"Polygon",coordinates:n})}}),function(){function t(t){return function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:t,coordinates:e})}}o.MultiPolyline.include({toGeoJSON:t("MultiLineString")}),o.MultiPolygon.include({toGeoJSON:t("MultiPolygon")}),o.LayerGroup.include({toGeoJSON:function(){var e,i=this.feature&&this.feature.geometry,n=[];if(i&&"MultiPoint"===i.type)return t("MultiPoint").call(this);var r=i&&"GeometryCollection"===i.type;return this.eachLayer(function(t){t.toGeoJSON&&(e=t.toGeoJSON(),n.push(r?e.geometry:o.GeoJSON.asFeature(e)))}),r?o.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}})}(),o.geoJson=function(t,e){return new o.GeoJSON(t,e)},o.DomEvent={addListener:function(t,e,i,n){var r,s,a,l=o.stamp(i),h="_leaflet_"+e+l;return t[h]?this:(r=function(e){return i.call(n||t,e||o.DomEvent._getEvent())},o.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,r,l):(o.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,r,l),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",r,!1),t.addEventListener(e,r,!1)):"mouseenter"===e||"mouseleave"===e?(s=r,a="mouseenter"===e?"mouseover":"mouseout",r=function(e){return o.DomEvent._checkMouse(t,e)?s(e):void 0},t.addEventListener(a,r,!1)):"click"===e&&o.Browser.android?(s=r,r=function(t){return o.DomEvent._filterClick(t,s)},t.addEventListener(e,r,!1)):t.addEventListener(e,r,!1):"attachEvent"in t&&t.attachEvent("on"+e,r),t[h]=r,this))},removeListener:function(t,e,i){var n=o.stamp(i),r="_leaflet_"+e+n,s=t[r];return s?(o.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,n):o.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,n):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",s,!1),t.removeEventListener(e,s,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",s,!1):t.removeEventListener(e,s,!1):"detachEvent"in t&&t.detachEvent("on"+e,s),t[r]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){var e=o.DomEvent.stopPropagation;return o.DomEvent.on(t,"mousewheel",e).on(t,"MozMousePixelScroll",e)},disableClickPropagation:function(t){for(var e=o.DomEvent.stopPropagation,i=o.Draggable.START.length-1;i>=0;i--)o.DomEvent.on(t,o.Draggable.START[i],e);return o.DomEvent.on(t,"click",o.DomEvent._fakeStop).on(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new o.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new o.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent.timeStamp,n=o.DomEvent._lastClick&&i-o.DomEvent._lastClick;return n&&n>100&&500>n||t.target._simulatedClick&&!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=i,e(t))}},o.DomEvent.on=o.DomEvent.addListener,o.DomEvent.off=o.DomEvent.removeListener,o.Draggable=o.Class.extend({includes:o.Mixin.Events,statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.on(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.off(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(this._moved=!1,!(t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(o.DomEvent.stopPropagation(t),o.Draggable._disabled||(o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),this._moving)))){var i=t.touches?t.touches[0]:t;this._startPoint=new o.Point(i.clientX,i.clientY),this._startPos=this._newPos=o.DomUtil.getPosition(this._element),o.DomEvent.on(e,o.Draggable.MOVE[t.type],this._onMove,this).on(e,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var i=t.touches&&1===t.touches.length?t.touches[0]:t,n=new o.Point(i.clientX,i.clientY),r=n.subtract(this._startPoint);(r.x||r.y)&&(o.Browser.touch&&Math.abs(r.x)+Math.abs(r.y)<3||(o.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(r),o.DomUtil.addClass(e.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,o.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(r),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){o.DomUtil.removeClass(e.body,"leaflet-dragging"),this._lastTarget&&(o.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in o.Draggable.MOVE)o.DomEvent.off(e,o.Draggable.MOVE[t],this._onMove).off(e,o.Draggable.END[t],this._onUp);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&&this._moving&&(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:o.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,r=(n+e+i)%t-e-i,s=Math.abs(o+i)<Math.abs(r+i)?o:r;this._draggable._newPos.x=s},_onDragEnd:function(t){var e=this._map,i=e.options,n=+new Date-this._lastTime,r=!i.inertia||n>i.inertiaThreshold||!this._positions[0];if(e.fire("dragend",t),r)e.fire("moveend");else{var s=this._lastPos.subtract(this._positions[0]),a=(this._lastTime+n-this._times[0])/1e3,l=i.easeLinearity,h=s.multiplyBy(l/a),u=h.distanceTo([0,0]),c=Math.min(i.inertiaMaxSpeed,u),d=h.multiplyBy(c/u),p=c/(i.inertiaDeceleration*l),m=d.multiplyBy(-p/2).round();m.x&&m.y?(m=e._limitOffset(m,e.options.maxBounds),o.Util.requestAnimFrame(function(){e.panBy(m,{duration:p,easeLinearity:l,noMoveStart:!0})})):e.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===e.options.doubleClickZoom?e.setZoom(i):e.setZoomAround(t.containerPoint,i)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),o.DomEvent.on(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),o.DomEvent.off(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=o.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),i),o.DomEvent.preventDefault(t),o.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&("center"===t.options.scrollWheelZoom?t.setZoom(i+e):t.setZoomAround(this._lastMousePos,i+e))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.extend(o.DomEvent,{_touchstart:o.Browser.msPointer?"MSPointerDown":o.Browser.pointer?"pointerdown":"touchstart",_touchend:o.Browser.msPointer?"MSPointerUp":o.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,i,n){function r(t){var e;if(o.Browser.pointer?(m.push(t.pointerId),e=m.length):e=t.touches.length,!(e>1)){var i=Date.now(),n=i-(a||i);l=t.touches?t.touches[0]:t,h=n>0&&u>=n,a=i}}function s(t){if(o.Browser.pointer){var e=m.indexOf(t.pointerId);if(-1===e)return;m.splice(e,1)}if(h){if(o.Browser.pointer){var n,r={};for(var s in l)n=l[s],r[s]="function"==typeof n?n.bind(l):n;l=r}l.type="dblclick",i(l),a=null}}var a,l,h=!1,u=250,c="_leaflet_",d=this._touchstart,p=this._touchend,m=[];t[c+d+n]=r,t[c+p+n]=s;var f=o.Browser.pointer?e.documentElement:t;return t.addEventListener(d,r,!1),f.addEventListener(p,s,!1),o.Browser.pointer&&f.addEventListener(o.DomEvent.POINTER_CANCEL,s,!1),this},removeDoubleTapListener:function(t,i){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+i],!1),(o.Browser.pointer?e.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+i],!1),o.Browser.pointer&&e.documentElement.removeEventListener(o.DomEvent.POINTER_CANCEL,t[n+this._touchend+i],!1),this}}),o.extend(o.DomEvent,{POINTER_DOWN:o.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:o.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:o.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:o.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(t,e,i,n){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,i,n);
case"touchend":return this.addPointerListenerEnd(t,e,i,n);case"touchmove":return this.addPointerListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,i,n,r){var s="_leaflet_",a=this._pointers,l=function(t){o.DomEvent.preventDefault(t);for(var e=!1,i=0;i<a.length;i++)if(a[i].pointerId===t.pointerId){e=!0;break}e||a.push(t),t.touches=a.slice(),t.changedTouches=[t],n(t)};if(t[s+"touchstart"+r]=l,t.addEventListener(this.POINTER_DOWN,l,!1),!this._pointerDocumentListener){var h=function(t){for(var e=0;e<a.length;e++)if(a[e].pointerId===t.pointerId){a.splice(e,1);break}};e.documentElement.addEventListener(this.POINTER_UP,h,!1),e.documentElement.addEventListener(this.POINTER_CANCEL,h,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(t,e,i,n){function o(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons){for(var e=0;e<s.length;e++)if(s[e].pointerId===t.pointerId){s[e]=t;break}t.touches=s.slice(),t.changedTouches=[t],i(t)}}var r="_leaflet_",s=this._pointers;return t[r+"touchmove"+n]=o,t.addEventListener(this.POINTER_MOVE,o,!1),this},addPointerListenerEnd:function(t,e,i,n){var o="_leaflet_",r=this._pointers,s=function(t){for(var e=0;e<r.length;e++)if(r[e].pointerId===t.pointerId){r.splice(e,1);break}t.touches=r.slice(),t.changedTouches=[t],i(t)};return t[o+"touchend"+n]=s,t.addEventListener(this.POINTER_UP,s,!1),t.addEventListener(this.POINTER_CANCEL,s,!1),this},removePointerListener:function(t,e,i){var n="_leaflet_",o=t[n+e+i];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,o,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,o,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,o,!1),t.removeEventListener(this.POINTER_CANCEL,o,!1)}return this}}),o.Map.mergeOptions({touchZoom:o.Browser.touch&&!o.Browser.android23,bounceAtZoomLimits:!0}),o.Map.TouchZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToLayerPoint(t.touches[0]),r=i.mouseEventToLayerPoint(t.touches[1]),s=i._getCenterLayerPoint();this._startCenter=n.add(r)._divideBy(2),this._startDist=n.distanceTo(r),this._moved=!1,this._zooming=!0,this._centerOffset=s.subtract(this._startCenter),i._panAnim&&i._panAnim.stop(),o.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),o.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var i=e.mouseEventToLayerPoint(t.touches[0]),n=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(n)/this._startDist,this._delta=i._add(n)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(e.options.bounceAtZoomLimits||!(e.getZoom()===e.getMinZoom()&&this._scale<1||e.getZoom()===e.getMaxZoom()&&this._scale>1))&&(this._moved||(o.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),o.DomEvent.preventDefault(t))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var t=this._map;this._zooming=!1,o.DomUtil.removeClass(t._mapPane,"leaflet-touching"),o.Util.cancelAnimFrame(this._animRequest),o.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd);var i=this._getScaleOrigin(),n=t.layerPointToLatLng(i),r=t.getZoom(),s=t.getScaleZoom(this._scale)-r,a=s>0?Math.ceil(s):Math.floor(s),l=t._limitZoom(r+a),h=t.getZoomScale(l)/this._scale;t._animateZoom(n,l,i,h)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),o.Map.addInitHook("addHandler","touchZoom",o.Map.TouchZoom),o.Map.mergeOptions({tap:!0,tapTolerance:15}),o.Map.Tap=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(o.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new o.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(o.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),o.DomEvent.on(e,"touchmove",this._onMove,this).on(e,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),o.DomEvent.off(e,"touchmove",this._onMove,this).off(e,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new o.Point(e.clientX,e.clientY)},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),o.Browser.touch&&!o.Browser.pointer&&o.Map.addInitHook("addHandler","tap",o.Map.Tap),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._moved=!1},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(t){return this._moved=!1,!t.shiftKey||1!==t.which&&1!==t.button?!1:(o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),void o.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this))},_onMouseMove:function(t){this._moved||(this._box=o.DomUtil.create("div","leaflet-zoom-box",this._pane),o.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var e=this._startLayerPoint,i=this._box,n=this._map.mouseEventToLayerPoint(t),r=n.subtract(e),s=new o.Point(Math.min(n.x,e.x),Math.min(n.y,e.y));o.DomUtil.setPosition(i,s),this._moved=!0,i.style.width=Math.max(0,Math.abs(r.x)-4)+"px",i.style.height=Math.max(0,Math.abs(r.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var n=new o.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(n),e.fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),o.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;o.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,o=i.scrollTop||n.scrollTop,r=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(r,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;i>e;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;i>e;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;i>e;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;i>e;e++)n[o.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;i>e;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;i>e;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){o.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(e in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else{if(!(e in this._zoomKeys))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}o.DomEvent.stop(t)}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),o.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),o.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=o.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(i);e&&o.DomUtil.setPosition(e,i),t._latlng=n,t.fire("move",{latlng:n}).fire("drag")},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return o.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,r){var s=i+t+" "+i+r;e[t+r]=o.DomUtil.create("div",s,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=o.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),o.Control.Zoom=o.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=o.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,e+"-out",i,this._zoomOut,this),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,n,r,s){var a=o.DomUtil.create("a",i,n);a.innerHTML=t,a.href="#",a.title=e;var l=o.DomEvent.stopPropagation;return o.DomEvent.on(a,"click",l).on(a,"mousedown",l).on(a,"dblclick",l).on(a,"click",o.DomEvent.preventDefault).on(a,"click",r,s).on(a,"click",this._refocusOnMap,s),a},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";o.DomUtil.removeClass(this._zoomInButton,e),o.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&o.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&o.DomUtil.addClass(this._zoomInButton,e)}}),o.Map.mergeOptions({zoomControl:!0}),o.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new o.Control.Zoom,this.addControl(this.zoomControl))}),o.control.zoom=function(t){return new o.Control.Zoom(t)},o.Control.Attribution=o.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){o.setOptions(this,t),this._attributions={}},onAdd:function(t){this._container=o.DomUtil.create("div","leaflet-control-attribution"),o.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):void 0},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):void 0},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),o.Map.mergeOptions({attributionControl:!0}),o.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new o.Control.Attribution).addTo(this))}),o.control.attribution=function(t){return new o.Control.Attribution(t)},o.Control.Scale=o.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",i=o.DomUtil.create("div",e),n=this.options;return this._addScales(n,e,i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=o.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=o.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize(),r=this.options,s=0;o.x>0&&(s=n*(r.maxWidth/o.x)),this._updateScales(r,s)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,o=3.2808399*t,r=this._iScale;o>5280?(e=o/5280,i=this._getRoundNum(e),r.style.width=this._getScaleWidth(i/e)+"px",r.innerHTML=i+" mi"):(n=this._getRoundNum(o),r.style.width=this._getScaleWidth(n/o)+"px",r.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),o.control.scale=function(t){return new o.Control.Scale(t)},o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){o.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=o.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=o.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),o.Browser.touch?o.DomEvent.on(e,"click",o.DomEvent.stopPropagation):o.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var i=this._form=o.DomUtil.create("form",t+"-list");if(this.options.collapsed){o.Browser.android||o.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var n=this._layersLink=o.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",o.Browser.touch?o.DomEvent.on(n,"click",o.DomEvent.stop).on(n,"click",this._expand,this):o.DomEvent.on(n,"focus",this._expand,this),o.DomEvent.on(i,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=o.DomUtil.create("div",t+"-base",i),this._separator=o.DomUtil.create("div",t+"-separator",i),this._overlaysList=o.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var n=o.stamp(t);this._layers[n]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i=!1,n=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),n=n||e.overlay,i=i||!e.overlay;this._separator.style.display=n&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[o.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';i&&(n+=' checked="checked"'),n+="/>";var o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,n=e.createElement("label"),r=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=r):i=this._createRadioElement("leaflet-base-layers",r),i.layerId=o.stamp(t.layer),o.DomEvent.on(i,"click",this._onInputClick,this);var s=e.createElement("span");s.innerHTML=" "+t.name,n.appendChild(i),n.appendChild(s);var a=t.overlay?this._overlaysList:this._baseLayersList;return a.appendChild(n),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=n.length;for(this._handlingClick=!0,t=0;o>t;t++)e=n[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){o.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),o.control.layers=function(t,e,i){return new o.Control.Layers(t,e,i)},o.PosAnimation=o.Class.extend({includes:o.Mixin.Events,run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[o.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",o.DomEvent.on(t,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),o.DomUtil.setPosition(t,e),o.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(o.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(o.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),o.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._leaflet_pos=t,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,i,n,r=this._el,s=t.getComputedStyle(r);if(o.Browser.any3d){if(n=s[o.DomUtil.TRANSFORM].match(this._transformRe),!n)return;e=parseFloat(n[1]),i=parseFloat(n[2])}else e=parseFloat(s.left),i=parseFloat(s.top);return new o.Point(e,i,!0)},_onTransitionEnd:function(){o.DomEvent.off(this._el,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[o.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),o.Map.include({setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(o.latLng(t),e,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate},n.pan));var r=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(r)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=o.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){o.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return(e&&e.animate)===!0||this.getSize().contains(i)?(this.panBy(i,e),!0):!1}}),o.PosAnimation=o.DomUtil.TRANSITION?o.PosAnimation:o.PosAnimation.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;e>t?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));o.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),o.DomUtil.TRANSITION&&o.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&o.DomUtil.TRANSITION&&o.Browser.any3d&&!o.Browser.android23&&!o.Browser.mobileOpera,this._zoomAnimated&&o.DomEvent.on(this._mapPane,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),o.Map.include(o.DomUtil.TRANSITION?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/n),r=this._getCenterLayerPoint()._add(o);return i.animate===!0||this.getSize().contains(o)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,r,n,null,!0),!0):!1},_animateZoom:function(t,e,i,n,r,s,a){a||(this._animatingZoom=!0),o.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,o.Draggable&&(o.Draggable._disabled=!0),o.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:n,delta:r,backwards:s})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=!1,o.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),o.Draggable&&(o.Draggable._disabled=!1)}}:{}),o.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,i=o.DomUtil.TRANSFORM,n=t.delta?o.DomUtil.getTranslateString(t.delta):e.style[i],r=o.DomUtil.getScaleString(t.scale,t.origin);e.style[i]=t.backwards?r+" "+n:n+" "+r},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),o.Util.falseFn(e.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[o.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,i=this._getLoadedTilesPercentage(e),n=this._getLoadedTilesPercentage(t);return e&&i>.5&&.5>n?(t.style.visibility="hidden",void this._stopLoadingImages(t)):(e.style.visibility="hidden",e.style[o.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),o=0;for(e=0,i=n.length;i>e;e++)n[e].complete&&o++;return o/i},_stopLoadingImages:function(t){var e,i,n,r=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=r.length;i>e;e++)n=r[e],n.complete||(n.onload=o.Util.falseFn,n.onerror=o.Util.falseFn,n.src=o.Util.emptyImageUrl,n.parentNode.removeChild(n))}}),o.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=o.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o.bind(this._handleGeolocationResponse,this),i=o.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new o.LatLng(e,i),r=180*t.coords.accuracy/40075017,s=r/Math.cos(o.LatLng.DEG_TO_RAD*e),a=o.latLngBounds([e-r,i-s],[e+r,i+s]),l=this._locateOptions;if(l.setView){var h=Math.min(this.getBoundsZoom(a),l.maxZoom);this.setView(n,h)}var u={latlng:n,bounds:a,timestamp:t.timestamp};for(var c in t.coords)"number"==typeof t.coords[c]&&(u[c]=t.coords[c]);this.fire("locationfound",u)}})}(window,document),function(){var t={},e=function(t,e){return{head:t,tail:e}},i=function(t,i){return e(t,i)},n=function(t,i){return e(t,i)},o=new n(-1,null),r=function(t){return-1===t.head},s=function(t,e){return new n(t.head+e,t.tail)},a=function(t){var e=t.length;return function(i,n){return i.substr(n.head,e)===t?s(n,e):o}},l=function(t){var e=t.length;return t=t.toLowerCase(),function(i,n){return i.substr(n.head,e).toLowerCase()===t?s(n,e):o}},h=function(t,e){var i=t.charCodeAt(0),n=e.charCodeAt(0);return function(t,e){var r=t.charCodeAt(e.head);return r>=i&&n>=r?s(e,1):o}},u=function(t){return function(e,i){return e.length>i.head&&r(t(e,i))?s(i,1):o}},c=function(t){return function(e,i){for(var n=0;n<t.length;n++)if(i=t[n](e,i),r(i))return o;return i}},d=function(t){return function(e,i){for(var n=0;n<t.length;n++){var s=t[n](e,i);if(!r(s))return s}return o}},p=function(t,e){return e},m=function(t){return d([t,p])},f=function(t,e){return function(i,n){for(var s=0;;){var a=e(i,n);if(r(a))return s>=t?n:o;s+=1,n=a}return o}},g=function(t,e,i){var n=c([e,f(t-1,c([i,e]))]);return t>0?n:d([n,p])},_=f(0,d([a(" "),a("	"),a("\n")])),v=function(t,e,i){return g(t,e,c([_,i,_]))},y=function(t){for(var e=[],i=0;i<t.length;i++)e.length>0&&e.push(_),e.push(t[i]);return c(e)},x=function(t){return function(e,s){var a=t(e,s);return r(a)?o:new n(a.head,new i(e.substr(s.head,a.head-s.head),a.tail))}},b=function(t,e){return function(s,a){var l=a,h=t(s,new n(l.head,null));return r(h)?o:new n(h.head,new i(e(h.tail),l.tail))}},P=x(f(1,d([h("a","z"),h("A","Z"),h("",""),h("",""),h("0","9"),a("_")]))),C=x(f(1,d([h("a","z"),h("A","Z"),h("",""),h("",""),h("0","9"),a("_"),a(" ")]))),w=d([P,c([a('"'),C,a('"')]),c([a("`"),C,a("`")])]),T=c([a("'"),x(f(0,u(a("'")))),a("'")]),M=f(1,h("0","9")),S=x(c([m(a("-")),M,m(c([a("."),M]))])),D=d([S,T]),I=function(t,e){return e(t,new n(0,null))},k=b(y([w,x(d([a("=="),a("!="),a("<>"),a("<="),a(">="),a("="),a("<"),a(">"),l("LIKE")])),D]),function(t){var e=t.tail.tail.head,i=t.tail.head,n=t.head,o=null;return"LIKE"===i.toUpperCase()&&(o=function(t){var e=null;return e=function(i,o){var r=n.charAt(i),s=t.charAt(o);return""===r?""===s:"%"===r?e(i+1,o)||""!==s&&e(i,o+1):r===s&&e(i+1,o+1)},e(0,0)}),function(t,r){var s=t[r[e]];if("boolean"==typeof s&&"string"==typeof n&&(s=s?"True":"False"),null===s)return!1;if(null!==o)return o(s);if("="===i||"=="===i)return s==n;if("!="===i||"<>"===i)return s!=n;var a,l;return I(n,S).head===n.length?(a=parseFloat(s),l=parseFloat(n),"<"===i?l>a:">"===i?a>l:"<="===i?l>=a:">="===i?a>=l:!1):(a=s,l=n,"<"===i?l>a:">"===i?a>l:"<="===i?l>=a:">="===i?a>=l:!1)}}),E=b(y([w,l("IN"),a("("),v(0,D,a(",")),a(")")]),function(t){for(var e=t;null!=e.tail;)e=e.tail;var i=e.head;return function(e,n){var o=e[n[i]];if(null==o)return!1;for(var r=t;null!==r.tail;){if(r.head===o)return!0;
r=r.tail}return!1}}),A=function(t,e){return A(t,e)},O=function(t,e){return O(t,e)},R=b(y([l("NOT"),A]),function(t){var e=t.head;return function(t,i){return!e(t,i)}});A=d([R,k,E,y([a("("),O,a(")")])]);var N=b(v(2,A,l("AND")),function(t){return function(e,i){for(var n=!0,o=t;null!=o;)n=n&&o.head(e,i),o=o.tail;return n}}),U=b(v(2,A,l("OR")),function(t){return function(e,i){for(var n=!1,o=t;null!=o;)n=n||o.head(e,i),o=o.tail;return n}});O=d([N,U,A]);var B=c([_,O,_]);t.parseSQL=function(t){var e=I(t,B);return e.head===t.length?e.tail.head:I(t,_).head===t.length?function(){return!0}:null};var z=function(t,e){return z(t,e)},F=function(t,e){return F(t,e)};z=b(v(1,F,x(d([a("+"),a("-")]))),function(t){return function(e,i){for(var n=t,o=0;null!==n;){if(o+=n.head(e,i),null===n.tail)return o;"-"===n.tail.head&&(o=-o),n=n.tail.tail}return o}});var Z=d([b(S,function(t){return function(){return parseFloat(t.head)}}),b(c([a("floor("),z,a(")")]),function(t){return function(e,i){var n=t.head(e,i);return Math.floor(n)}}),b(c([a("["),P,a("]")]),function(t){return function(e,i){return parseFloat(e[i[t.head]])}}),y([a("("),z,a(")")])]);Z=d([Z,b(y([a("-"),Z]),function(t){return function(e,i){return-t.head(e,i)}})]),F=b(v(1,Z,x(d([a("*"),a("/")]))),function(t){return function(e,i){for(var n=t,o=1;null!==n;){if(o*=n.head(e,i),null===n.tail)return o;"/"===n.tail.head&&(o=1/o),n=n.tail.tail}return o}}),Z=d([Z,b(y([a("-"),Z]),function(t){return function(e,i){return-t.head(e,i)}})]);var H=c([_,z,_]);t.parseExpression=function(t){var e=I(t,H);return e.head===t.length?e.tail.head:null};var G=b(f(0,d([S,a(","),a("M"),a("C"),f(1,d([a(" "),a("	"),a("\r"),a("\n")]))])),function(t){for(var e=[];null!==t;)e.push(Std.parseFloat(t.head)),t=t.tail;return e.reverse(),e});t.parseSVGPath=function(t){var e=I(t,G);return e.head===t.length?e.tail.head:[]},L.gmx=L.gmx||{},L.gmx.Parsers=t}();var e=function(t){var i,n=[],o=[],r=!1,s=!1,a=!1,l=this._fulfill=function(t){if(!r){var e=t?n:o;i=[].slice.call(arguments,1),r=!0,s=t,e.forEach(function(t){t.apply(null,i)}),n=o=[]}};this.resolve=function(){l.apply(null,[!0].concat([].slice.call(arguments)))},this.reject=function(){l.apply(null,[!1].concat([].slice.call(arguments)))};var h=this.then=function(t,a){var l=new e,h=function(t,i){return function(){if(t){var n=t.apply(null,arguments);n instanceof e?n.then(l.resolve,l.reject):l.resolve(n)}else l._fulfill.apply([i].concat([].slice.call(arguments)))}};return r?h(s?t:a,s).apply(null,i):(n.push(h(t,!0)),o.push(h(a,!1))),l};this.once=function(t){a||(a=!0,h(t))},this.always=function(t){h(t,t)},this.getFulfilledData=function(){return i},this.cancel=function(){t&&t()}};e.all=function(){var t=[].slice.apply(arguments),i=new e,n=t.length,o=new Array(t.length);return t.forEach(function(t,e){t.then(function(t){o[e]=t,n--,0===n&&i.resolve.apply(i,o)})}),i},L.gmx=L.gmx||{},L.gmx.Deferred=e;var i=function(t,e,i){this._id=t,this.def=new L.gmx.Deferred(n._cancelRequest.bind(n,this)),this.url=e,this.options=i||{}},n={maxCount:20,curCount:0,requests:[],inProgress:{},uniqueID:0,emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",_imageLoaded:function(t,e){if(t in this.inProgress){for(var i=this.inProgress[t].requests,n=0;n<i.length;n++){var o=i[n].def;e?o.resolve(e):o.reject()}this.curCount--,delete this.inProgress[t]}this._nextLoad()},_nextLoad:function(){if(!(this.curCount>=this.maxCount)&&this.requests.length){var t=this.requests.shift(),e=t.url;if(e in this.inProgress)this.inProgress[e].requests.push(t);else{var i=[t];this.inProgress[e]={requests:i},this.curCount++;for(var n=this.requests.length-1;n>=0;n--)this.requests[n].url===e&&(i.push(this.requests[n]),this.requests.splice(n,1));var o=this._loadImage(t);this.inProgress[e]&&(this.inProgress[e].image=o)}}},_loadImage:function(t){var e=new Image,i=t.url,n=this;return t.options.crossOrigin&&(e.crossOrigin=t.options.crossOrigin),e.onload=this._imageLoaded.bind(this,i,e),e.onerror=function(){n._imageLoaded(i)},e.src=i,e},_cancelRequest:function(t){var e=t._id,i=0;if(t.url in this.inProgress){var n=this.inProgress[t.url];if(1===n.requests.length&&n.requests[0]._id===e)this.curCount--,delete this.inProgress[t.url],n.image=this.emptyImageUrl,this._nextLoad();else for(i=0;i<n.requests.length;i++)if(n.requests[i].id===e){n.requests.splice(i,1);break}}else for(i=0;i<this.requests.length;i++)if(this.requests[i].id===e){this.requests.splice(i,1);break}},clearLayer:function(t){var e=[],i=0;for(var n in this.inProgress){var o=this.inProgress[n].requests;for(i=0;i<o.length;i++)o[i].options.layerID===t&&e.push(o[i])}for(i=0;i<this.requests.length;i++)this.requests[i].options.layerID===t&&e.push(this.requests[i]);e.forEach(this._cancelRequest.bind(this))},_add:function(t,e,n){var o="id"+this.uniqueID++,r=new i(o,e,n);return e in this.inProgress?this.inProgress[e].requests.push(r):(t?this.requests.unshift(r):this.requests.push(r),this._nextLoad()),r.def},push:function(t,e){return this._add(!1,t,e)},unshift:function(t,e){return this._add(!0,t,e)}},o=function(){var t=0,e=4,i=64,n=null,o=function(t,e){for(var i=[],n=0;e>n;++n){i[n]=[];for(var o=0;t>o;++o)i[n][o]=0}return i},r=function(t,e,i){this.w=t,this.h=e,this.values=i||o(e)},s=function(t){for(var e=[],i=0;i<t.length;++i)e[i]=[].concat(t[i]);return e};r.prototype={add:function(t){if(t.w!==this.w||t.h!==this.h)throw new Error("Matrix add size mismatch");for(var e=o(this.w,this.h),i=0;i<this.h;++i)for(var n=0;n<this.w;++n)e[i][n]=this.values[i][n]+t.values[i][n];return new r(this.w,this.h,e)},transformProjectiveVector:function(t){var e,i,n=[];for(i=0;i<this.h;++i)for(n[i]=0,e=0;e<this.w;++e)n[i]+=this.values[i][e]*t[e];var o=n[n.length-1];if(o){var r=1/n[n.length-1];for(i=0;i<this.h;++i)n[i]*=r}return n},multiply:function(t){var e,i,n;if(+t!==t){if(t.h!==this.w)throw new Error("Matrix mult size mismatch");for(e=o(this.w,this.h),n=0;n<this.h;++n)for(i=0;i<t.w;++i){for(var s=0,a=0;a<this.w;a++)s+=this.values[n][a]*t.values[a][i];e[n][i]=s}return new r(t.w,this.h,e)}for(e=o(this.w,this.h),n=0;n<this.h;++n)for(i=0;i<this.w;++i)e[n][i]=this.values[n][i]*t;return new r(this.w,this.h,e)},rowEchelon:function(){if(this.w<=this.h)throw new Error("Matrix rowEchelon size mismatch");for(var t=s(this.values),e=0;e<this.h;++e){for(var i=t[e][e];0===i;){for(var n=e+1;n<this.h;++n)if(0!==t[n][e]){var o=t[n];t[n]=t[e],t[e]=o;break}if(n===this.h)return new r(this.w,this.h,t);i=t[e][e]}for(var a=1/i,l=e;l<this.w;++l)t[e][l]*=a;for(var h=0;h<this.h;++h)if(h!==e){var u=t[h][e];for(t[h][e]=0,l=e+1;l<this.w;++l)t[h][l]-=u*t[e][l]}}return new r(this.w,this.h,t)},invert:function(){var t,e;if(this.w!==this.h)throw new Error("Matrix invert size mismatch");var i=o(2*this.w,this.h);for(e=0;e<this.h;++e)for(t=0;t<this.w;++t)i[e][t]=this.values[e][t],i[e][t+this.w]=t===e?1:0;i=new r(2*this.w,this.h,i),i=i.rowEchelon();var n=o(this.w,this.h);for(e=0;e<this.w;++e)for(t=0;t<this.w;++t)n[e][t]=i.values[e][t+this.w];return new r(this.w,this.h,n)}};var a=function(t){var e=new r(9,8,[[1,1,1,0,0,0,-t[2][0],-t[2][0],-t[2][0]],[0,1,1,0,0,0,0,-t[3][0],-t[3][0]],[1,0,1,0,0,0,-t[1][0],0,-t[1][0]],[0,0,1,0,0,0,0,0,-t[0][0]],[0,0,0,-1,-1,-1,t[2][1],t[2][1],t[2][1]],[0,0,0,0,-1,-1,0,t[3][1],t[3][1]],[0,0,0,-1,0,-1,t[1][1],0,t[1][1]],[0,0,0,0,0,-1,0,0,t[0][1]]]),i=e.rowEchelon().values,n=new r(3,3,[[-i[0][8],-i[1][8],-i[2][8]],[-i[3][8],-i[4][8],-i[5][8]],[-i[6][8],-i[7][8],1]]);return n},l=function(e,o,r,s,a,h,u,c,d,p){if(d){var m=[h[0]+u[0]-2*a[0],h[1]+u[1]-2*a[1]],f=[h[0]+u[0]-2*c[0],h[1]+u[1]-2*c[1]],g=[m[0]+f[0],m[1]+f[1]],_=Math.abs((g[0]*g[0]+g[1]*g[1])/(m[0]*f[0]+m[1]*f[1]));m=[h[0]-a[0]+c[0]-u[0],h[1]-a[1]+c[1]-u[1]],f=[u[0]-a[0]+c[0]-h[0],u[1]-a[1]+c[1]-h[1]];var v=Math.abs(m[0]*f[1]-m[1]*f[0]);if(0===e&&1===r||(.25+5*_)*v>i*i){var y=(e+r)/2,L=(o+s)/2,x=n.transformProjectiveVector([y,L,1]),b=n.transformProjectiveVector([y,o,1]),P=n.transformProjectiveVector([y,s,1]),C=n.transformProjectiveVector([e,L,1]),w=n.transformProjectiveVector([r,L,1]);return d--,l.call(this,e,o,y,L,a,b,C,x,d,p),l.call(this,y,o,r,L,b,h,x,w,d,p),l.call(this,e,L,y,s,C,x,u,P,d,p),l.call(this,y,L,r,s,x,w,P,c,d,p),void 0}}var T=p.ctx,M=[h[0]-a[0],h[1]-a[1]],S=[c[0]-h[0],c[1]-h[1]],D=[u[0]-c[0],u[1]-c[1]],I=[a[0]-u[0],a[1]-u[1]],k=Math.abs(M[0]*I[1]-M[1]*I[0]),E=Math.abs(S[0]*M[1]-S[1]*M[0]),A=Math.abs(D[0]*S[1]-D[1]*S[0]),O=Math.abs(I[0]*D[1]-I[1]*D[0]),R=Math.max(Math.max(k,E),Math.max(O,A)),N=0,U=0,B=0,z=0;R===k?(T.setTransform(M[0],M[1],-I[0],-I[1],a[0]+p.deltaX,a[1]+p.deltaY),1!==r&&(B=1.05/Math.sqrt(M[0]*M[0]+M[1]*M[1])),1!==s&&(z=1.05/Math.sqrt(I[0]*I[0]+I[1]*I[1]))):R===E?(T.setTransform(M[0],M[1],S[0],S[1],h[0]+p.deltaX,h[1]+p.deltaY),1!==r&&(B=1.05/Math.sqrt(M[0]*M[0]+M[1]*M[1])),1!==s&&(z=1.05/Math.sqrt(S[0]*S[0]+S[1]*S[1])),N=-1):R===A?(T.setTransform(-D[0],-D[1],S[0],S[1],c[0]+p.deltaX,c[1]+p.deltaY),1!==r&&(B=1.05/Math.sqrt(D[0]*D[0]+D[1]*D[1])),1!==s&&(z=1.05/Math.sqrt(S[0]*S[0]+S[1]*S[1])),N=-1,U=-1):R===O&&(T.setTransform(-D[0],-D[1],-I[0],-I[1],u[0]+p.deltaX,u[1]+p.deltaY),1!==r&&(B=1.05/Math.sqrt(D[0]*D[0]+D[1]*D[1])),1!==s&&(z=1.05/Math.sqrt(I[0]*I[0]+I[1]*I[1])),U=-1);var F=r-e,Z=s-o;B++,z++;var H=p.imageObj.width,G=p.imageObj.height,j=Math.floor(e*H),K=Math.floor(o*G),V=Math.floor(Math.min(B*F,1)*H),W=Math.floor(Math.min(z*Z,1)*G);t++,T.drawImage(p.imageObj,j,K,V,W,N,U,B,z)};this.getCanvas=function(o){t=0,n=a(o.points);var r=n.transformProjectiveVector([0,0,1]),s=n.transformProjectiveVector([1,0,1]),h=n.transformProjectiveVector([0,1,1]),c=n.transformProjectiveVector([1,1,1]),d=document.createElement("canvas");d.width=d.height=256,o.canvas=d,o.ctx=d.getContext("2d");var p=u.bounds([r,s,c,h]),m=Math.max(p.max.x-p.min.x,p.max.y-p.min.y);e="limit"in o?o.limit:200>m?1:4,i="patchSize"in o?o.patchSize:m/8;try{l(0,0,1,1,r,s,h,c,e,o)}catch(f){console.log("Error: ProjectiveImage event:",f),d=null}return{canvas:d,ptl:r,ptr:s,pbl:h,pbr:c,cnt:t}}},r=function(t){var e=256,i={outline:{color:255,thickness:1},marker:{size:8}},o=["MinZoom","MaxZoom","Balloon","BalloonEnable","DisableBalloonOnMouseMove","DisableBalloonOnClick"],r=0,s=0,a=[],l=[],h=L.gmx.Parsers,c=u,d=this;this.deferred=new L.gmx.Deferred;var p=function(t){var e=!0;if("step"in t&&"string"==typeof t.step&&(t.patternStepFunction=h.parseExpression(t.step),e=!1),"width"in t&&"string"==typeof t.width&&(t.patternWidthFunction=h.parseExpression(t.width),e=!1),"colors"in t){for(var i=[],n=0,o=t.colors.length;o>n;n++){var r=t.colors[n];"string"==typeof r?(i.push(h.parseExpression(r)),e=!1):i.push(null)}t.patternColorsFunction=i}return e},m=function(e){var i=e.iconUrl||e.fillIconUrl,o=e.iconAngle||e.iconAngle?{crossOrigin:"anonymous"}:{};o.layerID=t.layerID,s++,n.unshift(i,o).then(function(t){e.version=++r,e.fillIconUrl?e.imagePattern=t:(e.maxSize=Math.max(t.width,t.height),e.sx=t.width,e.sy=t.height,e.image=t),s--,d._chkReady()},function(){e.version=++r,e.sx=1,e.sy=0,e.image=null,s--,d._chkReady(),console.log({url:i,func:"getImageSize",Error:"image not found"})})},f=function(t){var e=!0,i=0,n=["r1","x1","y1","r2","x2","y2"],o=n.length;for(i=0;o>i;i++){var r=n[i];t[r]||(t[r]=0),"string"==typeof t[r]&&(t[r+"Function"]=h.parseExpression(t[r]),e=!1)}for(t.addColorStop=t.addColorStop||[[0,16711680,.5],[1,16777215,.5]],t.addColorStopFunctions=[],i=0,o=t.addColorStop.length;o>i;i++){n=t.addColorStop[i];var s=["string"==typeof n[0]?h.parseExpression(n[0]):null,"string"==typeof n[1]?h.parseExpression(n[1]):null,"string"==typeof n[2]?h.parseExpression(n[2]):null];t.addColorStopFunctions.push(s),null===s[1]&&null===s[2]?n[3]=c.dec2color(n[1],n[2]>1?n[2]/100:n[2]):e=!1}return"r2Function"in t&&(e=!1),e?Math.max(t.r1,t.r2):null},g=function(t){var e=!0,i=0,n=["x1","y1","x2","y2"],o=[0,0,0,256],r=n.length;for(i=0;r>i;i++){var s=n[i];s in t?"string"==typeof t[s]&&(t[s+"Function"]=h.parseExpression(t[s]),e=!1):t[s]=o[i]}for(t.addColorStop=t.addColorStop||[[0,16711680],[1,16777215]],t.addColorStopFunctions=[],i=0,r=t.addColorStop.length;r>i;i++)n=t.addColorStop[i],t.addColorStopFunctions.push(["string"==typeof n[0]?h.parseExpression(n[0]):null,"string"==typeof n[1]?h.parseExpression(n[1]):null,"string"==typeof n[2]?h.parseExpression(n[2]):null]);return e},_=function(t,e){if(t){for(var i in t)if(u.styleFuncKeys[i]){var n=u.styleFuncKeys[i],o=t[i];"string"==typeof o?t[n]=e&&e[i]===o?e[n]:h.parseExpression(o):"function"==typeof o&&(t[n]=o)}t.common=!0;var r="";if("iconUrl"in t)r="image",t.iconUrl&&(t.maxSize=256,a.push(t));else if(t.fillIconUrl)r="square",a.push(t);else if(t.fillPattern)r="square",t.common=p(t.fillPattern),t.canvasPattern=c.getPatternIcon(null,t);else if(t.iconCircle)r="circle","iconSize"in t||(t.iconSize=4);else if(t.fillRadialGradient){r="circle";var s=f(t.fillRadialGradient);null===s?t.common=!1:t.iconSize=s}else t.fillLinearGradient?(r="square",t.common=g(t.fillLinearGradient)):t.iconSize&&(r="square");t.type=r,t.common&&!t.maxSize&&(t.maxSize=t.iconSize||0,t.maxSize+=t.weight?t.weight:0,"iconScale"in t&&(t.maxSize*=t.iconScale))}return t},v=function(e,i){i=i||{};var n,o,r,s={},a=t.tileAttributeIndexes,l=e.properties||{},h=e.type,d=i.type,p=i.color||255,m="opacity"in i?i.opacity:1;if(s.sx=i.sx,s.sy=i.sy,i.maxSize&&(s.maxSize=i.maxSize),"image"===d){if(s.type=d,i.iconUrl&&(s.iconUrl=i.iconUrl),i.image&&(s.image=i.image),i.iconAngle){var f=i.iconAngle||0;f&&"string"==typeof f&&(f=i.rotateFunction?i.rotateFunction(l,a):0),s.rotate=f||0}"iconColor"in i&&(s.iconColor="iconColorFunction"in i?i.iconColorFunction(l,a):i.iconColor),"iconScale"in i&&(s.iconScale="scaleFunction"in i?i.scaleFunction(l,a):i.iconScale)}else if(i.fillRadialGradient){var g=i.fillRadialGradient,_=g.r1Function?g.r1Function(l,a):g.r1,v=g.r2Function?g.r2Function(l,a):g.r2,y=g.x1Function?g.x1Function(l,a):g.x1,L=g.y1Function?g.y1Function(l,a):g.y1,x=g.x2Function?g.x2Function(l,a):g.x2,b=g.y2Function?g.y2Function(l,a):g.y2;g.r2max&&(v=Math.min(v,g.r2max));var P=[];for(r=g.addColorStop.length,g.addColorStopFunctions||(g.addColorStopFunctions=new Array(r)),o=0;r>o;o++){n=g.addColorStop[o];var C=g.addColorStopFunctions[o]||[],w=C[0]?C[0](l,a):n[0],T=n[3];if(n.length<4){var M=n.length<3?1:C[2]?C[2](l,a):n[2];T=c.dec2color(C[1]?C[1](l,a):n[1],M)}P.push([w,T])}s.maxSize=s.sx=s.sy=s.iconSize=v,s.fillRadialGradient={x1:y,y1:L,r1:_,x2:x,y2:b,r2:v,addColorStop:P},s._radialGradientParsed={create:[y,L,_,x,b,v],colorStop:P}}else if(i.fillLinearGradient)s.fillLinearGradient=i.fillLinearGradient;else{if(i.fillPattern&&(s.canvasPattern=i.canvasPattern?i.canvasPattern:c.getPatternIcon(e,i,a)),("POLYGON"===h||"MULTIPOLYGON"===h||"polygon"===t.GeometryType)&&(d="polygon"),i.iconSize){var S="sizeFunction"in i?i.sizeFunction(l,a):i.iconSize;s.sx=s.sy=S,S+=i.weight?i.weight:0,s.iconSize=S,"iconScale"in i&&(s.iconSize*=i.iconScale),s.maxSize=S}s.stroke=!0,("colorFunction"in i||"opacityFunction"in i)&&(p="colorFunction"in i?i.colorFunction(l,a):p,m="opacityFunction"in i?i.opacityFunction(l,a):m),s.strokeStyle=c.dec2color(p,m),s.lineWidth="weight"in i?i.weight:1}if("iconScale"in i&&(s.iconScale="scaleFunction"in i?i.scaleFunction(l,a):i.iconScale),"square"===d||"polygon"===d||"circle"===d){s.type=d;var D=i.fillOpacity,I=i.fillColor,k="string"==typeof I?parseInt(I.replace(/#/,""),16):I;"fillColor"in i&&(s.fillStyle=c.dec2color(k,1)),"fillColorFunction"in i||"fillOpacityFunction"in i?(p="fillColorFunction"in i?i.fillColorFunction(l,a):I||255,m="fillOpacityFunction"in i?i.fillOpacityFunction(l,a):D||1,s.fillStyle=c.dec2color(p,m)):"fillOpacity"in i&&"fillColor"in i&&(s.fillStyle=c.dec2color(k,D))}if("dashArray"in i&&(s.dashArray=i.dashArray),"dashOffset"in i&&(s.dashOffset=i.dashOffset),t.labelsLayer)for(n=c.styleKeys.label.client,o=0,r=n.length;r>o;o++){var E=n[o];if(E in i){if("labelField"===E){if(!a[i[E]])continue}else if("labelTemplate"===E){var A=u.getPropertiesHash(l,a);s.labelText=c.parseTemplate(i[E],A)}s[E]=i[E]}}return s},y=function(t){var e={MinZoom:t.MinZoom||0,MaxZoom:t.MaxZoom||50,Filter:t.Filter||null,Balloon:t.Balloon||"",RenderStyle:t.RenderStyle?_(L.gmxUtil.fromServerStyle(t.RenderStyle)):{},version:++r};if(e.DisableBalloonOnMouseMove=t.DisableBalloonOnMouseMove===!1?!1:!0,e.DisableBalloonOnClick=t.DisableBalloonOnClick||!1,t.HoverStyle&&(e.HoverStyle=_(L.gmxUtil.fromServerStyle(t.HoverStyle),e.RenderStyle)),"Filter"in t){var i=h.parseSQL(t.Filter.replace(/[\[\]]/g,'"'));i&&(e.filterFunction=i)}return e},x=function(e){var i=t.tileAttributeIndexes;return e&&(e.labelTemplate||e.labelField&&e.labelField in i)},b=function(t,e){for(var i in t)if(t[i]!==e[i])return i;return null},P=function(){for(var e=!1,i=!1,n=0,o=l.length;o>n;n++){var r=l[n];r.DisableBalloonOnMouseMove=r.DisableBalloonOnMouseMove===!1?!1:!0,r.DisableBalloonOnClick=r.DisableBalloonOnClick||!1,(r.DisableBalloonOnMouseMove===!1||r.DisableBalloonOnClick===!1)&&(e=!0,r.BalloonEnable=!0),r.hoverDiff=null,r.common={},r.RenderStyle&&(i||x(r.RenderStyle)&&(i=!0),r.RenderStyle.common&&(r.common.RenderStyle=v({},r.RenderStyle)),r.HoverStyle&&(r.hoverDiff=b(r.RenderStyle,r.HoverStyle))),r.HoverStyle&&r.HoverStyle.common&&(r.common.HoverStyle=v({},r.HoverStyle))}t.balloonEnable=e,t.labelsLayer=i},C=function(){for(var e=t.properties,n=e.styles||[{RenderStyle:i}],o=Math.max(n.length,t.styles.length),r=0;o>r;r++){var s=t.styles[r]||n[r];if(s.RenderStyle||(s.RenderStyle=i),void 0===s.HoverStyle){var a=JSON.parse(JSON.stringify(s.RenderStyle));a.marker&&a.marker.size&&(a.marker.size+=1),a.outline&&(a.outline.thickness+=1),s.HoverStyle=a}else null===s.HoverStyle&&delete s.HoverStyle;var h=y(s);l.push(h),x(h.RenderStyle)&&(t.labelsLayer=!0)}P()};C();var w=function(t){var e={};for(var i in u.styleKeys)for(var n=u.styleKeys[i],o=0,r=n.client.length;r>o;o++){var s=n.client[o];s in t&&(e[s]=JSON.parse(JSON.stringify(t[s])),"fillPattern"===s&&delete e[s].patternColorsFunction,"fillLinearGradient"===s&&delete e[s].addColorStopFunctions)}return e};this.getStyles=function(){for(var t=[],e=0,i=l.length;i>e;e++){var n=L.extend({},l[e]);n.RenderStyle=w(n.RenderStyle),n.HoverStyle&&(n.HoverStyle=w(n.HoverStyle)),delete n.filterFunction,delete n.version,delete n.common,delete n.type,t.push(n)}return t},this.clearStyles=function(){l=[],t.balloonEnable=!1,t.labelsLayer=!1},this.setStyle=function(t,e,i){if(e=e||0,e<l.length||i){var n=l[e];if(n||(n=y({}),l[e]=n),this.deferred=new L.gmx.Deferred,n.version=++r,"Filter"in t){n.Filter=t.Filter;var s=typeof t.Filter;n.filterFunction="string"===s?h.parseSQL(n.Filter.replace(/[\[\]]/g,'"')):"function"===s?n.Filter:null}for(var a=0,u=o.length;u>a;a++){var c=o[a];c in t&&(n[c]=t[c])}t.RenderStyle&&(n.RenderStyle=_(t.RenderStyle)),t.HoverStyle&&(n.HoverStyle=_(t.HoverStyle,n.RenderStyle)),P(),this.initStyles()}};var T=function(e){var i=t.currentZoom,n=t.multiFilters?-1:e.currentFilter,o=l[n],r=!o||o.version!==e.styleVersion;if(r||e._lastZoom!==i){var s=e.properties,a=t.tileAttributeIndexes;e.currentFilter=-1,e.multiFilters=[];for(var h=0,u=l.length;u>h;h++){var c=l[h];if(!(i>c.MaxZoom||i<c.MinZoom||c.filterFunction&&!c.filterFunction(s,a))){if(e.hoverDiff=c.hoverDiff,e.currentFilter=h,r||n!==h){var d=c.common&&c.common.RenderStyle||v(e,c.RenderStyle),p=null;e.parsedStyleKeys=d,c.HoverStyle&&(p=c.common&&c.common.HoverStyle||v(e,c.HoverStyle),e.parsedStyleHover=p),t.multiFilters&&e.multiFilters.push({style:c.RenderStyle,styleHover:c.HoverStyle,parsedStyle:d,parsedStyleHover:p})}if(e.styleVersion=c.version,!t.multiFilters)break}}e._lastZoom=i}return l[e.currentFilter]?!0:(e.currentFilter=-1,!1)};t.dataManager.addFilter("styleFilter",T),this.getItemBalloon=function(e){var i=t.dataManager.getItem(e),n=l[i.currentFilter];return n?{DisableBalloonOnMouseMove:n.DisableBalloonOnMouseMove||!1,DisableBalloonOnClick:n.DisableBalloonOnClick||!1,templateBalloon:n.Balloon||null}:null},this.applyStyleHook=function(e,i){return v(e,t.styleHook(e,i))},this.getObjStyle=function(e){T(e);var i,n=l[e.currentFilter];return n?n.hoverDiff&&t.lastHover&&e.id===t.lastHover.id?n.HoverStyle?(i=n.HoverStyle.version||-1,i!==e.styleVersion&&(e.parsedStyleHover=v(e,n.HoverStyle)),n.HoverStyle):(delete e.parsedStyleHover,null):(i=n.version||-1,i!==e.styleVersion&&(e.parsedStyleKeys=v(e,n.RenderStyle)),n.RenderStyle):null};var M=function(i){i||(i=t.currentZoom);for(var n=0,o=0,r=l.length;r>o;o++){var a=l[o];if(!(i>a.MaxZoom||i<a.MinZoom)){var h=a.RenderStyle;if(s||!h||!h.common||!h.maxSize){n=e;break}n=Math.max(h.maxSize,n)}}return n||256};this._maxStyleSize=0,this.getStyleBounds=function(t){if(!t)return c.bounds();this._maxStyleSize=M();var e=2*this._maxStyleSize*c.tileSizes[t.z]/256;return c.getTileBounds(t.x,t.y,t.z).addBuffer(e)},this.isVisibleAtZoom=function(t){for(var e=0,i=l.length;i>e;e++){var n=l[e];if(t>=n.MinZoom&&t<=n.MaxZoom)return!0}return!1},this.getIcons=function(t){this.deferred.then(function(){for(var e=[],i=0,n=l.length;n>i;i++){var o=l[i],r={};o.RenderStyle&&(r.RenderStyle={image:o.RenderStyle.image}),o.HoverStyle&&(r.HoverStyle={image:o.HoverStyle.image}),e.push(r)}t&&t(e)}),this.initStyles()},this._chkReady=function(){1>s&&this.deferred.resolve()},this.initStyles=function(){for(var t=0,e=a.length;e>t;t++)m(a[t]);return a=[],this._chkReady(),this.deferred}};t.prototype={_loadTileRecursive:function(t,e){var i=this.gmx,o=null,r=new L.gmx.Deferred(function(){o&&o.cancel()}),s=function(t){var a=e(t),l=function(){t.z>1?s({x:Math.floor(t.x/2),y:Math.floor(t.y/2),z:t.z-1}):r.reject()};return i.badTiles[a]?(l(),void 0):(o=n.push(a,{layerID:i.layerID,zoom:t.z,crossOrigin:i.crossOrigin||"anonymous"}),o.then(function(e){o=null,t.image=e,r.resolve(t)},function(){i.badTiles[a]=!0,l()}),void 0)};return s(t),r},_getItemRasters:function(t){var e=t.properties,i=t.dataOption||{},o=e[0],r=this.gmx,s=this,a=this.rasters,l=this.gmxTilePoint,h=r.dataManager.getItem(o),c=null,d=new L.gmx.Deferred(function(){c.cancel()});if(o in a)return d.resolve(),d;var p=Number(r.shiftXfield?r.getPropItem(e,r.shiftXfield):0)%this.worldWidthMerc,m=Number(r.shiftYfield?r.getPropItem(e,r.shiftYfield):0),f=r.getPropItem(e,"GMX_RasterCatalogID"),g=r.getPropItem(e,"urlBG"),_="",v=null,y=!1;if(r.IsRasterCatalog?!f&&r.quicklookBGfunc?(_=r.quicklookBGfunc(h),v=r.imageQuicklookProcessingHook):y=!0:g&&(_=g,v=r.imageQuicklookProcessingHook),y){var x=[{z:l.z,x:l.x,y:l.y}];if(p||m){var b=i.bounds,P=256/r.mInPixel,C=p*r.mInPixel,w=m*r.mInPixel,T=Math.floor(.5+C%256),M=Math.floor(.5+w%256),S=l.x-p/P,D=l.y-m/P,I=Math.floor(S),k=I+(S===I?0:1),E=Math.floor(D),A=E+(D===E?0:1),O=Math.floor((b.min.x-p)/P),R=Math.floor((b.max.x-p)/P),N=Math.floor((b.min.y-m)/P),U=Math.floor((b.max.y-m)/P);x=[],O>I&&(I=O),k>R&&(k=R),N>E&&(E=N),A>U&&(A=U);for(var B=E;A>=B;B++)for(var z=I;k>=z;z++)x.push({z:l.z,x:z,y:B,dx:T,dy:M,tx:S,ty:D})}var F=function(){for(var e=[],i=new L.gmx.Deferred(function(){for(var t=0;t<e.length;t++)e[t].cancel()}),n=x.length,o=n,a=function(){1>o&&i.resolve(x)},c=function(){o--,a()},d=function(t){return r.rasterBGfunc(t.x,t.y,t.z,h)},p=function(e,i){var n=e.image;if(!n)return c(),void 0;var s={gmx:r,geoItem:t,item:h,gmxTilePoint:e},d=function(t){if(o--,v&&(t=v(t,s)),e.z!==l.z){var n=u.getTilePosZoomDelta(l,l.z,e.z);if(n.size<1/256)return a(),void 0;var r=document.createElement("canvas");r.width=r.height=256;var h=r.getContext("2d");h.drawImage(t,Math.floor(n.x),Math.floor(n.y),n.size,n.size,0,0,256,256),i.resImage=r}else i.resImage=t;a()};if(h.skipRasters=!1,r.imageProcessingHook){var p=r.imageProcessingHook(n,{layerID:r.layerID,id:h.id,gmxTilePoint:e});if(!p)return h.skipRasters=!0,c(),void 0;if(!(p instanceof HTMLCanvasElement||p instanceof HTMLImageElement))return p.then(d,c),void 0;n=p}d(n)},m=0;n>m;m++){var f=x[m],g=s._loadTileRecursive(f,d);g.then(function(t){p(t,f)},c),e.push(g)}return i};c=F(),c.then(function(t){var e=t.length;if(e)if(0===p&&0===m)t[0].resImage&&(a[o]=t[0].resImage);else{var i=document.createElement("canvas");i.width=256,i.height=256;for(var n=i.getContext("2d"),r=0,s=0;e>s;s++){var l=t[s];if(l.resImage){var h=l.dx+(l.dx<0?256:0),u=l.dy+(l.dy<0?256:0),c=0,f=256-h,g=h,_=f;if(l.tx>l.x&&(c=f,f=h,g=0,_=f),256===c||1>f)continue;var v=u,y=256-u,L=0,x=y;if(l.ty>l.y&&(v=0,L=y,y=u,x=y),256===v||1>y)continue;n.drawImage(l.resImage,c,v,f,y,g,L,_,x),r++}}1>r&&(i=null),a[o]=i}d.resolve()})}else c=n.push(_,{layerID:r.layerID,crossOrigin:r.crossOrigin||""}),c.then(function(e){var i={gmx:r,geoItem:t,item:h,gmxTilePoint:l},n=function(t){a[o]=v?v(t,i):t,d.resolve()};if(r.imageProcessingHook){var s=r.imageProcessingHook(e,{layerID:r.layerID,id:h.id,gmxTilePoint:l});if(!s)return h.skipRasters=!0,d.resolve(),void 0;if(!(s instanceof HTMLCanvasElement||s instanceof HTMLImageElement))return s.then(n,d.resolve),void 0;e=s}n(e)},d.resolve);return d},_getTileRasters:function(t){var e=this.gmx,i=this,n=this.tbounds,o=null,r=new L.gmx.Deferred(function(){o.forEach(function(t){t&&t.cancel()})}),s=0,a=function(){1>s&&r.resolve()};return o=t.map(function(t){var o=t.dataOption||{},r=!1;if(e.styleHook){var l=t.properties[0];t.styleExtend=e.styleHook(e.dataManager.getItem(l),e.lastHover&&l===e.lastHover.id),r=t.styleExtend.skipRasters}if(!r&&n.intersectsWithDelta(o.bounds,-1,-1)){var h=!0,u=t.properties[t.properties.length-1];if("POLYGON"!==u.type||n.clipPolygon(u.coordinates[0]).length||(h=!1),h){s++;var c=i._getItemRasters(t);return c.then(function(){s--,a()}),c}}}),a(),r},drawTile:function(t){this.currentDrawDef&&this.currentDrawDef.cancel();var e=null,i=this.gmx,n=this,o=new L.gmx.Deferred(function(){e&&e.cancel(),n.rasters={}});if(o.always(function(){n.currentDrawDef=null}),this.currentDrawDef=o,!this.layer._map)return o.resolve(),o;var r=t.added,s=r.length;if(0===s)return this.tKey in this.layer._tiles&&this.layer._tiles[this.tKey].getContext("2d").clearRect(0,0,256,256),o.resolve(),o;var a=this.layer.gmxGetCanvasTile(this.tilePoint),l=a.getContext("2d"),h={tbounds:this.tbounds,rasters:n.rasters,gmx:i,tpx:this.tpx,tpy:this.tpy,ctx:l};a.zKey=this.zKey,i.sortItems&&(r=i.objectsReorder.getSortedItems(r));var u=function(){l.clearRect(0,0,256,256);for(var t=0;s>t;t++)L.gmxUtil.drawGeoItem(r[t],h);n.rasters={},n.layer._map&&n.layer.appendTileToContainer(a);var e=new L.gmx.Deferred,u={x:n.tilePoint.x,y:n.tilePoint.y,z:n.zoom};e.resolve(a,u),i.renderHooks.forEach(function(t){e=e.then(function(e){return t(e,u)})}),e.then(o.resolve,o.reject)};return this.showRaster?(e=n._getTileRasters(r),e.then(u,o.reject.bind(o))):u(),o},cancel:function(){this.currentDrawDef&&this.currentDrawDef.cancel()}};var s=function(t,e,i,n,o,r,a,l){var h=null,c=this;this.addData=function(t,e){this.removeData(e,!0);for(var i=t.length,n=new Array(i),o=0;i>o;o++){var r=t[o];n[o]=u.geoItemBounds(r[r.length-1])}this.data=this.data.concat(t),this.dataOptions=this.dataOptions.concat(n),this.state="loaded",h&&h.resolve(this.data)},this.removeData=function(t){for(var e=this.data||[],i=e.length-1;i>=0;i--)t[e[i][0]]&&(e.splice(i,1),this.dataOptions.splice(i,1))},this.load=function(){return h||(h=new L.gmx.Deferred,this.state="loading",t.load(e,i,n,o,r,a,function(t){c.addData(t)})),h},this.clear=function(){this.state="notLoaded",this.data=[],this.dataOptions=[],h=null},this.calcEdgeLines=function(t){if(!this.data[t])return null;this.dataOptions[t]||(this.dataOptions[t]={});var e=this.dataOptions[t].hiddenLines||null;if(!e){var i=this.data[t],n=i.length-1,o=i[n];if(-1!==o.type.indexOf("POLYGON")){var r=o.coordinates;"POLYGON"===o.type&&(r=[r]);for(var s=u.bounds().extendBounds(this.bounds).addBuffer(-.05),a=0,l=r.length;l>a;a++){for(var h=r[a],c=[],d=0,p=h.length;p>d;d++)c.push(u.getHidden(h[d],s));c.length&&(e||(e=[]),e.push(c))}e&&(this.dataOptions[t]||(this.dataOptions[t]={}),this.dataOptions[t].hiddenLines=e)}}return e},this.bounds=u.getTileBounds(e,i,n),this.data=[],this.dataOptions=[],this.x=e,this.y=i,this.z=n,this.s=r,this.d=a,this.gmxTilePoint={x:e,y:i,z:n,s:r,d:a},this.vectorTileKey=s.makeTileKey(e,i,n,o,r,a),this.s>=0&&l&&(this.beginDate=new Date(l.valueOf()+1e3*this.s*this.d*u.oneDay),this.endDate=new Date(l.valueOf()+1e3*(this.s+1)*this.d*u.oneDay)),this.state="notLoaded"};s.makeTileKey=function(t,e,i,n,o,r){return i+"_"+t+"_"+e+"_"+n+"_"+o+"_"+r},s.parseTileKey=function(t){var e=t.split("_");return{z:e[0],x:e[1],y:e[2],v:e[3],s:e[4],d:e[5]}},s.boundsFromTileKey=function(t){var e=s.parseTileKey(t);return u.getTileBounds(e.x,e.y,e.z)};var a=function(t,e){var i=[];this.initFromTiles=function(n){var o,r,s=function(i,n,o){var r=i.d;if(n.d===t[r])return i.count++,i.tiles.push(o),void 0;var a=t[r]/t[r-1];"children"in i||(i.children=new Array(a));var l=Math.floor(n.s*n.d/t[r-1]),h=l-i.s*a;i.children[h]||(i.children[h]={d:r-1,s:l,t1:l*t[r-1]*u.oneDay+e,t2:(l+1)*t[r-1]*u.oneDay+e,count:0,tiles:[]}),s(i.children[h],n,o)},a=Number.MAX_VALUE,l=t.length-1;for(o in n)r=n[o].tile,r.d===t[l]&&(a=Math.min(a,r.s));i=[];for(o in n)if(r=n[o].tile,!(r.d<0)){var h=Math.floor(r.s*r.d/t[l])-a,c=h+a;i[h]=i[h]||{d:l,s:c,t1:c*t[l]*u.oneDay+e,t2:(c+1)*t[l]*u.oneDay+e,count:0,tiles:[]},s(i[h],r,o)}},this.selectTiles=function(t,e){for(var n=t.valueOf()/1e3,o=e.valueOf()/1e3,r=function(t,e,i){if(e>=t.t2||i<=t.t1)return{count:0,tiles:[],nodes:[]};if(0===t.d)return{tiles:t.tiles,count:t.count,nodes:[t]};var n,o=0,s=[];for(n=0;n<t.children.length;n++)s[n]=t.children[n]?r(t.children[n],Math.max(e,t.t1),Math.min(i,t.t2)):{count:0,tiles:[],nodes:[]},o+=s[n].count;if(o<t.count){var a=[],l=[];for(n=0;n<s.length;n++)l.push(s[n].nodes),a.push(s[n].tiles);return{tiles:[].concat.apply([],a),count:o,nodes:[].concat.apply([],l)}}return{tiles:t.tiles,count:t.count,nodes:[t]}},s=[],a=[],l=0;l<i.length;l++)if(i[l]){var h=r(i[l],n,o);s=s.concat(h.tiles),a=a.concat(h.nodes)}for(var u={},c=0;c<s.length;c++)u[s[c]]=!0;return{tiles:u,nodes:a}},this.getNode=function(e,n){if(0>e||0>n)return null;for(var o=function(e,i,n){if(!e)return null;if(t[e.d]===i)return e.s===n?e:null;var r=t[e.d]/t[e.d-1],s=Math.floor(n*i/t[e.d-1]),a=s-e.s*r;return e.children[a]?o(e.children[a],i,n):null},r=0;r<i.length;r++){var s=o(i[r],e,n);if(s)return s}return null}},l=L.Class.extend({includes:L.Mixin.Events,initialize:function(t){var e=this,i=t.properties.Temporal;this._tilesTree=null,this._activeTileKeys={},this._endDate=null,this._beginDate=null,this._gmx=t,this._isTemporalLayer=i,this._tiles={},this._filters={},this._freeSubscrID=0,this._items={},this._observers={},this._needCheckDateInterval=!1,this._needCheckActiveTiles=!0,this._processingTileKey=s.makeTileKey(-.5,-.5,0,0,-1,-1),this._vectorTileDataProvider={load:function(t,i,n,o,r,s,a){b.load(e._gmx.tileSenderPrefix,{x:t,y:i,z:n,v:o,s:r,d:s,layerID:e._gmx.layerID}).then(a,function(){console.log("Error loading vector tile"),a([]),e.fire("chkLayerUpdate",{dataProvider:e})})}},i&&this.addFilter("TemporalFilter",function(t,e,i){var n=t.options.unixTimeStamp,o=i.dateInterval;return o&&n>=o.beginDate.valueOf()&&n<=o.endDate.valueOf()})},_getActiveTileKeys:function(){if(this._chkMaxDateInterval(),!this._needCheckActiveTiles)return this._activeTileKeys;this._needCheckActiveTiles=!1;var t=this._gmx.properties.Processing;if(t&&(this._chkProcessing(t),delete this._gmx.properties.Processing),this._isTemporalLayer){var e={};this._beginDate&&this._endDate&&(this._tilesTree||this.initTilesTree(this._gmx.properties),e=this._tilesTree.selectTiles(this._beginDate,this._endDate).tiles),this._updateActiveTilesList(e)}else this.initTilesList(this._gmx.properties);return this._activeTileKeys},addFilter:function(t,e){this._filters[t]=e,this._triggerObservers()},removeFilter:function(t){this._filters[t]&&(delete this._filters[t],this._triggerObservers())},getItems:function(t){var e=[],i=this._observers[t];if(!i)return[];var n=i.filters.concat("processingFilter");this._isTemporalLayer&&n.push("TemporalFilter");var o=this,r=function(t){var r=t.data;if(r&&(0===t.z||i.intersectsWithTile(t)))for(var s=0,a=r.length;a>s;s++){var l=t.dataOptions[s];if(i.intersects(l.bounds)){for(var h=r[s],u=h[0],c=o.getItem(u),d=h[h.length-1],p=!1,m=0;m<n.length;m++){var f=o._filters[n[m]];if(f&&!f(c,t,i,d)){p=!0;
break}}if(!p){var g=d.type;("POLYGON"===g||"MULTIPOLYGON"===g)&&t.calcEdgeLines(s),e.push({id:u,properties:h,item:c,dataOption:l})}}}},s=this._getActiveTileKeys();for(var a in s)r(o._tiles[a].tile);return e},_updateItemsFromTile:function(t){for(var e=t.vectorTileKey,i=this._gmx.properties,n=t.data,o=n.length,r=n[0]&&n[0].length-1,s=0;o>s;s++){for(var a=n[s],l=a[r],h=a[0],u=this._items[h],c=0,d=a.length;d>c;c++)null===a[c]&&(a[c]="");if(u?(-1===u.type.indexOf("MULTI")&&(u.type="MULTI"+u.type),delete u.bounds):(u={id:h,type:l.type,options:{fromTiles:{}}},this._items[h]=u),u.properties=a,u.options.fromTiles[e]=s,i.TemporalColumnName){var p=a[this._gmx.tileAttributeIndexes[i.TemporalColumnName]];u.options.unixTimeStamp=1e3*p}}return o},_getNotLoadedTileCount:function(t){var e=0,i=this._getActiveTileKeys();for(var n in i){var o=this._tiles[n].tile;"loaded"!==o.state&&t.intersectsWithTile(o)&&e++}return e},_loadTiles:function(t){var e=0,i=this,n=this._getActiveTileKeys();for(var o in n)!function(n){t.intersectsWithTile(n)&&("notLoaded"===n.state&&(i.fire("beforetileload"),n.load().then(function(){if(i._updateItemsFromTile(n),i._tilesTree){var t=i._tilesTree.getNode(n.d,n.s);t&&t.count--}var e=i._observers;for(var o in e){var r=e[o];r.intersectsWithTile(n)&&0===i._getNotLoadedTileCount(r)&&r.updateData(i.getItems(o))}})),"loaded"!==n.state&&e++)}(this._tiles[o].tile);return e},_chkMaxDateInterval:function(){if(this._isTemporalLayer&&this._needCheckDateInterval){this._needCheckDateInterval=!1;var t=this._observers,e=null,i=null;for(var n in t){var o=t[n],r=o.dateInterval;r&&((!e||r.beginDate<e)&&(e=r.beginDate),(!i||r.endDate>i)&&(i=r.endDate))}e&&i&&(this._beginDate!==e||this._endDate!==i)&&(this._beginDate=e,this._endDate=i,this._needCheckActiveTiles=!0)}},addObserver:function(t,e){e=e||"s"+this._freeSubscrID++;var i=this,n=new h(t);return n.id=e,n.needRefresh=!0,n.on("update",function(t){n.needRefresh=!0,t.temporalFilter&&(i._needCheckDateInterval=!0),i._waitCheckObservers()}).on("activate",function(){i.fire("observeractivate"),n.isActive()&&n.needRefresh&&i.checkObserver(n)}),i._needCheckDateInterval=!0,this._observers[e]=n,this._waitCheckObservers(),n.isActive()&&this.fire("observeractivate"),n},getActiveObserversCount:function(){var t=0;for(var e in this._observers)this._observers[e].isActive()&&t++;return t},getObserver:function(t){return this._observers[t]},removeObserver:function(t){if(this._observers[t]){var e=this._observers[t].isActive();delete this._observers[t],e&&this.fire("observeractivate")}},getItem:function(t){var e=this._items[t];if(e&&!e.bounds){var i=e.options.fromTiles,n=[];for(var o in i)if(this._tiles[o]){var r=this._tiles[o].tile.dataOptions,s=i[o];n.push(r[s].bounds)}if(1===n.length)e.bounds=n[0];else{e.bounds=u.bounds();for(var a=u.worldWidthMerc,l=0,h=n.length;h>l;l++){var c=n[l];e.bounds.max.x-c.min.x>a&&(c=u.bounds([[c.min.x+2*a,c.min.y],[c.max.x+2*a,c.max.y]])),e.bounds.extendBounds(c)}}}return e},getItemMembers:function(t){var e=this._items[t].options.fromTiles,i=[];for(var n in e)if(this._tiles[n])for(var o=this._tiles[n].tile,r=o.data,s=0,a=r.length;a>s;s++){var l=r[s];if(t===l[0]){var h=o.dataOptions[s],u=h.bounds;i.push({geo:l[l.length-1],width:u.max.x-u.min.x,dataOption:h});break}}return i.sort(function(t,e){return e.width-t.width})},getItemGeometries:function(t){var e=this._items[t].options.fromTiles,i=[];for(var n in e)if(this._tiles[n])for(var o=this._tiles[n].tile.data,r=0,s=o.length;s>r;r++){var a=o[r];if(t===a[0]){i.push(a[a.length-1]);break}}return i},addTile:function(t){this._tiles[t.vectorTileKey]={tile:t},this._getActiveTileKeys()[t.vectorTileKey]=!0,this.checkObservers()},checkObserver:function(t){if(t.needRefresh&&t.isActive()&&(t.needRefresh=!1,0===this._loadTiles(t))){var e=this.getItems(t.id);t.updateData(e)}},checkObservers:function(){var t=this._observers;for(var e in this._observers)this.checkObserver(t[e])},_waitCheckObservers:function(){this._checkObserversTimer&&clearTimeout(this._checkObserversTimer),this._checkObserversTimer=setTimeout(L.bind(this.checkObservers,this),0)},_triggerObservers:function(t){var e=t||this._observers;for(var i in e)this._observers[i].needRefresh=!0;this._waitCheckObservers()},_removeDataFromObservers:function(t){var e=this._observers;for(var i in e)this._observers[i].removeData(t);this._waitCheckObservers()},preloadTiles:function(t,i,n){var o={};this._isTemporalLayer?(this._tilesTree||this.initTilesTree(this._gmx.properties),o=this._tilesTree.selectTiles(t,i).tiles):(this._needCheckActiveTiles=!0,o=this._getActiveTileKeys());var r=this,s=[];for(var a in o){var l=this._tiles[a].tile;if("notLoaded"===l.state&&(!n||n.intersects(l.bounds))){var h=l.load();!function(t){h.then(function(){if(r._updateItemsFromTile(t),r._tilesTree){var e=r._tilesTree.getNode(t.d,t.s);e&&e.count--}})}(l),s.push(h)}}return e.all.apply(null,s)},_updateActiveTilesList:function(t){var e,i=this._activeTileKeys||{},n={},o=this,r=function(t){var e=s.boundsFromTileKey(t),i=o._observers;for(var r in i)e.intersects(i[r].bbox)&&(n[r]=!0)};for(e in t)i[e]||r(e);for(e in i)t[e]||r(e);this._activeTileKeys=t,this.clientSideTile&&(this._activeTileKeys[this.clientSideTile]=!0),this._triggerObservers(n)},_propertiesToArray:function(t){var e=t.properties,i=this._gmx.tileAttributeIndexes,n=[];for(var o in i)n[i[o]]=e[o];return n[n.length]=t.geometry,n[0]=t.id,n},_chkProcessing:function(t){var e,i,n,o,r=this._items,s=this.processingTile,a={};if(s){var l=this._processingTileKey;for(i=0,n=s.data.length;n>i;i++)if(o=s.data[i],e=o[0],r[e]){var h=r[e];h.processing=!1,delete h.options.fromTiles[l]}s.clear()}if(t.Deleted)for(i=0,n=t.Deleted.length;n>i;i++)e=t.Deleted[i],a[e]=!0,r[e]&&(r[e].processing=!0);var u={};if(t.Inserted)for(i=0,n=t.Inserted.length;n>i;i++)o=t.Inserted[i],a[o.id]||(u[o.id]=o);if(t.Updated)for(i=0,n=t.Updated.length;n>i;i++)o=t.Updated[i],a[o.id]||(u[o.id]=o);var c=[];for(e in u)this._items[e]&&(this._items[e].processing=!0),c.push(this._propertiesToArray(u[e]));c.length>0&&(s?this.addData(c):(this.processingTile=s=this.addData(c),this.addFilter("processingFilter",function(t,e){return 0===e.z||!t.processing}))),s&&this._triggerObservers()},updateVersion:function(){this._tilesTree=null,this._needCheckActiveTiles=!0,this._getActiveTileKeys()},_getDataKeys:function(t){for(var e={},i=0,n=t.length;n>i;i++)e[t[i][0]]=!0;return e},_getProcessingTile:function(){var t=-.5,e=-.5,i=0,n=0,o=-1,r=-1,a=s.makeTileKey(t,e,i,n,o,r),l=this._tiles[a];return l||(l=this._tiles[a]={tile:new s({load:function(t,e,i,n,o,r,s){s([])}},t,e,i,n,o,r)},this._gmx.mapName||(this.clientSideTile=a),this.addTile(l.tile)),l},addData:function(t){t||(t=[]);var e=this._getProcessingTile(),i=this._getDataKeys(t),n=e.tile;return n.addData(t,i),this._updateItemsFromTile(n),this._triggerObservers(),n},removeData:function(t){var e=this._getProcessingTile(),i=null;if(e){i=e.tile;var n={};if(!t||!t.length)return i;for(var o=0,r=t.length;r>o;o++){var s=t[o];n[s]=!0,delete this._items[s]}this._removeDataFromObservers(n),i.removeData(n,!0),this._updateItemsFromTile(i),this._triggerObservers()}return i},initTilesTree:function(t){for(var e=t.TemporalTiles||[],i=t.TemporalVers||[],n={},o=0,r=e.length;r>o;o++){var l=e[o],h=Number(l[4]),u=Number(l[3]),c=Number(l[2]),d=Number(l[1]),p=Number(l[0]),m=Number(i[o]),f=s.makeTileKey(c,u,h,m,d,p);n[f]=this._tiles[f]||{tile:new s(this._vectorTileDataProvider,c,u,h,m,d,p,this._gmx.ZeroDate)}}this._tiles=n,this._tilesTree=new a(this._gmx.TemporalPeriods,this._gmx.ZeroUT),this._tilesTree.initFromTiles(this._tiles),this.processingTile&&(this._tiles[this._processingTileKey]={tile:this.processingTile})},initTilesList:function(t){var e={};if(t.tiles){for(var i=t.tiles||[],n=t.tilesVers,o={},r=0,a=0,l=i.length;l>r;r+=3,a++){var h=Number(i[r+2]),u=Number(i[r+1]),c=Number(i[r]),d=Number(n[a]),p=s.makeTileKey(c,u,h,d,-1,-1);o[p]=this._tiles[p]||{tile:new s(this._vectorTileDataProvider,c,u,h,d,-1,-1)},e[p]=!0}this._tiles=o,this.processingTile&&(this._tiles[this._processingTileKey]={tile:this.processingTile})}this._updateActiveTilesList(e)}}),h=L.Class.extend({includes:L.Mixin.Events,initialize:function(t){if(this.type=t.type||"update",this._callback=t.callback,this._items={},this.bbox=t.bbox,this.filters=t.filters||[],this.active=!0,t.bounds&&this.setBounds(t.bounds),!this.bbox){var e=u.worldWidthMerc;this.bbox=u.bounds([[-e,-e],[e,e]]),this.world=!0}t.dateInterval&&this._setDateInterval(t.dateInterval[0],t.dateInterval[1])},activate:function(){return this.active||(this.active=!0,this.fire("activate")),this},deactivate:function(){return this.active&&(this.active=!1,this.fire("activate")),this},toggleActive:function(t){return t?this.activate():this.deactivate()},isActive:function(){return this.active},updateData:function(t){var e=t.length,i={count:e};if("update"===this.type){for(var n,o=this._items,r={},s=!1,a=!1,l=[],h=[],u=0;e>u;u++){var c=t[u];n=c.properties[0],r[n]=c,o[n]||(l.push(c),s=!0)}for(n in o)r[n]||(h.push(o[n]),a=!0);s&&(i.added=l),a&&(i.removed=h),this._items=r}else i.added=t;return this._callback(i),this},removeData:function(t){if("update"!==this.type)return this;var e=this._items,i=[];for(var n in t)e[n]&&(i.push(e[n]),delete e[n]);return i.length&&this._callback({removed:i}),this},setBounds:function(t){var e=t.min,i=t.max;if(!e||!i){var n=L.latLngBounds(t),o=n.getSouthWest(),r=n.getNorthEast();e={x:o.lng,y:o.lat},i={x:r.lng,y:r.lat}}var s=e.x,a=i.x,l=e.y,h=i.y,c=(a-s)/2,d=null,p=null;if(this.world=!1,c>=180)s=-180,a=180,this.world=!0;else if(a>180||-180>s){var m=(a+s)/2%360;m>180?m-=360:-180>m&&(m+=360),s=m-c,a=m+c,-180>s?(d=s+360,p=180,s=-180):a>180&&(d=-180,p=a-360,a=180)}var f=L.Projection.Mercator.project(L.latLng(l,s)),g=L.Projection.Mercator.project(L.latLng(h,a));return this.bbox=u.bounds([[f.x,f.y],[g.x,g.y]]),this.bbox1=null,d&&(f=L.Projection.Mercator.project(L.latLng(l,d)),g=L.Projection.Mercator.project(L.latLng(h,p)),this.bbox1=u.bounds([[f.x,f.y],[g.x,g.y]])),this.fire("update"),this},intersects:function(t){return this.world||this.bbox.intersects(t)||!(!this.bbox1||!this.bbox1.intersects(t))},intersectsWithTile:function(t){var e=this.dateInterval;return this.intersects(t.bounds)&&(!t.beginDate||e&&e.endDate>=t.beginDate&&e.beginDate<=t.endDate)},_setDateInterval:function(t,e){this.dateInterval=t&&e?{beginDate:t,endDate:e}:null},setDateInterval:function(t,e){return this._setDateInterval(t,e),this.fire("update",{temporalFilter:!0}),this}});L.LabelsLayer=L.Class.extend({options:{pane:"markerPane"},initialize:function(t,e){L.setOptions(this,e),this._observers={},this._styleManagers={},this._labels={};var i=this;this.bbox=u.bounds();var n=function(e,n){if(e.added||e.removed){for(var o=n.options,r=t._zoom>=o.minZoom&&t._zoom<=o.maxZoom?e.added:[],s="_"+n._leaflet_id,a=n._gmx,l={},h=0,c=r.length;c>h;h++){var d=r[h].item,p="POINT"===d.type||"MULTIPOINT"===d.type,m=d.parsedStyleKeys||d.currentStyle||{};if(a.styleHook&&(m=a.styleManager.applyStyleHook(d,a.lastHover&&d.id===a.lastHover.id)),d.multiFilters)for(var f=0,g=d.multiFilters.length;g>f;f++){var _=d.multiFilters[f].parsedStyle;if("labelField"in _||"labelText"in _){m=_;break}}var v=a.styleManager.getObjStyle(d)||{},y=m.labelText||v.labelText,L=m.labelField||v.labelField,x=y||a.getPropItem(d.properties,L),b=m.labelFontSize||v.labelFontSize,P="_"+d.id,C=d.options;if(x){if(!("center"in C)){var w=u.getItemCenter(d,a.dataManager.getItemMembers(d.id));if(!w)continue;C.center=w}if(!("label"in C)||C.label.txt!==x){var T=b||12,M={font:T+'px "Arial"',labelHaloColor:m.labelHaloColor||v.labelHaloColor||-1,labelColor:m.labelColor||v.labelColor,labelAlign:m.labelAlign||v.labelAlign,labelFontSize:b},S=u.getLabelWidth(x,M);if(!S){delete l[P];continue}C.label={isPoint:p,width:S+4,sx:v.sx||0,txt:x,style:M}}C.label.width&&(l[P]=d)}}i._labels[s]=l}},o=function(t){var e=t._gmx,o=["styleFilter","userFilter"],r={type:"resend",bbox:i.bbox,filters:o,callback:function(e){n(e,t),i.redraw()}};return e.beginDate&&e.endDate&&(r.dateInterval=[e.beginDate,e.endDate]),e.dataManager.addObserver(r,"_Labels")};this.add=function(t){var e=t._leaflet_id,n=i._labels["_"+e],r=t._gmx;for(var s in n)delete n[s].options.labelStyle,delete n[s].options.label;!i._observers[e]&&r&&r.labelsLayer&&e&&r.styleManager.deferred.then(function(){var n=o(t);r.styleManager.isVisibleAtZoom(i._map._zoom)||n.deactivate(),i._observers[e]=n,i._styleManagers[e]=r.styleManager,i._updateBbox(),i._labels["_"+e]={},i.redraw()})},this.remove=function(t){var e=t._leaflet_id;if(i._observers[e]){var n=t._gmx,o=n.dataManager;o.removeObserver(i._observers[e].id),delete i._observers[e],delete i._styleManagers[e],delete i._labels["_"+e],i.redraw()}},this._layeradd=function(t){i.add(t.layer)},this._layerremove=function(t){i.remove(t.layer)}},redraw:function(){return this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),t.getPanes()[this.options.pane].appendChild(this._canvas),t.on("moveend",this._reset,this),t.on({layeradd:this._layeradd,layerremove:this._layerremove}),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes()[this.options.pane].removeChild(this._canvas),t.off("moveend",this._reset,this),t.off("layeradd",this._layeradd),t.off("layerremove",this._layerremove),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=L.DomUtil.create("canvas","leaflet-labels-layer leaflet-layer"),e=this._map.getSize();t.width=e.x,t.height=e.y,t.style.pointerEvents="none",this._canvas=t;var i=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,"leaflet-zoom-"+(i?"animated":"hide"))},_updateBbox:function(){var t=this._map,e=t.getBounds(),i=e.getSouthWest(),n=e.getNorthEast(),o=L.Projection.Mercator.project(i),r=L.Projection.Mercator.project(n);this.mInPixel=u.getPixelScale(t._zoom),this._ctxShift=[o.x*this.mInPixel,r.y*this.mInPixel];for(var s in this._observers)this._observers[s].setBounds({min:{x:i.lng,y:i.lat},max:{x:n.lng,y:n.lat}})},_reset:function(){this._updateBbox();for(var t in this._observers){var e=this._observers[t];!e.isActive()&&this._styleManagers[t].isVisibleAtZoom(this._map._zoom)&&e.activate(),e.fire("update")}},_redraw:function(){var t=[],e=this._map,i=e.getSize(),n=this._canvas,o=e._getTopLeftPoint(),r=e.containerPointToLayerPoint([0,o.y<0?-o.y:0]);n.width=i.x,n.height=i.y,L.DomUtil.setPosition(n,r);var s,a,l,h=2*this.mInPixel*u.worldWidthMerc,c=h*Math.floor(e.getPixelBounds().min.x/h),d=n.getContext("2d");for(var p in this._labels){var m=this._labels[p];for(var f in m){l=m[f];var g=l.options,_=g.label,v=_.style,y=_.width,x=y/2,b=v.labelFontSize||12,P=b/2,C=g.center,w=[C[0]*this.mInPixel,C[1]*this.mInPixel],T=!1;if(_.isPoint){var M=v.labelAlign||"center",S=_.sx;"left"===M?w[0]+=x+S:"right"===M&&(w[0]-=y+S)}w[0]-=x+this._ctxShift[0],w[1]=P-w[1]+this._ctxShift[1];for(var D=w[0]+c;D<i.x;D+=h){var I=[Math.floor(D),Math.floor(w[1])],k=u.bounds([[I[0]-x,I[1]-P],[I[0]+x,I[1]+P]]);for(s=0,a=t.length;a>s;s++)if(k.intersects(t[s].bbox)){T=!0;break}T||("labelStyle"in g||(g.labelStyle={font:b+'px "Arial"',fillStyle:u.dec2color(v.labelColor||0,1),shadowBlur:4},-1!==v.labelHaloColor&&(g.labelStyle.strokeStyle=g.labelStyle.shadowColor=u.dec2color(v.labelHaloColor,1))),t.push({arr:l.properties,bbox:k,txt:_.txt,style:g.labelStyle,coord:I}))}}}if(t.length)for(n.parentNode||this._map.getPanes()[this.options.pane].appendChild(n),d.clearRect(0,0,n.width,n.height),s=0,a=t.length;a>s;s++)l=t[s],u.setLabel(d,l.txt,l.coord,l.style);else n.parentNode&&n.parentNode.removeChild(n);this._frame=null},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map.getPixelBounds().min,n=this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());i.y<0&&(n.y+=i.multiplyBy(-e).y),this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(n)+" scale("+e+")"}}),L.labelsLayer=function(t,e){return new L.LabelsLayer(t,e)},L.Map.addInitHook(function(){this._labelsLayer||(this._labelsLayer=new L.LabelsLayer(this),this._labelsLayer.addTo(this))});var u={lastMapId:0,newId:function(){return u.lastMapId+=1,"_"+u.lastMapId},uniqueGlobalName:function(t){var e=u.newId();return window[e]=t,e},isPageHidden:function(){return document.hidden||document.msHidden||document.webkitHidden||document.mozHidden||!1},requestJSONP:function(t,e,i){i=i||{};var n=new L.gmx.Deferred,o=document.createElement("script");o.setAttribute("charset","UTF-8");var r="callbackParamName"in i?i.callbackParamName:"CallbackName",s=L.extend({},e);if(r){var a=u.uniqueGlobalName(function(t){delete window[a],document.getElementsByTagName("head").item(0).removeChild(o),n.resolve(t)});s[r]=a}var l=[];for(var h in s)l.push(h+"="+encodeURIComponent(s[h]));var c=-1===t.indexOf("?")?"?":"&";return o.onerror=function(t){n.reject(t)},o.setAttribute("src",t+c+l.join("&")),document.getElementsByTagName("head").item(0).appendChild(o),n},getXmlHttp:function(){var t;if("undefined"!=typeof XMLHttpRequest)t=new XMLHttpRequest;else try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){t=!1}}return t},request:function(t){var e=u.getXmlHttp();if(e){if(e.open(t.type?t.type:"GET",t.url,t.async||!1),t.headers)for(var i in t.headers)e.setRequestHeader(i,t.headers[i]);return t.async&&(e.onreadystatechange=function(){4===e.readyState&&(200===e.status?(t.callback(e.responseText),e=null):t.onError&&t.onError(e))}),e.send(t.params?t.params:null),t.async||200!==e.status?!0:(t.callback(e.responseText),e.status)}return t.onError&&t.onError({Error:"bad XMLHttpRequest!"}),!1},tileSizes:[],getTileNumFromLeaflet:function(t,e){var i=Math.pow(2,e),n=t.x%i+(t.x<0?i:0),o=t.y%i+(t.y<0?i:0);return{z:e,x:n%i-i/2,y:i/2-1-o%i}},getTilePosZoomDelta:function(t,e,i){var n=Math.pow(2,e-i),o=256/n,r=t.x%n,s=t.y%n;return{size:o,zDelta:n,x:o*(0>r?n+r:r),y:o*(0>s?1+s:n-1-s)}},geoItemBounds:function(t){if(!t)return{bounds:null,boundsArr:[]};var e=t.type,i=t.coordinates,n=null,o=0,r=0,s=null,a=[];if("MULTIPOLYGON"===e||"MultiPolygon"===e)for(s=u.bounds(),o=0,r=i.length;r>o;o++){for(var l=[],h=0,c=i[o].length;c>h;h++)n=u.bounds(i[o][h]),l.push(n),0===h&&s.extendBounds(n);a.push(l)}else if("POLYGON"===e||"Polygon"===e)for(s=u.bounds(),o=0,r=i.length;r>o;o++)n=u.bounds(i[o]),a.push(n),0===o&&s.extendBounds(n);else if("POINT"===e||"Point"===e)s=u.bounds([i]);else if("MULTIPOINT"===e||"MultiPoint"===e)for(s=u.bounds(),o=0,r=i.length;r>o;o++)n=u.bounds([i[o]]),s.extendBounds(n);else if("LINESTRING"===e||"LineString"===e)s=u.bounds(i);else if("MULTILINESTRING"===e||"MultiLineString"===e)for(s=u.bounds(),o=0,r=i.length;r>o;o++)n=u.bounds(i[o]),s.extendBounds(n);return{bounds:s,boundsArr:a}},getGeometryBounds:function(t){var e=u.geoItemBounds(t);return e.bounds},getMarkerPolygon:function(t,e,i){var n=(t.min.x+t.max.x)/2,o=(t.min.y+t.max.y)/2;return[[n-e,o-i],[n-e,o+i],[n+e,o+i],[n+e,o-i],[n-e,o-i]]},getPropertiesHash:function(t,e){var i={};for(var n in e)i[n]=t[e[n]];return i},dec2rgba:function(t,e){var i=255&t>>16,n=255&t>>8,o=255&t;return"rgba("+i+", "+n+", "+o+", "+e+")"},dec2hex:function(t){return(t+16777216).toString(16).substr(-6)},dec2color:function(t,e){return 1>e?this.dec2rgba(t,e):"#"+this.dec2hex(t)},oneDay:86400,isTileKeysIntersects:function(t,e){if(t.z<e.z){var i=t;t=e,e=i}var n=t.z-e.z;return t.x>>n===e.x&&t.y>>n===e.y},rotatePoints:function(t,e,i,n){var o=[];e*=Math.PI/180;var r=Math.sin(e),s=Math.cos(e);i||(i=1);for(var a=0;a<t.length;a++){var l=i*t[a].x-n.x,h=i*t[a].y-n.y;o.push({x:s*l-r*h+n.x,y:r*l+s*h+n.y})}return o},getPatternIcon:function(t,e,i){if(!e.fillPattern)return null;var n=!0,o=e.fillPattern,r=t?t.properties:{},s=o.step>0?o.step:0,a={minWidth:1,maxWidth:1e3,minStep:0,maxStep:1e3};o.patternStepFunction&&null!==r&&(s=o.patternStepFunction(r,i),n=!1),s>a.maxStep?s=a.maxStep:s<a.minStep&&(s=a.minStep);var l=o.width>0?o.width:8;o.patternWidthFunction&&null!==r&&(l=o.patternWidthFunction(r,i),n=!1),l>a.maxWidth?l=a.maxWidth:l<a.minWidth&&(l=a.minWidth);var h=e.fillOpacity;e.opacityFunction&&null!==r&&(h=e.opacityFunction(r,i)/100,n=!1);var c=[16711680,65280,255],d=null!=o.colors?o.colors:c,p=d.length,m=[],f=0;for(f=0;p>f;f++){var g=d[f];o.patternColorsFunction&&null!==o.patternColorsFunction[f]&&(g=null!==r?o.patternColorsFunction[f](r,i):c[f%3],n=!1),m.push(g)}var _=l+s,v=_*p,y=0,L=0,x=v,b=v,P=o.style||"horizontal",C=!1;if("diagonal1"===P||"diagonal2"===P||"cross"===P||"cross1"===P?C=!0:"circle"===P?(b=x=2*_,y=Math.floor(b/2),L=2*Math.PI/p):"vertical"===P?x=1:"horizontal"===P&&(b=1),b*x>a.maxWidth)return console.log({func:"getPatternIcon",Error:"MAX_PATTERN_SIZE",alert:"Bitmap from pattern is too big"}),null;var w=document.createElement("canvas");w.width=b,w.height=x;var T=w.getContext("2d");for(T.clearRect(0,0,w.width,w.height),("diagonal2"===P||"vertical"===P)&&(T.translate(b,0),T.rotate(Math.PI/2)),f=0;p>f;f++){T.beginPath();var M=u.dec2color(m[f],h);if(T.fillStyle=M,C){var S=f*_,D=S+l;T.moveTo(S,0),T.lineTo(D,0),T.lineTo(0,D),T.lineTo(0,S),T.lineTo(S,0),S+=v,D=S+l,T.moveTo(S,0),T.lineTo(D,0),T.lineTo(0,D),T.lineTo(0,S),T.lineTo(S,0),("cross"===P||"cross1"===P)&&(S=f*_,D=S+l,T.moveTo(b,S),T.lineTo(b,D),T.lineTo(b-D,0),T.lineTo(b-S,0),T.lineTo(b,S),S+=v,D=S+l,T.moveTo(b,S),T.lineTo(b,D),T.lineTo(b-D,0),T.lineTo(b-S,0),T.lineTo(b,S))}else"circle"===P?(T.arc(y,y,l,f*L,(f+1)*L),T.lineTo(y,y)):T.fillRect(0,f*_,b,l);T.closePath(),T.fill()}var I=document.createElement("canvas");I.width=b,I.height=x;var k=I.getContext("2d");return k.drawImage(w,0,0,b,x),{notFunc:n,canvas:I}},toPixels:function(t,e,i,n){var o=t[0]*n;o=.5+o<<0;var r=t[1]*n;return r=.5+r<<0,[o-e,i-r]},getPixelPoint:function(t,e){var i=t.gmx,n=i.mInPixel,o=t.item,r=o.currentStyle||o.parsedStyleKeys||{},s=t.style||{},a=r.iconScale||1,l=r.sx||s.sx||4,h=r.sy||s.sy||4,u=r.weight||s.weight||0,c=t.tpx,d=t.tpy;l*=a,h*=a;var p=e[0]*n-c,m=d-e[1]*n;return m-h-u>256||p-l-u>256||0>p+l+u||0>m+h+u?null:{sx:l,sy:h,px1:.5+p<<0,py1:.5+m<<0}},getImageData:function(t){if(L.gmxUtil.isIE9||L.gmxUtil.isIE10)return null;var e=document.createElement("canvas"),i=t.width,n=t.height;e.width=i,e.height=n;var o=e.getContext("2d");return o.drawImage(t,0,0),o.getImageData(0,0,i,n).data},DEFAULT_REPLACEMENT_COLOR:16711935,isIE:function(t){return RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent||"")},replaceColor:function(t,e,i){if(L.gmxUtil.isIE9||L.gmxUtil.isIE10)return t;var n=document.createElement("canvas"),o=t.width,r=t.height;n.width=o,n.height=r;var s=n.getContext("2d");if("string"==typeof e&&(e=parseInt("0x"+e.replace(/#/,""))),e!==this.DEFAULT_REPLACEMENT_COLOR){var a,l=255&e>>16,h=255&e>>8,u=255&e,c=!1;i?a=s.createImageData(o,r):(s.drawImage(t,0,0),a=s.getImageData(0,0,o,r),i=a.data);for(var d=a.data,p=0,m=i.length;m>p;p+=4)255===i[p]&&0===i[p+1]&&255===i[p+2]&&(d[p]=l,d[p+1]=h,d[p+2]=u,d[p+3]=i[p+3],c=!0);c&&s.putImageData(a,0,0)}else s.drawImage(t,0,0);return n},pointToCanvas:function(t){var e=t.gmx,i=t.pointAttr,n=t.style||{},o=i.sx,r=i.sy,s=i.px1,a=i.py1,l=t.item,h=l.currentStyle||l.parsedStyleKeys,c=h.iconScale||1,d=s-o/2,p=a-r/2,m=t.ctx,f=h.image||n.image;if(f)"iconColor"in h&&(f=this.replaceColor(f,h.iconColor,t.imageData)),n.rotateRes=h.rotate||0,"opacity"in n&&(m.globalAlpha=h.opacity||n.opacity),e.transformFlag?(m.setTransform(e.mInPixel,0,0,e.mInPixel,-t.tpx,t.tpy),m.drawImage(f,s,-a,o,r),m.setTransform(e.mInPixel,0,0,-e.mInPixel,-t.tpx,t.tpy)):n.rotateRes?(m.translate(s,a),m.rotate(u.degRad(n.rotateRes)),m.translate(-s,-a),m.drawImage(f,d,p,o,r),m.setTransform(1,0,0,1,0,0)):m.drawImage(f,d,p,o,r),"opacity"in n&&(m.globalAlpha=1);else if(n.fillColor||h.fillRadialGradient){if(m.beginPath(),"circle"===n.type||h.fillRadialGradient){var g=n.iconSize;if(h.fillRadialGradient){var _=h.fillRadialGradient;g=_.r2*c;for(var v=m.createRadialGradient(s+_.x1,a+_.y1,_.r1*c,s+_.x2,a+_.y2,g),y=0,L=_.addColorStop.length;L>y;y++){var x=_.addColorStop[y];v.addColorStop(x[0],x[1])}m.fillStyle=v}m.arc(s,a,g,0,2*Math.PI)}else m.fillRect(d,p,o,r);m.fill()}h.strokeStyle&&(m.beginPath(),"circle"===n.type?m.arc(s,a,n.iconSize,0,2*Math.PI):m.strokeRect(d,p,o,r),m.stroke())},lineToCanvas:function(t){var e=t.gmx,i=t.coords,n=t.ctx,o=null,r=null;n.beginPath();for(var s=0,a=i.length;a>s;s++){var l=u.toPixels(i[s],t.tpx,t.tpy,e.mInPixel);(o!==l[0]||r!==l[1])&&(0===s?n.moveTo(l[0],l[1]):n.lineTo(l[0],l[1]),o=l[0],r=l[1])}n.stroke()},polygonToCanvas:function(t){if(0===t.coords.length)return null;var e=t.gmx,i=e.mInPixel,n=t.flagPixels||!1,o=t.hiddenLines||[],r=t.coords,s=r.length,a=t.ctx,l=t.tpx,h=t.tpy,u=0,c=0,d=null,p=null,m=[],f=[];a.beginPath();for(var g=0;s>g;g++){var _=!1;g===o[c]&&(_=!0,c++);var v=[r[g][0],r[g][1]];n||(v=[v[0]*i,v[1]*i]);var y=[Math.round(v[0]-l),Math.round(h-v[1])];(d!==y[0]||p!==y[1])&&(d=y[0],p=y[1],a[_?"moveTo":"lineTo"](y[0],y[1]),n||(m.push([v[0],v[1]]),_&&f.push(u)),u++)}return 1===u&&a.lineTo(d+1,p),a.stroke(),n?null:{coords:m,hidden:f}},polygonToCanvasFill:function(t){if(!(t.coords.length<3)){var e=t.gmx,i=e.mInPixel,n=t.flagPixels||!1,o=t.coords,r=o.length,s=t.tpx,a=t.tpy,l=t.ctx;l.lineWidth=0;var h=n?o[0]:[o[0][0]*i,o[0][1]*i],u=[Math.round(h[0]-s),Math.round(a-h[1])];l.moveTo(u[0],u[1]);for(var c=1;r>c;c++)h=n?o[c]:[o[c][0]*i,o[c][1]*i],u=[Math.round(h[0]-s),Math.round(a-h[1])],l.lineTo(u[0],u[1])}},isPatternNode:function(t){return t instanceof HTMLCanvasElement||t instanceof HTMLImageElement},labelCanvasContext:null,getLabelWidth:function(t,e){if(e){if(!u.labelCanvasContext){var i=document.createElement("canvas");i.width=i.height=512,u.labelCanvasContext=i.getContext("2d")}var n=u.labelCanvasContext;return n.clearRect(0,0,512,512),n.font!==e.font&&(n.font=e.font),n.fillStyle!==e.fillStyle&&(n.fillStyle=e.fillStyle),n.fillText(t,0,0),n.measureText(t).width}return 0},setLabel:function(t,e,i,n){var o=i[0],r=i[1];t.shadowColor!==n.shadowColor&&(t.shadowColor=n.shadowColor),t.shadowBlur!==n.shadowBlur&&(t.shadowBlur=n.shadowBlur),t.font!==n.font&&(t.font=n.font),t.strokeStyle!==n.strokeStyle&&(t.strokeStyle=n.strokeStyle),t.fillStyle!==n.fillStyle&&(t.fillStyle=n.fillStyle),t.strokeText(e,o,r),t.fillText(e,o,r)},worldWidthMerc:20037508,rMajor:6378137,degRad:function(t){return t*(Math.PI/180)},distVincenty:function(t,e,i,n){for(var o={lon:u.degRad(t),lat:u.degRad(e)},r={lon:u.degRad(i),lat:u.degRad(n)},s=u.rMajor,a=6356752.3142,l=1/298.257223563,h=r.lon-o.lon,c=Math.atan((1-l)*Math.tan(o.lat)),d=Math.atan((1-l)*Math.tan(r.lat)),p=Math.sin(c),m=Math.cos(c),f=Math.sin(d),g=Math.cos(d),_=h,v=2*Math.PI,y=20;Math.abs(_-v)>1e-12&&--y>0;){var L=Math.sin(_),x=Math.cos(_),b=Math.sqrt(g*L*g*L+(m*f-p*g*x)*(m*f-p*g*x));if(0===b)return 0;var P=p*f+m*g*x,C=Math.atan2(b,P),w=m*g*L/b,T=1-w*w,M=P-2*p*f/T;isNaN(M)&&(M=0);var S=l/16*T*(4+l*(4-3*T));v=_,_=h+(1-S)*l*w*(C+S*b*(M+S*P*(-1+2*M*M)))}if(0===y)return 0/0;var D=T*(s*s/(a*a)-1),I=1+D/16384*(4096+D*(-768+D*(320-175*D))),k=D/1024*(256+D*(-128+D*(74-47*D))),E=k*b*(M+k/4*(P*(-1+2*M*M)-k/6*M*(-3+4*b*b)*(-3+4*M*M))),A=a*I*(C-E);return A=A.toFixed(3)},parseCoordinates:function(t){if(t.match(/[qrtyuiopadfghjklzxcvbmQRTYUIOPADFGHJKLZXCVBM_:]/))return null;-1!==t.indexOf(" ")&&(t=t.replace(/,/g,"."));for(var e=/(-?\d+(\.\d+)?)([^\d\-]*)/g,i=[],n=null;n=e.exec(t);)i.push(n[1]);if(i.length<2)return null;var o,r=Math.floor(i.length/2),s=0,a=1;for(o=0;r>o;o++)s+=parseFloat(i[o])*a,a/=60;var l=0;for(a=1,o=r;o<i.length;o++)l+=parseFloat(i[o])*a,a/=60;if(Math.abs(s)>180||Math.abs(l)>180){var h=L.Projection.Mercator.unproject(new L.Point(s,l));s=h.lng,l=h.lat}return-1!==t.indexOf("W")&&(s=-s),-1!==t.indexOf("S")&&(l=-l),[s,l]},pad2:function(t){return 10>t?"0"+t:""+t},trunc:function(t){return(""+(Math.round(1e7*t)/1e7+1e-8)).substring(0,9)},formatDegrees:function(t){t=Math.round(1e7*t)/1e7+1e-8;var e=Math.floor(t),i=Math.floor(60*(t-e)),n=u.pad2(3600*(t-e-i/60)).substring(0,2);return u.pad2(e)+""+u.pad2(i)+"'"+n+'"'},LatLonFormatCoordinates:function(t,e){return u.formatDegrees(Math.abs(e))+(e>0?" N, ":" S, ")+u.formatDegrees(Math.abs(t))+(t>0?" E":" W")},formatCoordinates:function(t,e){return u.LatLonFormatCoordinates(t,e)},LatLonFormatCoordinates2:function(t,e){return u.trunc(Math.abs(e))+(e>0?" N, ":" S, ")+u.trunc(Math.abs(t))+(t>0?" E":" W")},formatCoordinates2:function(t,e){return u.LatLonFormatCoordinates2(t,e)},getPixelScale:function(t){return 256/u.tileSizes[t]},forEachPoint:function(t,e){if(!t||0===t.length)return[];var i=[],n=0;if(t[0].length){for(n=0;n<t.length;n++)"string"!=typeof t[n]&&i.push(this.forEachPoint(t[n],e));return i}if(2===t.length)return e(t);for(n=0;n<t.length/2;n++)i.push(e([t[2*n],t[2*n+1]]));return i},getQuicklookPoints:function(t){var e,i,n,o,r,s,a,l,h=Number.MAX_VALUE,u=Number.MAX_VALUE,c=Number.MAX_VALUE,d=Number.MAX_VALUE;return this.forEachPoint(t,function(t){var p=t[0],m=t[1];h>p-m&&(h=p-m,e=t[0],i=t[1]),u>-p-m&&(u=-p-m,n=t[0],o=t[1]),c>-p+m&&(c=-p+m,r=t[0],s=t[1]),d>p+m&&(d=p+m,a=t[0],l=t[1])}),{x1:e,y1:i,x2:n,y2:o,x3:r,y3:s,x4:a,y4:l}},getItemCenter:function(t,e){var i=t.bounds,n=i.min,o=i.max,r=t.type,s="POINT"===r||"MULTIPOINT"===r,a=s?[n.x,n.y]:[(n.x+o.x)/2,(n.y+o.y)/2];if("POLYGON"===r||"MULTIPOLYGON"===r)for(var l=0,h=e.length;h>l;l++){var c=e[l],d=c.geo,p=d.coordinates,m=c.dataOption,f=m.bounds;if(f.contains(a)){"POLYGON"===d.type&&(p=[p]);for(var g=0,_=p.length;_>g;g++)for(var v=0,y=p[g],L=y.length;L>v;v++){var x=u.getHSegmentsInPolygon(a[1],y[v]);if(x)return x.max.center}}}else{if("POINT"===r||"MULTIPOINT"===r)return a;if("LINESTRING"===r||"MULTILINESTRING"===r)return a}return null},getHSegmentsInPolygon:function(t,e){var i,n,o,r=[],s=e[0],a=t>s[1];for(i=1,n=e.length;n>i;i++){var l=e[i],h=t>l[1];a!==h&&r.push(s[0]-(s[0]-l[0])*(s[1]-t)/(s[1]-l[1])),s=l,a=h}if(n=r.length){r=r.sort();var u=0,c=-1;for(i=1;n>i;i+=2){var d=i-1,p=Math.abs(r[i]-r[d]);p>u&&(u=p,c=d)}o={y:t,segArr:r,max:{width:u,center:[(r[c]+r[c+1])/2,t]}}}return o},isPointInPolygonArr:function(t,e){for(var i=!1,n=t[0],o=t[1],r=e[0],s=1,a=e.length;a>s;s++){var l=e[s],h=Math.min(r[0],l[0]),u=Math.max(r[0],l[0]),c=Math.max(r[1],l[1]);if(n>h&&u>=n&&c>=o&&r[0]!==l[0]){var d=(n-r[0])*(l[1]-r[1])/(l[0]-r[0])+r[1];(r[1]===l[1]||d>=o)&&(i=!i)}r=l}return i},isPointInPolygonWithHoles:function(t,e){if(!u.isPointInPolygonArr(t,e[0]))return!1;for(var i=1,n=e.length;n>i;i++)if(u.isPointInPolygonArr(t,e[i]))return!1;return!0},isPointInPolyLine:function(t,e,i,n){var o=t[0],r=t[1],s={x:o,y:r},a=o-e,l=o+e,h=r-e,u=r+e,c=0;e*=e;for(var d=1,p=i.length;p>d;d++)if(n&&d===n[c])c++;else{var m=i[d-1],f=i[d],g=m[0],_=m[1],v=f[0],y=f[1];if(!(Math.max(g,v)<a||Math.min(g,v)>l||Math.max(_,y)<h||Math.min(_,y)>u)){var x=L.LineUtil._sqClosestPointOnSegment(s,{x:g,y:_},{x:v,y:y},!0);if(e>x)return!0}}return!1},isPointInLines:function(t){for(var e=t.coords,i=t.point,n=t.delta,o=t.boundsArr,r=t.hidden,s=0,a=e.length,l=!1;a>s;s++)if(l=o[s]?o[s].contains(i):!0,l&&u.isPointInPolyLine(i,n,e[s],r?r[s]:null))return!0;return!1},getLength:function(t,e){var i=0;if(t&&t.length){var n=!1,o=!1;e=void 0===e||e,t.forEach(function(t){if(L.Util.isArray(t)){if(2!==t.length)return i+=u.getLength(t,e);e&&(t=L.Projection.Mercator.unproject({x:t[0],y:t[1]}))}n!==!1&&o!==!1&&(i+=parseFloat(u.distVincenty(n,o,t.lng,t.lat))),n=t.lng,o=t.lat})}return i},prettifyDistance:function(t,e){var i=" "+L.gmxLocale.getText("units.km");return"nm"===e?Math.round(.539956803*t)/1e3+" "+L.gmxLocale.getText("units.nm"):"km"===e?Math.round(t)/1e3+i:2e3>t||"m"===e?Math.round(t)+" "+L.gmxLocale.getText("units.m"):2e5>t?Math.round(t/10)/100+i:Math.round(t/1e3)+i},geoJSONGetLength:function(t){var e,i,n,o,r,s=0;if("GeometryCollection"===t.type?s+=t.geometries.forEach(u.geoJSONGetLength):"Feature"===t.type?s+=u.geoJSONGetLength(t.geometry):"FeatureCollection"===t.type&&(s+=t.features.forEach(u.geoJSONGetLength)),"LineString"===t.type||"MultiLineString"===t.type)for(r=t.coordinates,"LineString"===t.type&&(r=[r]),e=0,n=r.length;n>e;e++)s+=u.getRingLength(r[e]);
if("Polygon"===t.type||"MultiPolygon"===t.type)for(r=t.coordinates,"Polygon"===t.type&&(r=[r]),e=0,n=r.length;n>e;e++)for(i=0,o=r[e].length;o>i;i++)s+=u.getRingLength(r[e][i]);return s},getRingLength:function(t){var e=0;if(t&&t.length){var i=!1,n=!1;t.forEach(function(t){return L.Util.isArray(t)&&t.length>2?e+=u.getRingLength(t):(i!==!1&&n!==!1&&(e+=parseFloat(u.distVincenty(i,n,t[0],t[1]))),i=t[0],n=t[1],void 0)})}return e},geoJSONGetArea:function(t){var e=0;if("GeometryCollection"===t.type?e+=t.geometries.forEach(u.geoJSONGetArea):"Feature"===t.type?e+=u.geoJSONGetArea(t.geometry):"FeatureCollection"===t.type&&(e+=t.features.forEach(u.geoJSONGetArea)),"Polygon"===t.type||"MultiPolygon"===t.type){var i=t.coordinates;"Polygon"===t.type&&(i=[i]);for(var n=0,o=i.length;o>n;n++){e+=u.getRingArea(i[n][0]);for(var r=1,s=i[n].length;s>r;r++)e-=u.getRingArea(i[n][r])}}return e},getRingArea:function(t){for(var e=0,i=0,n=t.length;n>i;i++){var o=i===n-1?0:i+1,r=t[i],s=t[o];e+=r[0]*Math.sin(u.degRad(s[1]))-s[0]*Math.sin(u.degRad(r[1]))}var a=Math.abs(e*u.lambertCoefX*u.lambertCoefY/2);return a},getArea:function(t){for(var e=0,i=0,n=t.length;n>i;i++){var o=i===n-1?0:i+1,r=t[i],s=t[o];e+=r.lng*Math.sin(u.degRad(s.lat))-s.lng*Math.sin(u.degRad(r.lat))}var a=Math.abs(e*u.lambertCoefX*u.lambertCoefY/2);return a},prettifyArea:function(t,e){var i=" "+L.gmxLocale.getText("units.km2");return"km2"===e?""+Math.round(t/100)/1e4+i:"ha"===e?""+Math.round(t/100)/100+" "+L.gmxLocale.getText("units.ha"):1e5>t||"m2"===e?Math.round(t)+" "+L.gmxLocale.getText("units.m2"):3e6>t?(""+Math.round(t/1e3)/1e3).replace(".",",")+i:3e7>t?(""+Math.round(t/1e4)/100).replace(".",",")+i:3e8>t?(""+Math.round(t/1e5)/10).replace(".",",")+i:Math.round(t/1e6)+i},geoLength:function(t){var e=0,i=t.type;if("MULTILINESTRING"===i||"MultiLineString"===i){for(var n=0,o=t.coordinates.length;o>n;n++)e+=u.geoLength({type:"LINESTRING",coordinates:t.coordinates[n]});return e}return("LINESTRING"===i||"LineString"===i)&&(e=u.getLength(t.coordinates)),e},geometryToGeoJSON:function(t,e){var i="MULTIPOLYGON"===t.type?"MultiPolygon":"POLYGON"===t.type?"Polygon":"MULTILINESTRING"===t.type?"MultiLineString":"LINESTRING"===t.type?"LineString":"MULTIPOINT"===t.type?"MultiPoint":"POINT"===t.type?"Point":t.type,n=t.coordinates;return e&&(n=u.coordsFromMercator(i,n)),{type:i,coordinates:n}},coordsFromMercator:function(t,e){var i,n,o,r=[];if("Point"===t)o=L.Projection.Mercator.unproject({y:e[1],x:e[0]}),r=[o.lng,o.lat];else if("LineString"===t||"MultiPoint"===t)for(i=0,n=e.length;n>i;i++)r.push(u.coordsFromMercator("Point",e[i]));else if("Polygon"===t||"MultiLineString"===t)for(i=0,n=e.length;n>i;i++)r.push(u.coordsFromMercator("MultiPoint",e[i]));else if("MultiPolygon"===t)for(i=0,n=e.length;n>i;i++)r.push(u.coordsFromMercator("Polygon",e[i]));return r},geoArea:function(t,e){var i,n,o=0,r=t.type||"";if(e=void 0===e||e,"MULTIPOLYGON"===r||"MultiPolygon"===r){for(i=0,n=t.coordinates.length;n>i;i++)o+=u.geoArea({type:"POLYGON",coordinates:t.coordinates[i]},e);return o}if("POLYGON"===r||"Polygon"===r){for(o=u.geoArea(t.coordinates[0],e),i=1,n=t.coordinates.length;n>i;i++)o-=u.geoArea(t.coordinates[i],e);return o}if(t.length){var s=[];return u.forEachPoint(t,function(t){s.push(e?L.Projection.Mercator.unproject({y:t[1],x:t[0]}):{lat:t[1],lng:t[0]})}),u.getArea(s)}return 0},getGeoJSONSummary:function(t,e){var i,n,o,r=t.type,s=0;if("Point"===r)o=t.coordinates,s=u.formatCoordinates(o[0],o[1]);else if("Polygon"===r)s=u.prettifyArea(u.geoArea(t,e),"km2");else if("MultiPolygon"===r){for(o=t.coordinates,i=0,n=o.length;n>i;i++)s+=u.geoArea({type:"Polygon",coordinates:o[i]},e);s=u.prettifyArea(s,"km2")}else if("LineString"===r)s=u.prettifyDistance(u.geoJSONGetLength(t,e));else if("MultiLineString"===r){for(o=t.coordinates,i=0,n=o.length;n>i;i++)s+=u.geoJSONGetLength({type:"LineString",coordinates:o[i]},e);s=u.prettifyDistance(s)}return s},getGeometriesSummary:function(t,e){var i="",n="",o=0;return t.forEach(function(t){if(t)if(n=t.type.toUpperCase(),-1!==n.indexOf("POINT")){var e=L.Projection.Mercator.unproject({y:t.coordinates[1],x:t.coordinates[0]});i="<b>"+L.gmxLocale.getText("Coordinates")+"</b>: "+u.formatCoordinates(e.lng,e.lat)}else-1!==n.indexOf("LINESTRING")?o+=u.geoLength(t):-1!==n.indexOf("POLYGON")&&(o+=u.geoArea(t))}),i||(-1!==n.indexOf("LINESTRING")?i="<b>"+L.gmxLocale.getText("Length")+"</b>: "+u.prettifyDistance(o,e.length):-1!==n.indexOf("POLYGON")&&(i="<b>"+L.gmxLocale.getText("Area")+"</b>: "+u.prettifyArea(o,e.square))),i},getGeometrySummary:function(t,e){return u.getGeometriesSummary([t],e||{})},chkOnEdge:function(t,e,i){return t[0]<i.min.x&&e[0]<i.min.x||t[0]>i.max.x&&e[0]>i.max.x?!0:t[1]<i.min.y&&e[1]<i.min.y||t[1]>i.max.y&&e[1]>i.max.y?!0:!1},getHidden:function(t,e){for(var i=[],n=null,o=0,r=t.length;r>o;o++){var s=t[o];n&&u.chkOnEdge(s,n,e)&&i.push(o),n=s}return i},getNormalizeBounds:function(t,e){var i=t.getNorthWest(),n=t.getSouthEast(),o=i.lng,r=n.lng,s=(r-o)/2,a=null,l=null,h=[];if(s>=180)o=-180,r=180;else if(r>180||-180>o){var c=(r+o)/2%360;c>180?c-=360:-180>c&&(c+=360),o=c-s,r=c+s,-180>o?(a=o+360,l=180,o=-180):r>180&&(a=-180,l=r-360,r=180)}var d={x:o,y:n.lat},p={x:r,y:i.lat};if(void 0!==e&&(d=L.Projection.Mercator.project(new L.LatLng([n.lat,o])),p=L.Projection.Mercator.project(new L.LatLng([i.lat,r])),d.y-=e,p.y-=e),h.push(u.bounds([[d.x,d.y],[p.x,p.y]])),a){var m={x:a,y:n.lat},f={x:l,y:i.lat};void 0!==e&&(m=L.Projection.Mercator.project(new L.LatLng([n.lat,a])),f=L.Projection.Mercator.project(new L.LatLng([i.lat,l])),m.y-=e,f.y-=e),h.push(u.bounds([[m.x,m.y],[f.x,f.y]]))}return h},getTileBounds:function(t,e,i){var n=u.tileSizes[i],o=t*n,r=e*n;return u.bounds([[o,r],[o+n,r+n]])},parseTemplate:function(t,e){for(var i=/\[([^\]]+)\]/i,n=i.exec(t);n&&n.length>1;){var o=n[1],r=o in e?e[o]:"";t=t.replace(n[0],r),n=i.exec(t)}return t},styleKeys:{marker:{server:["image","angle","scale","minScale","maxScale","size","circle","center","color"],client:["iconUrl","iconAngle","iconScale","iconMinScale","iconMaxScale","iconSize","iconCircle","iconCenter","iconColor"]},outline:{server:["color","opacity","thickness","dashes"],client:["color","opacity","weight","dashArray"]},fill:{server:["color","opacity","image","pattern","radialGradient","linearGradient"],client:["fillColor","fillOpacity","fillIconUrl","fillPattern","fillRadialGradient","fillLinearGradient"]},label:{server:["text","field","template","color","haloColor","size","spacing","align"],client:["labelText","labelField","labelTemplate","labelColor","labelHaloColor","labelFontSize","labelSpacing","labelAlign"]}},styleFuncKeys:{iconSize:"iconSizeFunction",iconAngle:"rotateFunction",iconScale:"scaleFunction",iconColor:"iconColorFunction",opacity:"opacityFunction",fillOpacity:"fillOpacityFunction",color:"colorFunction",fillColor:"fillColorFunction"},defaultStyles:{MinZoom:1,MaxZoom:21,Filter:"",Balloon:"",DisableBalloonOnMouseMove:!0,DisableBalloonOnClick:!1,RenderStyle:{point:{color:255,weight:1,iconSize:8},linestring:{color:255,weight:1},polygon:{color:255,weight:1}}},getDefaultStyle:function(t){var e=u.defaultStyles,i=L.extend({},e);return i.RenderStyle=e.RenderStyle[t],i},toServerStyle:function(t){var e={};for(var i in u.styleKeys)for(var n=u.styleKeys[i],o=0,r=n.client.length;r>o;o++){var s=n.client[o];if(s in t){e[i]||(e[i]={});var a=t[s];("opacity"===s||"fillOpacity"===s)&&(a*=100),e[i][n.server[o]]=a}}return"iconAnchor"in t&&(e.marker||(e.marker={}),e.marker.dx=t.iconAnchor[0],e.marker.dy=t.iconAnchor[1]),e},fromServerStyle:function(t){var e,i,n,o,r={type:""};for(var s in u.styleKeys){var a=u.styleKeys[s];for(i=0,n=a.client.length;n>i;i++)o=a.client[i],o in t&&(r[o]=t[o]);if(e=t[s],e&&"object"==typeof e)for(i=0,n=a.server.length;n>i;i++)if(o=a.server[i],o in e){var l=a.client[i],h=e[o];"string"==typeof h?u.styleFuncKeys[l]&&(null===h.match(/[^\d\.]/)?h=Number(h):r[u.styleFuncKeys[l]]=L.gmx.Parsers.parseExpression(h)):"opacity"===o&&(h/=100),r[l]=h}}return t.marker&&(e=t.marker,("dx"in e||"dy"in e)&&(r.iconAnchor=[e.dx||0,e.dy||0])),r},getUTCdate:function(t){var e=new Date(1e3*t);return[e.getUTCFullYear(),u.pad2(e.getUTCMonth()+1),u.pad2(e.getUTCDate())].join(".")},getUTCtime:function(t){var e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),n=Math.floor(t-3600*e-60*i);return[u.pad2(e),u.pad2(i),u.pad2(n)].join(":")},getUTCdateTime:function(t){return[u.getUTCdate(t),u.getUTCtime(t%86400)].join(" ")}};u.lambertCoefX=100*u.distVincenty(0,0,.01,0),u.lambertCoefY=180*100*u.distVincenty(0,0,0,.01)/Math.PI,function(){for(var t=0;30>t;t++)u.tileSizes[t]=40075016.685578495/Math.pow(2,t)}(),u.Bounds=function(t){this.min={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.max={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE},this.extendArray(t)},u.Bounds.prototype={extend:function(t,e){return t<this.min.x&&(this.min.x=t),t>this.max.x&&(this.max.x=t),e<this.min.y&&(this.min.y=e),e>this.max.y&&(this.max.y=e),this},extendBounds:function(t){return this.extendArray([[t.min.x,t.min.y],[t.max.x,t.max.y]])},extendArray:function(t){if(!t)return this;for(var e=0,i=t.length;i>e;e++)this.extend(t[e][0],t[e][1]);return this},addBuffer:function(t,e,i,n){return this.min.x-=t,this.min.y-=e||t,this.max.x+=i||t,this.max.y+=n||t,this},contains:function(t){var e=this.min,i=this.max,n=t[0],o=t[1];return n>=e.x&&n<=i.x&&o>=e.y&&o<=i.y},intersects:function(t){var e=this.min,i=this.max,n=t.min,o=t.max;return o.x>e.x&&n.x<i.x&&o.y>e.y&&n.y<i.y},intersectsWithDelta:function(t,e,i){var n=this.min,o=this.max,r=e||0,s=i||0,a=t.min,l=t.max;return l.x+r>n.x&&a.x-r<o.x&&l.y+s>n.y&&a.y-s<o.y},isEqual:function(t){var e=this.min,i=this.max,n=t.min,o=t.max;return o.x===i.x&&n.x===e.x&&o.y===i.y&&n.y===e.y},clipPolygon:function(t){var e,i,n,o,r=this.min,s=this.max,a=[[r.x,r.y],[s.x,r.y],[s.x,s.y],[r.x,s.y]],l=function(t){return(i[0]-e[0])*(t[1]-e[1])>(i[1]-e[1])*(t[0]-e[0])},h=function(){var t=[e[0]-i[0],e[1]-i[1]],r=[n[0]-o[0],n[1]-o[1]],s=e[0]*i[1]-e[1]*i[0],a=n[0]*o[1]-n[1]*o[0],l=1/(t[0]*r[1]-t[1]*r[0]);return[(s*r[0]-a*t[0])*l,(s*r[1]-a*t[1])*l]},u=t;e=a[a.length-1];for(var c in a){i=a[c];var d=u;u=[],n=d[d.length-1];for(var p in d)o=d[p],l(o)?(l(n)||u.push(h()),u.push(o)):l(n)&&u.push(h()),n=o;e=i}return u}},u.bounds=function(t){return new u.Bounds(t)},u.parseUri=function(t){for(var e=u.parseUri.options,i=e.parser[e.strictMode?"strict":"loose"].exec(t),n={},o=14;o--;)n[e.key[o]]=i[o]||"";return n[e.q.name]={},n[e.key[12]].replace(e.q.parser,function(t,i,o){i&&(n[e.q.name][i]=o)}),n.hostOnly=n.host,n.host=n.authority,n},u.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},L.gmxUtil||(L.gmxUtil={}),L.extend(L.gmxUtil,{isIE9:u.isIE(9),isIE10:u.isIE(10),requestJSONP:u.requestJSONP,fromServerStyle:u.fromServerStyle,toServerStyle:u.toServerStyle,getDefaultStyle:u.getDefaultStyle,bounds:u.bounds,getGeometryBounds:u.getGeometryBounds,tileSizes:u.tileSizes,getUTCdate:u.getUTCdate,getUTCtime:u.getUTCtime,getUTCdateTime:u.getUTCdateTime,formatCoordinates:function(t,e){return u["formatCoordinates"+(e?"2":"")](t.lng,t.lat)},formatDegrees:u.formatDegrees,pad2:u.pad2,dec2hex:u.dec2hex,trunc:u.trunc,LatLonFormatCoordinates:u.LatLonFormatCoordinates,LatLonFormatCoordinates2:u.LatLonFormatCoordinates2,getLength:u.getLength,prettifyDistance:u.prettifyDistance,getArea:u.getArea,prettifyArea:u.prettifyArea,geoArea:u.geoArea,getGeometriesSummary:u.getGeometriesSummary,getGeometrySummary:u.getGeometrySummary,getGeoJSONSummary:u.getGeoJSONSummary,getPropertiesHash:u.getPropertiesHash,distVincenty:u.distVincenty,parseCoordinates:u.parseCoordinates,geometryToGeoJSON:u.geometryToGeoJSON,geoJSONGetArea:u.geoJSONGetArea,geoJSONGetLength:u.geoJSONGetLength,parseUri:u.parseUri}),function(){function t(t,n,o){var r="gmxAPIutils_id"+i++,s=L.DomUtil.create("iframe");s.style.display="none",s.setAttribute("id",t),s.setAttribute("name",t),s.src="javascript:true",s.callbackName=r;var a=u.parseUri(o),l=(a.protocol?a.protocol+":":window.location.protocol)+"//"+(a.host||window.location.host);return e[l]=e[l]||{},e[l][r]={callback:n,iframe:s},s}var e={},i=0,n=function(t){if(t.origin in e){var i=decodeURIComponent(t.data.replace(/\n/g,"\n\\"));try{var n=JSON.parse(i)}catch(o){r.callback&&r.callback({Status:"error",ErrorInfo:{ErrorMessage:"JSON.parse exeption",ExceptionType:"JSON.parse",StackTrace:i}})}var r=e[t.origin][n.CallbackName];r&&(delete r[n.CallbackName],delete n.CallbackName,r.iframe.parentNode&&r.iframe.parentNode.removeChild(r.iframe),r.callback&&r.callback(n))}};L.DomEvent.on(window,"message",n),u.createPostIframe2=t}(),function(){function t(t,e,i,n){var o,r,s="$$iframe_"+u.newId(),a=u.createPostIframe2(s,i,t);if(n)o=n,r=o.getAttribute("action"),o.setAttribute("action",t),o.target=s;else if(L.Browser.ielt9){var l="<form id="+s+'" enctype="multipart/form-data" style="display:none" target="'+s+'" action="'+t+'" method="post"></form>';o=document.createElement(l)}else o=document.createElement("form"),o.style.display="none",o.setAttribute("enctype","multipart/form-data"),o.target=s,o.setAttribute("method","POST"),o.setAttribute("action",t),o.id=s;var h=document.createElement("div");h.style.display="none","window"===e.WrapStyle&&(e.WrapStyle="message"),"message"===e.WrapStyle&&(e.CallbackName=a.callbackName);for(var c in e){var d=document.createElement("input"),p="undefined"!=typeof e[c]?e[c]:"";d.setAttribute("type","hidden"),d.setAttribute("name",c),d.setAttribute("value",p),h.appendChild(d)}o.appendChild(h),n||document.body.appendChild(o),document.body.appendChild(a),o.submit(),n?(o.removeChild(h),null!==r?o.setAttribute("action",r):o.removeAttribute("action")):o.parentNode.removeChild(o)}L.gmxUtil.sendCrossDomainPostRequest=u.sendCrossDomainPostRequest=t}();var c=["strokeStyle","fillStyle","lineWidth"],d=c.length,p=u,m=function(t,e,i){for(var n=0;d>n;n++){var o=c[n],r=i[o];r!==e[o]&&(e[o]=r)}if(i.dashArray){var s=i.dashArray,a=i.dashOffset||0;"setLineDash"in e?e.setLineDash(s):(e.mozDash=s,e.mozDashOffset=a)}if("round"!==e.lineCap&&(e.lineCap="round"),"round"!==e.lineJoin&&(e.lineJoin="round"),i.canvasPattern)e.fillStyle=e.createPattern(i.canvasPattern.canvas,"repeat");else if(i.fillLinearGradient){for(var l=t.properties,h=i.fillLinearGradient,u=h.x1Function?h.x1Function(l):h.x1,m=h.y1Function?h.y1Function(l):h.y1,f=h.x2Function?h.x2Function(l):h.x2,g=h.y2Function?h.y2Function(l):h.y2,_=e.createLinearGradient(u,m,f,g),v=0,y=h.addColorStop.length;y>v;v++){var L=h.addColorStop[v],x=h.addColorStopFunctions[v],b=x[0]?x[0](l):L[0],P=L.length<3?100:x[2]?x[2](l):L[2],C=p.dec2color(x[1]?x[1](l):L[1],P>1?P/100:P);_.addColorStop(b,C)}e.fillStyle=i.fillStyle=_}},f=function(t,e,i,n){var o=t.properties,r=o[0],s=0,a=0,l=e.gmx,h=e.ctx,u=l.dataManager.getItem(r),c=o[o.length-1],d=null,f=t.dataOption,g=e.rasters,_=e.tbounds;n=n||{},u.currentStyle=L.extend({},i),l.styleHook&&!t.styleExtend&&(t.styleExtend=l.styleManager.applyStyleHook(u,l.lastHover&&r===l.lastHover.id)),t.styleExtend&&(u.currentStyle=L.extend(u.currentStyle,t.styleExtend)),m(u,h,u.currentStyle);var v=c.type,y={gmx:l,item:u,style:n,styleExtend:t.styleExtend||{},ctx:h,tpx:e.tpx,tpy:e.tpy};if("POINT"===v&&(y.pointAttr=p.getPixelPoint(y,c.coordinates),!y.pointAttr))return!1;if("POINT"===v||"MULTIPOINT"===v)if(d=c.coordinates,"iconColor"in n&&n.image&&(n.lastImage!==n.image&&(n.lastImage=n.image,n.lastImageData=p.getImageData(n.image)),y.imageData=n.lastImageData),"MULTIPOINT"===v)for(s=0,a=d.length;a>s;s++)y.coords=d[s],p.pointToCanvas(y);else y.coords=d,p.pointToCanvas(y);else if("POLYGON"===v||"MULTIPOLYGON"===v)if(n.image)y.coords=[(f.bounds.min.x+f.bounds.max.x)/2,(f.bounds.min.y+f.bounds.max.y)/2],y.pointAttr=p.getPixelPoint(y,y.coords),y.pointAttr&&p.pointToCanvas(y);else{y.flagPixels=!1,f.pixels||(f.pixels={}),d=c.coordinates;var x=f.hiddenLines||[],b={},P=!1;"POLYGON"===v&&(d=[d]);var C=function(t,e){var i=null;if(P)d=b.coords,x=b.hidden,y.flagPixels=P;else{i={coords:[],hidden:[]};var n=[],o=[]}for(s=0,a=d.length;a>s;s++){var r=d[s],l=x[s]||[];if(i)var u=[],c=[];h.beginPath();for(var p=0,m=r.length;m>p;p++){y.coords=r[p],y.hiddenLines=l[p]||[];var f=t(y);i&&f&&(u.push(f.coords),c.push(f.hidden))}h.closePath(),e&&h.fill(),i&&(n.push(u),o.push(c))}return i&&(i.coords=n,i.hidden=o),i},w=u.currentStyle.strokeStyle||n.strokeStyle,T=u.currentStyle.lineWidth||n.lineWidth;if(w&&T){var M=C(p.polygonToCanvas);M&&(b=M,b.z=l.currentZoom,f.pixels=b,P=!0)}g[r]&&(y.bgImage=g[r]),(y.styleExtend.skipRasters||u.skipRasters)&&delete y.bgImage,P&&(d=b.coords,x=b.hidden),n.imagePattern?u.currentStyle.fillStyle=h.createPattern(n.imagePattern,"repeat"):y.bgImage&&_.intersectsWithDelta(f.bounds,-1,-1)&&(p.isPatternNode(y.bgImage)&&("rasterOpacity"in l&&(h.globalAlpha=l.rasterOpacity),h.fillStyle=h.createPattern(y.bgImage,"no-repeat"),n.bgImage=!0),C(p.polygonToCanvasFill,!0),h.globalAlpha=1),(u.currentStyle.fillStyle||u.currentStyle.canvasPattern)&&(h.fillStyle=u.currentStyle.canvasPattern||u.currentStyle.fillStyle,C(p.polygonToCanvasFill,!0))}else if("LINESTRING"===v||"MULTILINESTRING"===v)if(d=c.coordinates,"MULTILINESTRING"===v)for(s=0,a=d.length;a>s;s++)y.coords=d[s],p.lineToCanvas(y);else y.coords=d,p.lineToCanvas(y);return!0};L.gmxUtil.drawGeoItem=function(t,e){var i=e.gmx,n=i.dataManager.getItem(t.id);if(n){var o=i.styleManager.getObjStyle(n),r=i.lastHover&&i.lastHover.id===t.id&&o;return i.multiFilters?n.multiFilters.forEach(function(i){f(t,e,r?i.parsedStyleHover:i.parsedStyle,o)}):f(t,e,r?n.parsedStyleHover:n.parsedStyleKeys,o),!0}return!1};var g=function(t,e){var i=!1,n=e.gmx,r=e.gmxTilePoint,s=n.mInPixel,a=e.geoItem,l=a.properties,h=a.dataOption||{},c=l[l.length-1].coordinates,d=s*h.bounds.min.x,p=s*h.bounds.max.y,m=n.tileAttributeIndexes,f=l[m[n.quicklookPlatform]]||n.quicklookPlatform||"",g={};if("LANDSAT8"===f)g.x1=h.bounds.min.x,g.y1=h.bounds.max.y,g.x2=h.bounds.max.x,g.y2=h.bounds.max.y,g.x3=h.bounds.max.x,g.y3=h.bounds.min.y,g.x4=h.bounds.min.x,g.y4=h.bounds.min.y,i=!0;else if("SPOT 6"===f)g.x1=c[0][0],g.y1=c[0][1],g.x2=c[1][0],g.y2=c[1][1],g.x3=c[2][0],g.y3=c[2][1],g.x4=c[3][0],g.y4=c[3][1],i=!0;else if("imageMercator"===f||"image"===f){if(g.x1=n.quicklookX1?l[m[n.quicklookX1]]:l[m.x1]||0,g.y1=n.quicklookY1?l[m[n.quicklookY1]]:l[m.y1]||0,g.x2=n.quicklookX2?l[m[n.quicklookX2]]:l[m.x2]||0,g.y2=n.quicklookY2?l[m[n.quicklookY2]]:l[m.y2]||0,g.x3=n.quicklookX3?l[m[n.quicklookX3]]:l[m.x3]||0,g.y3=n.quicklookY3?l[m[n.quicklookY3]]:l[m.y3]||0,g.x4=n.quicklookX4?l[m[n.quicklookX4]]:l[m.x4]||0,g.y4=n.quicklookY4?l[m[n.quicklookY4]]:l[m.y4]||0,"image"===f){var _=L.Projection.Mercator.project(L.latLng(g.y1,g.x1));g.x1=_.x,g.y1=_.y,_=L.Projection.Mercator.project(L.latLng(g.y2,g.x2)),g.x2=_.x,g.y2=_.y,_=L.Projection.Mercator.project(L.latLng(g.y3,g.x3)),g.x3=_.x,g.y3=_.y,_=L.Projection.Mercator.project(L.latLng(g.y4,g.x4)),g.x4=_.x,g.y4=_.y}i=!0,d=s*g.x1,p=s*g.y1}else g=u.getQuicklookPoints(c);var v=d-256*r.x,y=256-p+256*r.y,x=s*g.x1,b=s*g.y1,P=s*g.x2,C=s*g.y2,w=s*g.x3,T=s*g.y3,M=s*g.x4,S=s*g.y4,D=u.bounds([[x,b],[P,C],[w,T],[M,S]]),I=Math.round(D.max.x-D.min.x),k=Math.round(D.max.y-D.min.y);x-=D.min.x,b=D.max.y-b,P-=D.min.x,C=D.max.y-C,w-=D.min.x,T=D.max.y-T,M-=D.min.x,S=D.max.y-S;var E=[[x,b],[P,C],[w,T],[M,S]];if(!i){var A=function(t){for(var e=[],i=[],n=t[3][0],o=t[3][1],r=0,s=t.length;s>r;r++){var a=t[r][0],l=t[r][1],h=a-n,u=l-o;i.push({d2:Math.sqrt(h*h+u*u),i:r}),n=a,o=l}if(i=i.sort(function(t,e){return t.d2-e.d2}),e=t,i[3].d2/i[0].d2>2){e=[];var c=t[i[0].i][1]<t[i[1].i][1]?i[0].i:i[1].i;e.push(t[(c+3)%4]),e.push(t[(c+4)%4]),e.push(t[(c+5)%4]),e.push(t[(c+6)%4])}return e};E=A(E)}n.ProjectiveImage||(n.ProjectiveImage=new o);var O=n.ProjectiveImage.getCanvas({imageObj:t,points:E,wView:I,hView:k,deltaX:v,deltaY:y});return O.canvas},_={APIKEY_PARAM:"key",SCRIPT_REGEXP:/\bleaflet-geomixer(-\w*)?\.js\b/,_scriptSearched:!1,_scriptAPIKey:null,_searchScriptAPIKey:function(){var t=this;if(this._scriptSearched)return this._scriptAPIKey;for(var e=document.getElementsByTagName("script"),i=0;i<e.length;i++){var n=e[i].getAttribute("src");if(this.SCRIPT_REGEXP.exec(n)){var o=n.split("?")[1];o&&o.split("&").forEach(function(e){var i=e.split("=");i[0]===t.APIKEY_PARAM&&(t._scriptAPIKey=i[1])});break}}return this._scriptSearched=!0,this._scriptAPIKey},requestSessionKey:function(t,e){var i=this._sessionKeys;return t in i||(e="undefined"==typeof e?this._searchScriptAPIKey():e,i[t]=new L.gmx.Deferred,e?u.requestJSONP("http://"+t+"/ApiKey.ashx",{WrapStyle:"func",Key:e}).then(function(e){e&&"ok"===e.Status?i[t].resolve(e.Result.Key):i[t].reject()}):i[t].resolve("")),i[t]},getSessionKey:function(t){var e=this._sessionKeys[t];return e&&e.getFulfilledData()&&e.getFulfilledData()[0]},_sessionKeys:{}},v={getMap:function(t,e,i){var n=this._maps;if(!n[t]||!n[t][i]){var o=new L.gmx.Deferred;n[t]=n[t]||{},n[t][i]={promise:o},_.requestSessionKey(t,e).then(function(e){u.requestJSONP("http://"+t+"/TileSender.ashx",{WrapStyle:"func",key:e,MapName:i,ModeKey:"map"}).then(function(e){e&&"ok"===e.Status&&e.Result?(e.Result.properties.hostName=t,o.resolve(e.Result)):o.reject(e)})})}return n[t][i].promise},findLayerInfo:function(t,e,i){var n=this._maps[t],o=n&&n[e];if(!o)return null;if(o.layers)return o.layers[i];var r=o.promise.getFulfilledData();return r?(o.layers={},v.iterateLayers(r[0],function(t){o.layers[t.properties.name]=t}),o.layers[i]):null},_maps:{}};v.iterateLayers=function(t,e){var i=function(t){for(var n=0,o=t.length;o>n;n++){var r=t[n];"group"===r.type?i(r.content.children):"layer"===r.type&&e(r.content)}};t&&i(t.children)};var y=function(t,e){this.layers=[],this.layersByTitle={},this.layersByID={};var i=this;this.properties=L.extend({},t.properties),this.properties.BaseLayers=this.properties.BaseLayers?JSON.parse(this.properties.BaseLayers):[],this.rawTree=t,v.iterateLayers(t,function(n){var o,r=n.properties,s=L.extend({mapName:t.properties.name,layerID:r.name},e);o="Vector"===r.type?new L.gmx.VectorLayer(s):new L.gmx.RasterLayer(s),n.properties.hostName=t.properties.hostName,o.initFromDescription(n),i.addLayer(o)})};y.prototype.addLayer=function(t){var e=t.getGmxProperties();this.layers.push(t),this.layersByTitle[e.title]=t,this.layersByID[e.name]=t};var x=L.Handler.extend({options:{},initialize:function(t){this._map=t,this._layers={},this._lastLayer=null,this._lastId=null;var e=this;this._drawstart=!1,this._lastCursor="",t.gmxDrawing&&(t.gmxDrawing.on("drawstart",function(){this._drawstart=!0},this),t.gmxDrawing.on("drawstop",function(){this._drawstart=!1},this));var i=function(t){for(var e=t._container,i=e.parentNode.childNodes,n=0,o=i.length;o>n;n++)if(e===i[n])return n;return 0},n={IMG:!0,path:!0},o=function(i){var o=i.type;if(e._map.gmxMouseDown=L.Browser.webkit?i.originalEvent.which:i.originalEvent.buttons,!(e._map._animatingZoom||e._drawstart||"mousemove"===o&&e._map.gmxMouseDown)){e._map.gmxMousePos=e._map.getPixelOrigin().add(i.layerPoint);var r,s=0,a="";if(!n[i.originalEvent.target.nodeName])for(var l=Object.keys(e._layers).sort(function(t,i){var n=e._map._layers[t],o=e._map._layers[i];if(n&&o){var r=n.options,s=o.options,a=(r.zoomOffset||0)+(r.zIndex||0),l=(s.zoomOffset||0)+(s.zIndex||0),h=l-a;return h?h:e._layers[i]-e._layers[t]}return 0}),h=0,u=l.length;u>h;h++){var c=l[h];if(r=e._map._layers[c],r&&!r._animating&&(s=r.gmxEventCheck(i))){a="pointer";break}}!e._lastLayer||e._lastLayer===r&&e._lastId===s||e._map.gmxMouseDown||e._lastLayer.gmxEventCheck({type:"mousemove"},!0),e._lastCursor!==a&&(t._container.style.cursor=a),e._lastCursor=a,a&&(e._lastLayer=r,e._lastId=s)}};t.on({click:function(t){e.clickPointTimer&&clearTimeout(e.clickPointTimer),e.clickPointTimer=setTimeout(function(){clearTimeout(e.clickPointTimer),o(t)},0)},dblclick:o,mousedown:o,mouseup:o,mousemove:o,contextmenu:o,layeradd:function(t){var n=t.layer;"gmxEventCheck"in n&&n.options.clickable&&(e._layers[n._leaflet_id]=i(n))},layerremove:function(t){var i=t.layer._leaflet_id;delete e._layers[i],e._lastLayer&&e._lastLayer._leaflet_id===i&&(e._lastLayer=null,e._lastId=0)}},this)}});L.Map.addInitHook(function(){this._gmxEventsManager||(this._gmxEventsManager=new x(this),this.on("remove",function(){this._gmxEventsManager&&this._gmxEventsManager.removeHooks()}))});var b={_loadedTiles:{},_getKey:function(t){return[t.layerID,t.x,t.y,t.z,"undefined"==typeof t.d?-1:t.d,"undefined"==typeof t.s?-1:t.s,t.v].join(":")},load:function(t,e){var i=b._getKey(e);if(!this._loadedTiles[i]){var n=new L.gmx.Deferred;this._loadedTiles[i]=n;var o={ModeKey:"tile",r:"j",LayerName:e.layerID,z:e.z,x:e.x,y:e.y,v:e.v};-1!==e.d&&(o.Level=e.d,o.Span=e.s),u.requestJSONP(t,o,{callbackParamName:null}).then(null,function(){n.reject()})}return this._loadedTiles[i]}};window.gmxAPI=window.gmxAPI||{},window.gmxAPI._vectorTileReceiver=window.gmxAPI._vectorTileReceiver||function(t){var e=b._getKey({layerID:t.LayerName,x:t.x,y:t.y,z:t.z,d:t.level,s:t.span,v:t.v});b._loadedTiles[e]&&b._loadedTiles[e].resolve(t.values)},L.gmx.VectorLayer=L.TileLayer.Canvas.extend({options:{clickable:!0},initialize:function(t){t=L.setOptions(this,t),this.initPromise=new L.gmx.Deferred,this._drawQueue=[],this._drawQueueHash={};var e=this;this._gmx={hostName:t.hostName||"maps.kosmosnimki.ru",mapName:t.mapID,layerID:t.layerID,beginDate:t.beginDate,endDate:t.endDate,sortItems:t.sortItems||null,styles:t.styles||[],units:t.units||{square:"km2",distance:"km",coordinates:0},screenTiles:{},tileSubscriptions:{},_tilesToLoad:0,getDeltaY:function(){var t=e._map;if(!t)return 0;var i=t.getCenter();return t.options.crs.project(i).y-L.Projection.Mercator.project(i).y},renderHooks:[]},t.crossOrigin&&(this._gmx.crossOrigin=t.crossOrigin),this.on("tileunload",function(t){e._clearTileSubscription(t.tile.zKey)})},_clearTileSubscription:function(t){var e=this._gmx,i=e.screenTiles;t in e.tileSubscriptions&&(e.dataManager.getObserver(t).deactivate(),e.dataManager.removeObserver(t),delete e.tileSubscriptions[t]);for(var n=this._drawQueue.length-1;n>=0;n--){var o=this._drawQueue[n];o.zKey===t&&(o.def.cancel(),this._drawQueue.splice(n,1))}delete this._drawQueueHash[t],i[t]&&(i[t].cancel(),delete i[t])},_clearAllSubscriptions:function(){for(;this._drawQueue.length;)this._drawQueue[0].def.cancel();var t=this._gmx,e=t.tileSubscriptions;for(var i in e)delete e[i],t.dataManager.getObserver(i).deactivate(),t.dataManager.removeObserver(i),i in this._drawQueueHash&&this._drawQueueHash[i].reject(),t.screenTiles[i]&&(t.screenTiles[i].cancel(),delete t.screenTiles[i]);this._drawQueueHash={},t._tilesToLoad=0},_zoomStart:function(){this._gmx.zoomstart=!0},_zoomEnd:function(){this._gmx.zoomstart=!1},_moveEnd:function(){"dataManager"in this._gmx&&this._gmx.dataManager.fire("moveend")},onAdd:function(t){if(t.options.crs!==L.CRS.EPSG3857&&t.options.crs!==L.CRS.EPSG3395)throw"GeoMixer-Leaflet: map projection is incompatible with GeoMixer layer";var e=this,i=this._gmx;i.applyShift=t.options.crs===L.CRS.EPSG3857,L.TileLayer.Canvas.prototype.onAdd.call(this,t),i.styleManager.initStyles(),t.on("zoomstart",this._zoomStart,this),t.on("zoomend",this._zoomEnd,this),i.applyShift?(t.on("moveend",this._updateShiftY,this),this._updateShiftY()):i.shiftY=0,"Vector"===i.properties.type&&t.on("moveend",this._moveEnd,this),this.fire("add"),this.options.clickable===!1&&(this._container.style.pointerEvents="none"),i.balloonEnable&&!this._popup&&this.bindPopup(),this.on("stylechange",function(){!i.balloonEnable&&e._popup?e.unbindPopup():i.balloonEnable&&!e._popup&&e.bindPopup(),e._map&&(i.labelsLayer?e._map._labelsLayer.add(e):i.labelsLayer||e._map._labelsLayer.remove(e))})},onRemove:function(t){L.TileLayer.Canvas.prototype.onRemove.call(this,t),this._clearAllSubscriptions(),t.off("zoomstart",this._zoomStart,this),t.off("zoomend",this._zoomEnd,this);var e=this._gmx;delete e.map,e.applyShift&&t.off("moveend",this._updateShiftY,this),"Vector"===e.properties.type&&t.off("moveend",this._moveEnd,this),this.fire("remove")},initFromDescription:function(t){var e=this._gmx,i=this.options.apikeyRequestHost||e.hostName,n=this.options.sessionKey||_.getSessionKey(i);return e.sessionKey=n,e.tileSenderPrefix="http://"+e.hostName+"/"+"TileSender.ashx?WrapStyle=None"+"&key="+encodeURIComponent(n),e.properties=t.properties,e.geometry=t.geometry,e.rawProperties=t.properties,this.initLayerData(t),e.dataManager=new l(e,t),e.styleManager=new r(e),e.dataManager.on("observeractivate",function(){e.dataManager.getActiveObserversCount()?L.gmx.layersVersion.add(this):L.gmx.layersVersion.remove(this)},this),"Vector"!==e.properties.type||"chkUpdate"in this.options||(this.options.chkUpdate=!0),this.initPromise.resolve(),this},setRasterOpacity:function(t){var e=this;return this._gmx.rasterOpacity=t,this.initPromise.then(function(){e.repaint()}),this},getStyles:function(){return this._gmx.styleManager.getStyles()},getIcons:function(t){return this._gmx.styleManager.getIcons(t),this},setStyles:function(t){var e=this;return this.initPromise.then(function(){e._gmx.styleManager.clearStyles(),(t||[]).forEach(function(t,i){e.setStyle(t,i,!0)})}),this},getStyle:function(t){return this.getStyles()[t]},setStyle:function(t,e,i){var n=this,o=this._gmx;return this.initPromise.then(function(){o.styleManager.setStyle(t,e,i),n.fire("stylechange",{num:e||0}),o.styleManager.deferred.then(function(){n.repaint()})}),this},setStyleHook:function(t){return this._gmx.styleHook=t,this},removeStyleHook:function(){this._gmx.styleHook=null},setImageProcessingHook:function(t){return this._gmx.imageProcessingHook=t,this.repaint(),this},removeImageProcessingHook:function(){this._gmx.imageProcessingHook=null,this.repaint()},setFilter:function(t){return this._gmx.dataManager.addFilter("userFilter",function(e){return!t||t(e)?e.properties:null}),this},removeFilter:function(){return this._gmx.dataManager.removeFilter("userFilter"),this},setDateInterval:function(t,e){var i=this._gmx;i.beginDate=t,i.endDate=e;var n=null;for(var o in i.tileSubscriptions)n=i.dataManager.getObserver(o),n.setDateInterval(t,e);return n=i.dataManager.getObserver("_Labels"),n&&n.setDateInterval(t,e),this.repaint(),this},getDateInterval:function(){return[this._gmx.dateBegin,this._gmx.dateEnd]},addObserver:function(t){return this._gmx.dataManager.addObserver(t)},removeObserver:function(t){return this._gmx.dataManager.removeObserver(t.id)},addTo:function(t){return t.addLayer(this),this},_drawTileAsync:function(t,e,i){var n=this._drawQueue,o=0===n.length,r=e+":"+t.x+":"+t.y,s=this;this._drawQueueHash[r]&&this._drawQueueHash[r].cancel();var a=function(){if(!n.length)return s.fire("doneDraw"),void 0;var t=n.shift();delete s._drawQueueHash[t.zKey],s._map&&t.z===s._map._zoom?(t.drawDef=s._gmxDrawTile(t.tp,t.z,t.data),t.drawDef.then(t.def.resolve.bind(t.def,t.data),t.def.reject.bind(t.def))):t.def.reject(),setTimeout(a,0)},l=u.getTileNumFromLeaflet(t,e),h={gtp:l,tp:t,z:e,zKey:r,data:i},c=h.def=new L.gmx.Deferred(function(){h.drawDef&&h.drawDef.cancel(),delete s._drawQueueHash[r];for(var t=n.length-1;t>=0;t--){var e=n[t];if(e.zKey===r){n.splice(t,1);break}}});return n.push(h),this._drawQueueHash[r]=c,o&&(this.fire("startDraw"),setTimeout(a,0)),c},_updateShiftY:function(){var t=this._gmx,e=t.getDeltaY();t.shiftX=Math.floor(t.mInPixel*(t.shiftXlayer||0)),t.shiftY=Math.floor(t.mInPixel*(e+(t.shiftYlayer||0)));for(var i in this._tiles){var n=this._tiles[i],o=this._getTilePos(n._tilePoint);o.x+=t.shiftX,o.y-=t.shiftY,L.DomUtil.setPosition(n,o,L.Browser.chrome||L.Browser.android23)}this._update()},_prpZoomData:function(){var t=this._gmx,e=this._map;
t.currentZoom=e._zoom,t.tileSize=u.tileSizes[t.currentZoom],t.mInPixel=256/t.tileSize,this.repaint()},setZIndexOffset:function(t){arguments.length&&(this.options.zIndexOffset=t);var e=this.options,i=e.zIndex,n=e.zIndexOffset;n&&this.setZIndex(n+i)},_initContainer:function(){L.TileLayer.Canvas.prototype._initContainer.call(this),this._prpZoomData(),this.setZIndexOffset()},_update:function(){var t=this._gmx,e=this;this._map&&t.styleManager.deferred.then(function(){if(e._map){var i=e._map.getZoom();if(!(i>e.options.maxZoom||i<e.options.minZoom)){var n=e._getScreenTileBounds();e._addTilesFromCenterOut(n),(e.options.unloadInvisibleTiles||e.options.reuseTiles)&&e._removeOtherTiles(n);var o=t.dataManager;for(var r in t.tileSubscriptions){var s=t.tileSubscriptions[r];if(s.z!==i)e._clearTileSubscription(r);else{var a=o.getObserver(r);s.x<n.min.x||s.x>n.max.x||s.y<n.min.y||s.y>n.max.y?a.deactivate():a.activate()}}}}})},_getScreenTileBounds:function(){var t=this._map,e=t._zoom,i=Math.pow(2,e),n=t.getPixelBounds(),o=this._gmx.shiftX||0,r=this._gmx.shiftY||0,s=this.options.tileSize;n.min.y+=r,n.max.y+=r,n.min.x-=o,n.max.x-=o;var a=new L.Point(Math.floor(n.min.x/s),Math.floor(n.min.y/s)),l=new L.Point(Math.floor(n.max.x/s),Math.floor(n.max.y/s));return a.y<0&&(a.y=0),l.y>=i&&(l.y=i-1),new L.Bounds(a,l)},_addTile:function(t){var e=this,i=this._map._zoom,n=this._gmx;if(!n.layerType||!n.styleManager.isVisibleAtZoom(i))return this._tileLoaded(),void 0;var o=i+":"+t.x+":"+t.y;if(!n.tileSubscriptions[o]){n._tilesToLoad++;var r=!1,s=u.getTileNumFromLeaflet(t,i),a={type:"resend",bbox:n.styleManager.getStyleBounds(s),filters:["styleFilter","userFilter"],callback:function(o){e._drawTileAsync(t,i,o).then(function(){r||(n._tilesToLoad--,e._tileLoaded(),r=!0)},function(){r||(n._tilesToLoad--,e._tileLoaded(),r=!0)})}};"VectorTemporal"===n.layerType&&(a.dateInterval=[n.beginDate,n.endDate]);var l=n.dataManager.addObserver(a,o);e.on("stylechange",function(){var t=n.styleManager.getStyleBounds(s);l.bbox.isEqual(t)||l.setBounds(t)},this),l.on("activate",function(){l.isActive()||r||(n._tilesToLoad--,e._tileLoaded(),r=!0)}),n.tileSubscriptions[o]={z:i,x:t.x,y:t.y,px:256*s.x,py:256*(1+s.y)}}},_gmxDrawTile:function(e,i,n){var o=this._gmx,r=new L.gmx.Deferred;if(!this._map)return r.reject(),r;i=i||this._map._zoom;var s=o.screenTiles,a=i+":"+e.x+":"+e.y,l=null;return s[a]?l=s[a]:s[a]=l=new t(this,e,i),o.styleManager.deferred.then(function(){l.drawTile(n).then(r.resolve.bind(r,n),r.reject.bind(r))}),r},gmxGetCanvasTile:function(t){var e=t.x+":"+t.y;if(e in this._tiles)return this._tiles[e];var i=this._getTile();return i._zoom=this._map._zoom,i._layer=this,i._tileComplete=!0,i._tilePoint=t,this._tiles[e]=i,this.tileDrawn(i),this._tiles[e]},appendTileToContainer:function(t){this._tileContainer.appendChild(t);var e=this._getTilePos(t._tilePoint);e.x+=this._gmx.shiftX||0,e.y-=this._gmx.shiftY||0,L.DomUtil.setPosition(t,e,L.Browser.chrome||L.Browser.android23)},_getLoadedTilesPercentage:function(t){if(!t)return 0;var e=0,i=0,n=["img","canvas"];for(var o in n){var r=t.getElementsByTagName(n[o]);if(r&&r.length>0){e+=r.length;for(var s=0,a=r.length;a>s;s++)r[s]._tileComplete&&i++}}return 1>e?0:i/e},_tileLoaded:function(){this._animated&&L.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),0===this._gmx._tilesToLoad&&(this.fire("load"),this._animated&&(this._clearBgBufferTimer&&clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(L.bind(this._clearBgBuffer,this),0)))},_tileOnLoad:function(t){t&&L.DomUtil.addClass(t,"leaflet-tile-loaded"),this._tileLoaded()},tileDrawn:function(t){this._tileOnLoad(t)},_getTilesByBounds:function(t,e,i){var n=this._gmx,o=this._map._zoom,r=n.shiftX||0,s=n.shiftY||0,a=L.Projection.Mercator.unproject(new L.Point(t.min.x,t.min.y)),l=L.Projection.Mercator.unproject(new L.Point(t.max.x,t.max.y)),h=this._map.getBounds(),u=h.getSouthWest(),c=h.getNorthEast(),d=0;c.lng-u.lng<360&&(l.lng<u.lng?d=360*(1+Math.floor((u.lng-l.lng)/360)):a.lng>c.lng&&(d=360*Math.floor((c.lng-a.lng)/360))),a.lng+=d,l.lng+=d;var p=i?null:this._map.getPixelBounds(),m=this._map.project(a),f=this._map.project(l);e=e||0;var g,_,v,y;p?(g=Math.floor((Math.max(f.y,p.min.y)+s-e)/256),_=Math.floor((Math.min(m.y,p.max.y)+s+e)/256),v=a.lng<-180?p.min.x:Math.max(m.x,p.min.x),v=Math.floor((v+r-e)/256),y=l.lng>180?p.max.x:Math.min(f.x,p.max.x),y=Math.floor((y+r+e)/256)):(g=Math.floor((f.y+s-e)/256),_=Math.floor((m.y+s+e)/256),v=Math.floor((m.x+r-e)/256),y=Math.floor((f.x+r+e)/256));for(var x={},b=v;y>=b;b++)for(var P=g;_>=P;P++){var C=o+":"+b+":"+P;x[C]=!0}return x},repaint:function(){this._map&&this._gmx.dataManager._triggerObservers()},redrawItem:function(t){var e=this._gmx.dataManager.getItem(t),i=this._getTilesByBounds(e.bounds,0,!0);this._redrawTilesHash(i)},_redrawTilesHash:function(t){var e=this._gmx.dataManager;for(var i in t){var n=e.getObserver(i);n&&n.updateData(e.getItems(i))}},initLayerData:function(t){var e=this._gmx,i=t.properties,n=i.type||"Vector";i.Temporal&&(n+="Temporal"),e.items={},e.tileCount=0,this.options.attribution=i.Copyright||"";var o;if("VectorTemporal"===n){o=i.TemporalTiles,e.TemporalColumnName=i.TemporalColumnName,e.TemporalPeriods=i.TemporalPeriods||[];var r=i.ZeroDate||"01.01.2008",s=r.split("."),a=new Date(s.length>2?s[2]:2008,s.length>1?s[1]-1:0,s.length>0?s[0]:1);e.ZeroDate=new Date(a.getTime()-6e4*a.getTimezoneOffset()),e.ZeroUT=e.ZeroDate.getTime()/1e3}if(e.tileCount=o,e.layerType=n,e.identityField=i.identityField,e.GeometryType=i.GeometryType,e.minZoomRasters=i.RCMinZoomForRasters,e.sortItems||"polygon"!==e.GeometryType||e.objectsReorder.setSortFunc(function(t,e){return t.id-e.id}),"MetaProperties"in i){var l=i.MetaProperties;("shiftX"in l||"shiftY"in l)&&(e.shiftXlayer=l.shiftX?Number(l.shiftX.Value):0,e.shiftYlayer=l.shiftY?Number(l.shiftY.Value):0),("shiftXfield"in l||"shiftYfield"in l)&&(l.shiftXfield&&(e.shiftXfield=l.shiftXfield.Value),l.shiftYfield&&(e.shiftYfield=l.shiftYfield.Value)),"quicklookPlatform"in l&&(e.quicklookPlatform=l.quicklookPlatform.Value),"quicklookX1"in l&&(e.quicklookX1=l.quicklookX1.Value),"quicklookY1"in l&&(e.quicklookY1=l.quicklookY1.Value),"quicklookX2"in l&&(e.quicklookX2=l.quicklookX2.Value),"quicklookY2"in l&&(e.quicklookY2=l.quicklookY2.Value),"quicklookX3"in l&&(e.quicklookX3=l.quicklookX3.Value),"quicklookY3"in l&&(e.quicklookY3=l.quicklookY3.Value),"quicklookX4"in l&&(e.quicklookX4=l.quicklookX4.Value),"quicklookY4"in l&&(e.quicklookY4=l.quicklookY4.Value),"multiFilters"in l&&(e.multiFilters="1"===l.multiFilters.Value?!0:!1)}var h={},u={};if(i.attributes){var c=i.attributes,d=i.attrTypes||null;e.identityField&&(h[e.identityField]=0);for(var p=0;p<c.length;p++){var m=c[p];h[m]=p+1,u[m]=d?d[p]:"string"}}if(e.tileAttributeTypes=u,e.tileAttributeIndexes=h,e.getPropItem=function(t,i){var n=e.tileAttributeIndexes;return i in n?t[n[i]]:""},i.IsRasterCatalog){e.IsRasterCatalog=i.IsRasterCatalog;var f=e.tileAttributeIndexes.GMX_RasterCatalogID;f&&(e.rasterBGfunc=function(t,i,n,o){var r=o.properties;return"http://"+e.hostName+"/TileSender.ashx?ModeKey=tile"+"&x="+t+"&y="+i+"&z="+n+"&LayerName="+r[f]+"&MapName="+e.mapName+"&key="+encodeURIComponent(e.sessionKey)},e.imageQuicklookProcessingHook=g)}if(i.Quicklook){var _=e.Quicklook=i.Quicklook;e.quicklookBGfunc=function(t){for(var i=_,n=/\[([^\]]+)\]/,o=n.exec(i);o&&o.length>1;)i=i.replace(o[0],t.properties[e.tileAttributeIndexes[o[1]]]),o=n.exec(i);return i}}},addData:function(t,e){return this._gmx.mapName||(this._gmx.dataManager.addData(t,e),this.repaint()),this},removeData:function(t,e){return this._gmx.mapName||(this._gmx.dataManager.removeData(t,e),this.repaint()),this},getItemProperties:function(t){var e={},i=this._gmx.tileAttributeIndexes;for(var n in i)e[n]=t[i[n]];return e},addRenderHook:function(t){this._gmx.renderHooks.push(t),this.repaint()},getGmxProperties:function(){return this._gmx.rawProperties},getBounds:function(){var t=u.geoItemBounds(this._gmx.geometry).bounds,e=L.Projection.Mercator;return t?L.latLngBounds([e.unproject(t.min),e.unproject(t.max)]):new L.LatLngBounds},getGeometry:function(){return this._gmx.latLngGeometry||(this._gmx.latLngGeometry=L.gmxUtil.geometryToGeoJSON(this._gmx.geometry,!0)),this._gmx.latLngGeometry}}),L.gmx.VectorLayer.include({bindPopup:function(t,e){return this._popup&&this.unbindPopup(),t instanceof L.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new L.Popup(e)),this._popup.setContent(t)),this._popup._initContent=t,this._popup._state="",this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("mousemove",this._movePopup,this).on("mouseover",this._overPopup,this).on("mouseout",this._outPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),e&&e.popupopen&&(this._popupopen=e.popupopen),this._popup.updateLayout=this._popup._updateLayout,this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup,this).off("mousemove",this._movePopup,this).off("mouseover",this._overPopup,this).off("mouseout",this._outPopup,this).off("remove",this.closePopup,this),this._popupopen=null,this._popupHandlersAdded=!1),this._gmx.balloonEnable=!1,this},openPopup:function(t,e){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],e=e||{},e.latlng=t,this._openPopup(e)),this},closePopup:function(){return this._popup&&(this._popup._close(),this.fire("popupclose",{popup:this._popup})),this},_movePopup:function(t){if(t.originalEvent&&t.originalEvent.ctrlKey)this.closePopup();else if("mouseover"===this._popup._state){var e=this._popup.options._gmxID||-1;e!==t.gmx.id&&this._setPopupContent(t),this._popup.setLatLng(t.latlng)}},_overPopup:function(t){this._popup._map||this._openPopup(t),"mouseover"===this._popup._state&&this._popup.setLatLng(t.latlng)},_outPopup:function(){"mouseover"===this._popup._state&&this.closePopup()},_setPopupContent:function(t){var e=t.gmx||{},i=e.balloonData||{},n=e.properties,o=e.target,r=o.geometry,s=this._popup._initContent||i.templateBalloon,a={id:e.id,latlng:t.latlng,properties:e.properties,templateBalloon:s};if("POINT"===r.type){var l=r.coordinates;a.latlng=L.Projection.Mercator.unproject({x:l[0],y:l[1]})}if(this._popupopen)this._popupopen({popup:this._popup,latlng:a.latlng,layerPoint:t.layerPoint,contentNode:this._popup._contentNode,containerPoint:t.containerPoint,originalEvent:t.originalEvent,gmx:a});else if(!(s instanceof L.Popup)){if(!(s instanceof HTMLElement)){if(!s){s="";for(var h in n)s+="<b>"+h+":</b> ["+h+"]<br />"}for(var u=/\[([^\]]+)\]/i,c=u.exec(s);c&&c.length>1;){var d=c[1],p=this._gmx.tileAttributeTypes[d],m=d in n?n[d]:"";if("date"===p)m=L.gmxUtil.getUTCdate(m);else if("time"===p)m=L.gmxUtil.getUTCtime(m);else if("datetime"===p)m=L.gmxUtil.getUTCdateTime(m);else if("SUMMARY"===d&&!m){var f=this._gmx.dataManager.getItemGeometries(e.id);m=a.summary=L.gmxUtil.getGeometriesSummary(f,this._gmx.units)}s=s.replace(c[0],m),c=u.exec(s)}}this._popup.setContent(s),a.templateBalloon=s}return this._popup.options._gmxID=e.id,a},_openPopup:function(t){var e=t.originalEvent||{},i=e.ctrlKey||e.altKey||e.shiftKey;if(!i){var n=t.type,o=t.gmx||{},r=o.balloonData||{};if(this._popup._state=n,"click"===n){if(r.DisableBalloonOnClick&&!this.hasEventListeners("popupopen"))return;this._popup.options.closeButton=this._popup.options.autoPan=!0}else{if("mouseover"!==n)return;if(r.DisableBalloonOnMouseMove)return this._popup._state="",void 0;this._popup.options.closeButton=this._popup.options.autoPan=!1}var s=this._setPopupContent(t);this._popup.setLatLng(s.latlng),this.fire("popupopen",{popup:this._popup,gmx:s}),this._popup._initLayout(),"mouseover"===n&&(this._popup._container.style.marginBottom="7px"),this._map.openPopup(this._popup)}}}),L.gmx.VectorLayer.include({_gmxFirstObjectsByPoint:function(t,e){for(var i=this._gmx,n=i.mInPixel,o=u.bounds([e]),r=t.length-1;r>=0;r--){var s=t[r].properties,a=s[0],l=t[r].dataOption||{},h=i.dataManager.getItem(a),c=h.currentStyle||h.parsedStyleKeys,d=c.iconScale||1,p=c.sx||0,m=c.sy||0,f=i.styleManager.getObjStyle(h),g=c.lineWidth||f.lineWidth||0,_=d*(p+g/2)/n,v=d*(m+g/2)/n;if(_>v?_=v:v=_,l.bounds.intersectsWithDelta(o,_,v)){var y=s[s.length-1],L=c.fillStyle||c.canvasPattern||f.bgImage,x=f&&f.image?f.image:null,b=y.type,P=b,C=l.hiddenLines,w=l.boundsArr,T=y.coordinates,M={point:e,bounds:o,coords:T,boundsArr:w};if(("MULTIPOLYGON"===b||"POLYGON"===b)&&(x?P="POINT":L||("POLYGON"===b?(P="MULTILINESTRING",C=C[0]):P="LIKEMULTILINESTRING",M.hidden=C)),"LINESTRING"===P){if(!u.isPointInPolyLine(e,g/n,T))continue}else if("LIKEMULTILINESTRING"===P){M.delta=g/n;var S,D,I=!1;for(S=0,D=T.length;D>S;S++)if(M.coords=T[S],M.hidden=C[S],M.boundsArr=w[S],u.isPointInLines(M)){I=!0;break}if(!I)continue}else if("MULTILINESTRING"===P){if(M.delta=g/n,M.hidden=C,!u.isPointInLines(M))continue}else if("MULTIPOLYGON"===P||"POLYGON"===P){var k=e;for(I=!1,"POLYGON"===P&&(T=[y.coordinates],w=[l.boundsArr]),S=0,D=T.length;D>S;S++)for(var E=T[S],A=w[S],O=0,R=E.length;R>O;O++){var N=A[O];if(N.intersects(o)&&u.isPointInPolygonWithHoles(k,E)){I=0===O?!0:!1;break}}if(!I)continue}else if("POINT"===P&&!l.bounds.intersectsWithDelta(o,_/2,v/2))continue;return{id:a,properties:h.properties,geometry:y,bounds:h.bounds,parsedStyle:f}}}return null},gmxEventCheck:function(t,e){var i=this,n=i._gmx,o=t.type,r=n.lastHover,s=function(e){r&&"mousemove"===o&&(e&&i.hasEventListeners(e)&&(t.gmx=r,i.fire(e,t)),r.observersToUpdate&&i._redrawTilesHash(r.observersToUpdate))};if(!e&&t.originalEvent&&("mousemove"===o||this.hasEventListeners("mouseover")||this.hasEventListeners("mouseout")||this.hasEventListeners(o))){var a=t.originalEvent.target.zKey;if(!a){var l=i._map.gmxMousePos,h=l.x+n.shiftX,c=l.y+n.shiftY;a=this._map._zoom+":"+Math.floor(h/256)+":"+Math.floor(c/256)}var d=n.dataManager.getObserver(a);if(d){var p=t.latlng.lng%360,m=new L.LatLng(t.latlng.lat,p+(-180>p?360:p>180?-360:0)),f=L.Projection.Mercator.project(m)._subtract({x:n.shiftXlayer||0,y:n.shiftYlayer||0}),g=5/n.mInPixel,_=[f.x,f.y],v=u.bounds([_]);v=v.addBuffer(g);var y=n.dataManager.getItems(a,v);if(y&&y.length){y.length>1&&n.sortItems&&(y=y.sort(n.sortItems));var x=this._gmxFirstObjectsByPoint(y,_);if(x){var b=x.id,P=n.dataManager.getItem(b),C=!r||r.id!==b;if("mousemove"===o&&r){if(!C)return t.gmx=r,this.fire(o,t),b;s(P.currentFilter!==r.currentFilter?"mouseout":""),n.lastHover=null}if(t.gmx={layer:this,targets:y,target:x,balloonData:n.styleManager.getItemBalloon(b),properties:i.getItemProperties(x.properties),currentFilter:P.currentFilter,id:b},this.hasEventListeners(o)&&this.fire(o,t),"mousemove"===o&&C){if(r=n.lastHover=t.gmx,P.hoverDiff){var w=n.styleManager.getObjStyle(P);w&&(r.observersToUpdate=i._getTilesByBounds(x.bounds,w.maxSize||256))}s("mouseover")}return this._map.doubleClickZoom.disable(),b}}}}return e&&"mousedown"!==o&&"mouseup"!==o&&(n.lastHover=null,s("mouseout")),this._map.doubleClickZoom.enable(),0}}),L.gmx.RasterLayer=L.gmx.VectorLayer.extend({options:{clickable:!1},initFromDescription:function(t){var e=t.properties,i={type:"Vector",fromType:e.type,identityField:"ogc_fid",GeometryType:"POLYGON",IsRasterCatalog:!0,Copyright:e.Copyright||"",RCMinZoomForRasters:e.styles[0].MinZoom,visible:e.visible,styles:[{MinZoom:e.styles[0].MinZoom,MaxZoom:e.styles[0].MaxZoom,RenderStyle:{outline:{thickness:0},fill:{opacity:100}},HoverStyle:null}]},n=this._gmx,o=u.tileSizes[1];t.geometry||(t.geometry={type:"POLYGON",coordinates:[[[-o,-o],[-o,o],[o,o],[o,-o],[-o,-o]]]});var r=[[777,t.geometry]],a=u.geoItemBounds(t.geometry),l=a.bounds;if(l.max.x>o){var h=2*o,c=777,d=t.geometry.coordinates,p=a.boundsArr;r=[],"POLYGON"===t.geometry.type&&(d=[d],p=[p]);for(var m=0,f=d.length;f>m;m++){var g=d[m],_=p[m][0],v=g;if(r.push([c++,{type:"POLYGON",coordinates:v}]),_.max.x>o){v=[];for(var y=0,x=g.length;x>y;y++){for(var b=g[y],P=0,C=[],w=b.length;w>P;P++){var T=b[P];C.push([T[0]-h,T[1]])}v.push(C)}r.push([c++,{type:"POLYGON",coordinates:v}])}}}L.gmx.VectorLayer.prototype.initFromDescription.call(this,{geometry:t.geometry,properties:i}),n.rawProperties=t.properties,n.rasterBGfunc=function(t,e,i){var o="http://"+n.hostName+"/"+"TileSender.ashx?ModeKey=tile"+"&key="+encodeURIComponent(n.sessionKey)+"&MapName="+n.mapName+"&LayerName="+n.layerID;return o+"&z="+i+"&x="+t+"&y="+e};var M={load:function(t,e,i,n,o,s,a){a(r)}};return n.dataManager.addTile(new s(M,-.5,-.5,0,0,-1,-1)),this}}),L.gmx=L.gmx||{};var P="maps.kosmosnimki.ru";L.gmx._layerClasses={Raster:L.gmx.RasterLayer,Vector:L.gmx.VectorLayer},L.gmx.addLayerClass=function(t,e){L.gmx._layerClasses[t]=e},L.gmx.loadLayer=function(t,e,i){var n=new L.gmx.Deferred,o={mapID:t,layerID:e};i=i||{};for(var r in i)o[r]=i[r];var s=i.hostName||P;return v.getMap(s,i.apiKey,t).then(function(){var i=v.findLayerInfo(s,t,e);if(!i)return n.reject("There is no layer "+e+" in map "+t),void 0;i.properties.hostName=s;var r=L.gmx.createLayer(i,o);r?n.resolve(r):n.reject("Unknown type of layer "+e)},function(i){n.reject("Can't load layer "+e+" from map "+t+": "+i.error)}),n},L.gmx.loadLayers=function(t,e){var i=t.map(function(t){var i=L.extend({},e,t.options);return L.gmx.loadLayer(t.mapID,t.layerID,i)});return L.gmx.Deferred.all.apply(null,i)},L.gmx.loadMap=function(t,e){e=e||{};var i=new L.gmx.Deferred,n=e.hostName||P;return v.getMap(n,e.apiKey,t).then(function(t){var n,o=new y(t,e),r=0,s=2e6;if(e.leafletMap||e.setZIndex)for(var a=o.layers.length-1;a>=0;a--){if(n=o.layers[a],e.setZIndex){var l=r++;"Vector"===n._gmx.properties.type&&(l+=s),n.options.zIndex=l}e.leafletMap&&o.layers[a]._gmx.properties.visible&&n.addTo(e.leafletMap)}i.resolve(o)},function(e){i.reject("Can't load map "+t+" from "+n+": "+e.ErrorInfo.ErrorMessage)}),i},L.gmx.createLayer=function(t,e){t||(t={}),t.properties||(t.properties={type:"Vector"});var i,n=t.properties.ContentID||t.properties.type||"Vector";return n in L.gmx._layerClasses&&(i=new L.gmx._layerClasses[n](e),i=i.initFromDescription(t)),i};var C=2e4,w={},T="/Layer/CheckVersion.ashx",M=null,S=function(t){var e,i={};if(t){e=t._gmx;var n=e.properties;i[e.hostName]=[{Name:n.name,Version:n.LayerVersion}]}else for(var o in w){var r=w[o];if(r.options.chkUpdate){e=r._gmx;var s=e.hostName,a={Name:o,Version:e.properties.LayerVersion||0};i[s]?i[s].push(a):i[s]=[a]}}return i},D=function(t,e){if(document.body&&!u.isPageHidden()){var i=S(t);for(var n in i){var o="http://"+n+T,r=JSON.stringify(i[n]),s=function(t){if(t&&"ok"===t.Status&&t.Result)for(var i=0,n=t.Result.length;n>i;i++){var o=t.Result[i],r=o.properties,s=r.name,a=w[s];a&&"updateVersion"in a&&a.updateVersion(o)}e&&e(t)};"FormData"in window?u.request({url:o,async:!0,headers:{"Content-type":"application/x-www-form-urlencoded"},type:"POST",params:"WrapStyle=None&layers="+encodeURIComponent(r),callback:function(t){s(JSON.parse(t))},onError:function(t){console.log("Error: LayerVersion ",t)}}):u.sendCrossDomainPostRequest(o,{WrapStyle:"message",layers:r},s)}}},I={remove:function(t){var e=t._gmx,i=e.layerID;delete w[i],e.dataManager.off("chkLayerUpdate",e._chkVersion)},add:function(t){var e=t._gmx,i=e.properties;e.layerID in w||"LayerVersion"in i&&(w[e.layerID]=t,e._chkVersion=function(){D(t)},e.dataManager.on("chkLayerUpdate",e._chkVersion),I.start())},chkVersion:D,stop:function(){M&&clearInterval(M),M=null},start:function(t){t&&(C=t),I.stop(),M=setInterval(D,C)}};L.gmx||(L.gmx={}),L.gmx.layersVersion=I,L.gmx.VectorLayer.include({updateVersion:function(t){if(t){var e=this._gmx;t.properties&&(e.properties=t.properties,e.dataManager.updateVersion(),this.fire("versionchange"))}}}),!function(){var t=1e6,e=function(t){this.all={},this.layer=t,this.gmx=t._gmx,this.sortFunc=null,t.on("click",this.clickFunc,this),this.count=0,this.disabled=!1};e.prototype={clickFunc:function(t){if(!this.disabled){var e=t.gmx.id;this.addToReorder(e,t.originalEvent.ctrlKey),this.layer.redrawItem(e)}},addToReorder:function(t,e){this.count++,this.all[t]=e?-this.count:this.count},getReorderArrays:function(){for(var t=[],e=[],i=Object.keys(this.all).sort(function(t,e){return this.all[t]-this.all[e]}),n=0,o=i.length;o>n;n++){var r=i[n];this.all[r]>0?e.push(r):t.push(r)}return{top:e,bottom:t}},setReorderArrays:function(t,e){this.all={},this.count=0,e.forEach(function(t){this.addToReorder(t,!0)}),t.map(function(t){this.addToReorder(t)}),this.layer.repaint()},getSortedItems:function(t){return t.sort(this.count>0?this.gmx.sortItems:this.sortFunc)},setSortFunc:function(e){this.sortFunc=e;var i=this;this.gmx.sortItems=function(e,n){if(i.count>0){var o=i.all[e.id],r=i.all[n.id];if(o||r)return o=o?o+(o>0?t:-t):0,r=r?r+(r>0?t:-t):0,o-r}return i.sortFunc?i.sortFunc(e,n):0},this.layer.repaint()},disableFlip:function(){this.disabled=!0},enableFlip:function(){this.disabled=!1}},L.gmx.VectorLayer.addInitHook(function(){if(!this._gmx.objectsReorder){var t=new e(this);this._gmx.objectsReorder=t,L.extend(this,{bringToTopItem:function(e){t.addToReorder(e),this.redrawItem(e)},bringToBottomItem:function(e){t.addToReorder(e,!0),this.redrawItem(e)},getReorderArrays:t.getReorderArrays.bind(t),setReorderArrays:t.setReorderArrays.bind(t),setSortFunc:t.setSortFunc.bind(t),disableFlip:t.disableFlip.bind(t),enableFlip:t.enableFlip.bind(t)})}})}(),function(){var t="rus",e=function(t,e,i,n){n[t]||(n[t]={}),n[t][e]=i};L.gmxLocale={setLanguage:function(t){this._language=t},getLanguage:function(){return window.language||this._language||t}},L.gmxLocaleMixin={addText:function(){var t=arguments[0],i=arguments[1];1===arguments.length&&(i=t,t=null);for(var n in i)if(null===t)for(var o in i[n])e(n,o,i[n][o],this);else e(t,n,i[n],this);return this},getText:function(t){for(var e=L.gmxLocale.getLanguage(),i=this[e]||{},n=t?t.split(/\./):[],o=0,r=n.length;r>o&&i;o++)i=i[n[o]];return i}},L.extend(L.gmxLocale,L.gmxLocaleMixin)}(),L.extend(L.gmxLocale,{rus:{Coordinates:"",Length:"",Area:"",Perimeter:"",units:{m:"",nm:".",km:"",m2:". ",km2:". ",ha:"",m2html:"<sup>2",km2html:"<sup>2"}}}),L.extend(L.gmxLocale,{eng:{Coordinates:"Coordinates",Length:"Length",Area:"Area",Perimeter:"Perimeter",units:{m:"m",nm:"nm",km:"km",m2:"sq. m",km2:"sq. km",ha:"ha",m2html:"m<sup>2",km2html:"km<sup>2"}}}),function(){var t=function(t){return t.extend({options:{opacity:1,pane:"tilePane"},onAdd:function(t){this._map=t,this._image||this._initImage();var e=t._panes[this.options.pane||"overlayPane"];e.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){this._image&&this._image.parentNode&&this._image.parentNode.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},bringToFront:function(){if(this._image&&this._image.parentNode){var t=this._image.parentNode;t.appendChild(this._image),this._setAutoZIndex(t,Math.max)}return this},bringToBack:function(){if(this._image){var t=this._image.parentNode;t.insertBefore(this._image,t.firstChild),this._setAutoZIndex(t,Math.min)}return this}})};L.ImageOverlay.Pane=t(L.ImageOverlay),L.imageOverlay.pane=function(t,e,i){return new L.ImageOverlay.Pane(t,e,i)}}(),function(){L.Cadastre=L.TileLayer.WMS.extend({includes:L.Mixin.Events,options:{maxZoom:19,maxNativeZoom:18,tileSize:1024,zIndex:100,infoMode:!1,dragMode:!1,shiftPosition:L.point(0,0),template:"http://{s}.maps.rosreestr.ru/arcgis/rest/services/Cadastre/Cadastre/MapServer/export",attribution:'<a href="http://rosreestr.ru"> </a>'},defaultWmsParams:{size:"1024,1024",bboxSR:102100,imageSR:102100,dpi:96,f:"image",format:"png32",transparent:!0},initialize:function(t,e){this.info.init(this),this._pos=L.point(0,0),this._pixelPoint=L.point(0,0),this._tileerrorFunc=function(t){this.options.errorTileUrl=t.url+"&"},this._stopClick=function(t){this.options.errorTileUrl=t.url+"&"},L.TileLayer.WMS.prototype.initialize.call(this,t||this.options.template,e||this.options)},getTileUrl:function(t){var e=this._map,i=e.getCenter(),n=L.CRS.EPSG3857.project(i).subtract(e.options.crs.project(i));n.x=0,n=n._subtract(this.options.shiftPosition);var o=this.options.tileSize,r=t.multiplyBy(o),s=r.add([o,o]),a=this._crs.project(e.unproject(r,t.z)).add(n),l=this._crs.project(e.unproject(s,t.z)).add(n),h=this._wmsVersion>=1.3&&this._crs===L.CRS.EPSG4326?[l.y,a.x,a.y,l.x].join(","):[a.x,l.y,l.x,a.y].join(","),u=L.Util.template(this._url,{s:this._getSubdomain(t)});return u+L.Util.getParamString(this.wmsParams,u,!0)+"&BBOX="+h},getShift:function(){return this._pos||(this._pos=L.point(0,0)),this.options.shiftPosition.add(this._pos)},setShift:function(t){return this.options.shiftPosition=L.point(t),this._pos&&(this._pos=pos.add(this.options.shiftPosition)),this.fire("shiftchange"),this},redraw:function(){this.options.shiftPosition._add(this._pos),this._pos=L.point(0,0),L.TileLayer.WMS.prototype.redraw.call(this),L.DomUtil.setPosition(this._tileContainer,this._pos)},_drag:function(t){this._pixelPoint=t.target._newPos,this._tileContainer&&L.DomUtil.setPosition(this._tileContainer,this._pixelPoint),this._pos=this._pixelPoint.divideBy(256/L.gmxUtil.tileSizes[this._map.getZoom()]),this._pos.y=-this._pos.y,this.fire("drag",{shiftPosition:this.options.shiftPosition,dragPosition:this._pos})},enableDrag:function(){if(this.options.dragMode=!0,this._map){var t=this._map;if(this.info&&this.info.removePopup(!0),t.dragging.disable(),L.DomUtil.disableImageDrag(),t.on("zoomstart",this.redraw,this),L.DomUtil.setPosition(this._tileContainer,L.point(0,0)),!this._draggable){var e=this;this._draggable=new L.Draggable(this._tileContainer,this._container),this._draggable.on("dragstart",function(){this.fire("dragstart"),this._dragstate=!0},this).on("dragend",function(){this.fire("dragend"),setTimeout(function(){e._dragstate=!1},0)},this).on("drag",this._drag,this)}this._draggable.enable()}return this.fire("dragenabled"),this},disableDrag:function(){if(this.options.dragMode=!1,this._map){var t=this._map;this.options.shiftPosition._add(this._pos),this._pos=L.point(0,0),t.dragging.enable(),L.DomUtil.enableImageDrag(),t.off("zoomstart",this.redraw,this),this._draggable.disable(),this.redraw()}return this.fire("dragdisabled"),this},onRemove:function(t){this.off("tileerror",this._tileerrorFunc,this),t.off("click",this._click,this),this.info&&this.info.overlays.clearAll(!0),L.TileLayer.WMS.prototype.onRemove.call(this,t)},onAdd:function(t){L.TileLayer.WMS.prototype.onAdd.call(this,t),this.setZIndex(this.options.zIndex),this.on("tileerror",this._tileerrorFunc,this),this.options.infoMode&&this.enableInfoMode(),this.options.dragMode&&this.enableDrag()},_setAutoZIndex:function(){},enableInfoMode:function(){return this.options.infoMode=!0,this._map&&this.info&&(this._map.on("click",this.info.click,this),L.DomUtil.addClass(this.getContainer(),"leaflet-clickable-raster-layer")),this},disableInfoMode:function(){return this.options.infoMode=!1,this._map&&this.info&&(this._map.off("click",this.info.click,this),L.DomUtil.removeClass(this.getContainer(),"leaflet-clickable-raster-layer")),this}}),L.cadastre=function(t,e){return new L.Cadastre(t,e)}}(),function(){function t(t){var e=t[B.cadastreNumber].split(":");e.length>=1&&!t[B.cadastreOkrugNumber]&&(t[B.cadastreOkrugNumber]=e[0]),e.length>=2&&!t[B.cadastreRayonNumber]&&(t[B.cadastreRayonNumber]=e[1]),e.length>=3&&!t[B.cadastreKvartalNumber]&&(t[B.cadastreKvartalNumber]=e[2])}function e(t,e){if(t===w.okrug)return T[0]+": "+e.attributes[B.cadastreNumber]+" - "+e.attributes[B.name];if(t===w.rayon)return T[1]+": "+e.attributes[B.cadastreNumber]+" - "+e.attributes[B.name];if(t===w.kvartal)return T[2]+": "+e.attributes[B.cadastreNumber];if(t===w.parcel)return T[3]+": "+e.attributes.PARCEL_CN;if(t===w.oks){var i=S[e.attributes[B.oksType]]?" ("+S[e.attributes[B.oksType]]+")":"";return T[4]+i+": "+e.attributes.PARCEL_CN}}function i(t,e){return t===w.okrug?l(e):t===w.rayon?l(e):t===w.kvartal?l(e):t===w.parcel?h(e):t===w.oks?u(e):void 0}function n(t,e){var i;if(e instanceof Array){i={};for(var n=0;n<e.length;n++)i[n.toString()]=e[n]}else i=e;return t.replace(/{[^{}]+}/g,function(t){return i[t.replace(/[{}]+/g,"")]||""})}function o(t,e){function i(t,e){var i={};for(var n in t)i[n]="undefined"!=typeof e[n]?e[n]:t[n];return i}function n(t,e){if(t.length<=3)return t;for(var i=t.length,n="",o=0,r=i-1;r>=0;r--){var s=t.substr(r,1);0!=o%3||0==o||isNaN(parseFloat(s))||(n=e+n),n=s+n,o++}return n}if("number"!=typeof t&&(t=parseFloat(t),isNaN(t)))return O;var o={before:"",after:"",decimals:2,dec_point:".",thousands_sep:","};if(e=e&&"object"==typeof e?i(o,e):o,t=t.toFixed(e.decimals),-1!=t.indexOf("."))var r=t.split("."),t=n(r[0],e.thousands_sep)+e.dec_point+r[1];else var t=n(t,e.thousands_sep);return e.before+t+e.after}function r(t,e){if(!X){var i=document.getElementById(t);i?i.innerHTML=e:setTimeout(function(){i=document.getElementById(t),i.innerHTML=i?e:k},2e3)}}function s(t){var e=he.getRequestParams("okrug",w.okrug,{where:B.cadastreOkrugId+" like '"+t+"%'"});L.gmxUtil.requestJSONP(e.url,e.params,e.options).then(function(t){var e,i;if(" "!=t.features[0].attributes.ONLINE_ACTUAL_DATE&&t.features[0].attributes.ONLINE_ACTUAL_DATE>0){var n=new Date(t.features[0].attributes.ONLINE_ACTUAL_DATE);e=a(n.getDate(),n.getMonth()+1,n.getFullYear())}else e=O;if(" "!=t.features[0].attributes.ACTUAL_DATE&&t.features[0].attributes.ACTUAL_DATE>0){var o=new Date(t.features[0].attributes.ACTUAL_DATE);i=a(o.getDate(),o.getMonth()+1,o.getFullYear())}else i=O;r("actual_date",e),r("border_actual_date",i)},function(){ue.popup.fire("loaderend")})}function a(t,e,i){return c(t.toString(),2,"0",H)+"."+c(e.toString(),2,"0",H)+"."+c(i.toString(),4,"0",H)}function l(t){var e="";if(e+=F.cadastreMapInfoTableHeader,t.attributes[B.cadastreParcelCount]&&(e+=n(F.cadastreMapInfoParcelCountRow,[o(t.attributes[B.cadastreParcelCount],{decimals:0,thousands_sep:" "})])),(t.attributes[B.cadastreOksCount]||0==t.attributes[B.cadastreOksCount])&&(e+=n(F.cadastreMapInfoOksCountRow,[o(t.attributes[B.cadastreOksCount],{decimals:0,thousands_sep:" "})])),t.attributes[B.cadastreKvartalCount]&&(e+=n(F.cadastreMapInfoKvartalCountRow,[o(t.attributes[B.cadastreKvartalCount],{decimals:0,thousands_sep:" "})])),t.attributes[B.cadastreRayonCount]&&(e+=n(F.cadastreMapInfoRayonCountRow,[o(t.attributes[B.cadastreRayonCount],{decimals:0,thousands_sep:" "})])),t.attributes[B.cadastreKvartalNumber]||t.attributes[B.cadastreRayonNumber])e+=n(F.infoAttrActualDateRow,[""]),e+=n(F.infoBorderActualDateRow,[""]),J||s(t.attributes[B.cadastreOkrugNumber]);else{if(" "!=t.attributes.ONLINE_ACTUAL_DATE&&t.attributes.ONLINE_ACTUAL_DATE>0){var i=new Date(t.attributes.ONLINE_ACTUAL_DATE);e+=n(F.infoAttrActualDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoAttrActualDateRow,[O]);if(" "!=t.attributes.ACTUAL_DATE&&t.attributes.ACTUAL_DATE>0){var i=new Date(t.attributes.ACTUAL_DATE);e+=n(F.infoBorderActualDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoBorderActualDateRow,[O])}return(t.attributes[B.cadastreKvartalNumber]||t.attributes[B.cadastreRayonNumber])&&(e+=F.cadastreMapInfoEmptyRow),t.attributes[B.cadastreKvartalNumber]&&(e+=n(F.cadastreMapInfoRayonNumberRow,[t.attributes[B.cadastreOkrugNumber]+":"+t.attributes[B.cadastreRayonNumber]])),t.attributes[B.cadastreRayonNumber]&&(e+=n(F.cadastreMapInfoOkrugNumberRow,[t.attributes[B.cadastreOkrugNumber]])),t.attributes[B.cadastreKvartalNumber]&&(e+=n(F.cadastreMapInfoKvartalPlansRow,[t.attributes[B.cadastreNumber]])),e+=F.cadastreMapInfoTableFooter,t.clickedPoint||t.point||(e+=F.cadastreMapInfoTableContainerFooter),e}function h(t){var e="";if(e+=F.mapInfoContainerHeader,t.attributes[B.geometryError]&&(e+=F.mapInfoEmptyMessage),e+=F.mapInfoTableHeader,e+=n(F.infoStateRow,[" "==t.attributes[B.stateCode]?k:D[t.attributes[B.stateCode]-1]]),e+=n(F.mapInfoAddressRow,[" "==t.attributes[B.address]?k:t.attributes[B.address]]),e+=t.attributes[B.area]&&" "!=t.attributes[B.area]?n(F.infoAreaRow,[R[t.attributes[B.areaType]],o(t.attributes[B.area],{thousands_sep:" "}),t.attributes[B.areaUnit]?I[t.attributes[B.areaUnit]]:""]):n(F.infoAreaRow,["",k,""]),e+=t.attributes[B.cadastrePrice]&&" "!=t.attributes[B.cadastrePrice]&&t.attributes[B.cadastrePriceUnit]&&" "!=t.attributes[B.cadastrePriceUnit]?n(F.infoCadastrePriceRow,[o(t.attributes[B.cadastrePrice],{thousands_sep:" "}),I[t.attributes[B.cadastrePriceUnit]]]):n(F.infoCadastrePriceRow,[k,""]),e+=t.attributes[B.formRights]&&" "!=t.attributes[B.formRights]?n(F.infoOwnership,[N[t.attributes[B.formRights]]]):n(F.infoOwnership,[k])," "!=t.attributes.DATE_CREATE&&t.attributes.DATE_CREATE>0){var i=new Date(t.attributes.DATE_CREATE);
e+=n(F.infoDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoDateRow,[k]);e+=" "!=t.attributes[B.cadastreEngineerSecondName]?n(F.infoCadastreEngineerRow,[t.attributes[B.cadastreEngineerSecondName],t.attributes[B.cadastreEngineerFirstName],t.attributes[B.cadastreEngineerThirdName]]):n(F.infoCadastreEngineerRow,[k,"",""]);var r=m(t.attributes.PARCEL_CN);if(e+=n(F.mapInfoCadastreKvartalRow,[r.kvartalNumber]),e+=n(F.mapInfoCadastreRayonRow,[r.rayonNumber]),e+=n(F.mapInfoCadastreOkrugRow,[r.okrugNumber])," "!=t.attributes.ONLINE_ACTUAL_DATE&&t.attributes.ONLINE_ACTUAL_DATE>0){var i=new Date(t.attributes.ONLINE_ACTUAL_DATE);e+=n(F.infoParcelAttrActualDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoParcelAttrActualDateRow,[k]);if(" "!=t.attributes.ACTUAL_DATE&&t.attributes.ACTUAL_DATE>0){var i=new Date(t.attributes.ACTUAL_DATE);e+=n(F.infoParcelBorderActualDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoParcelBorderActualDateRow,[k]);var s=" "==t.attributes[B.category]?k:E[t.attributes[B.category]];e+=n(F.infoCategory,[s]),J&&(te.properties.category=s),e+=F.infoUtilizationRow,e+=n(F.infoUtilizationVRIZCodeRow,[" "==t.attributes[B.utilizationCode]?k:t.attributes[B.utilizationCode]]);var l=t.attributes[B.utilizationCode]&&" "!=t.attributes[B.utilizationCode]?A[t.attributes[B.utilizationCode]]:k;e+=n(F.infoUtilizationVRIZRow,[l]),J&&(te.properties.utilization=l);var h=t.attributes[B.utilizationDoc]&&" "!=t.attributes[B.utilizationDoc]?t.attributes[B.utilizationDoc]:k;return e+=n(F.infoUtilizationDocRow,[h]),J&&(te.properties.utilizationDoc=h),e+=F.mapInfoTableFooter,e+=F.mapInfoContainerFooter}function u(t){var e="";if(e+=F.mapInfoContainerHeader,t.attributes[B.geometryError]&&(e+=F.mapInfoEmptyMessage),e+=F.mapInfoTableHeader,e+=n(F.infoStateRow,[" "==t.attributes[B.stateCode]?k:D[t.attributes[B.stateCode]-1]])," "!=t.attributes.DATE_CREATE&&t.attributes.DATE_CREATE>0){var i=new Date(t.attributes.DATE_CREATE);e+=n(F.infoDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoDateRow,[k]);if(e+=n(F.mapInfoAddressRow,[" "==t.attributes[B.address]?k:t.attributes[B.address]]),e+=t.attributes[B.area]&&" "!=t.attributes[B.area]?n(F.infoAreaRow,[R[t.attributes[B.areaType]]?I[t.attributes[B.areaType]]:"",o(t.attributes[B.area],{thousands_sep:" "}),t.attributes[B.areaUnit]?I[t.attributes[B.areaUnit]]:""]):n(F.infoAreaRow,["",k,""]),e+=t.attributes[B.formRights]&&" "!=t.attributes[B.formRights]?n(F.infoOwnership,[N[t.attributes[B.formRights]]]):n(F.infoOwnership,[k]),e+=t.attributes[B.cadastrePrice]&&t.attributes[B.cadastrePriceUnit]?n(F.infoCadastrePriceRow,[o(t.attributes[B.cadastrePrice],{thousands_sep:" "}),I[t.attributes[B.cadastrePriceUnit]]]):n(F.infoCadastrePriceRow,[k,""])," "!=t.attributes.ONLINE_ACTUAL_DATE&&t.attributes.ONLINE_ACTUAL_DATE>0){var i=new Date(t.attributes.ONLINE_ACTUAL_DATE);e+=n(F.infoOksAttrActualDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoOksAttrActualDateRow,[k]);if(" "!=t.attributes.ACTUAL_DATE&&t.attributes.ACTUAL_DATE>0){var i=new Date(t.attributes.ACTUAL_DATE);e+=n(F.infoOksBorderActualDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoOksBorderActualDateRow,[k]);if(e+=n(F.mapInfoCadastreKvartalRow,[t.attributes[B.cadastreOkrugNumber]+":"+t.attributes[B.cadastreRayonNumber]+":"+t.attributes[B.cadastreKvartalNumber]]),e+=n(F.mapInfoCadastreRayonRow,[t.attributes[B.cadastreOkrugNumber]+":"+t.attributes[B.cadastreRayonNumber]]),e+=n(F.mapInfoCadastreOkrugRow,[t.attributes[B.cadastreOkrugNumber]]),e+=n(F.infoStoreyCountRow,[" "==t.attributes[B.storeyCount]?k:t.attributes[B.storeyCount]]),e+=n(F.infoUndergroundStoreyCountRow,[" "==t.attributes[B.undergroundStoreyCount]?k:t.attributes[B.undergroundStoreyCount]]),e+=n(F.infoWallMaterialRow,[" "==t.attributes[B.wallMaterial]?k:z[t.attributes[B.wallMaterial]]]),e+=n(F.infoStartOperationYearRow,[" "==t.attributes[B.startOperationYear]?k:t.attributes[B.startOperationYear]+" ."]),e+=n(F.infoEndBuildingYearRow,[" "==t.attributes[B.endBuildingYear]?k:t.attributes[B.endBuildingYear]+" ."]),e+=n(F.infoInventoryCostRow,[" "==t.attributes[B.inventoryCost]||-1==t.attributes[B.inventoryCost]?k:o(t.attributes[B.inventoryCost],{thousands_sep:" ",decimals:0})+" ."])," "!=t.attributes[B.inventoryCostDate]){var i=new Date(t.attributes[B.inventoryCostDate]);e+=n(F.infoInventoryCostDateRow,[a(i.getDate(),i.getMonth()+1,i.getFullYear())])}else e+=n(F.infoInventoryCostDateRow,[k]);e+=n(F.infoBuilderNameRow,[" "==t.attributes[B.builderName]?k:t.attributes[B.builderName]]),e+=n(F.infoBuilderInnRow,[" "==t.attributes[B.builderInn]?k:t.attributes[B.builderInn]]),e+=F.infoTableFooter,e+=F.mapInfoTableFooter,e+=F.linkListHeader;for(var r in F.linkListItems)e+=n(F.linkListItems[r],[t.attributes.PARCEL_CN,U[t.attributes[B.oksType]]]);return e+=F.linkListFooter}function c(t,e,i,n){if("undefined"==typeof e)var e=0;if("undefined"==typeof i)var i=" ";if("undefined"==typeof n)var n=G;if(e+1>=t.length)switch(n){case H:t=Array(e+1-t.length).join(i)+t;break;case j:var o=Math.ceil((padlen=e-t.length)/2),r=padlen-o;t=Array(r+1).join(i)+t+Array(o+1).join(i);break;default:t+=Array(e+1-t.length).join(i)}return t}function d(t){var e;return e="undefined"!=typeof t.attributes[" "]?w.oks:4==t.value.split(":").length?w.parcel:p(t.value),t.layerId&&(e.layerId=t.layerId),e}function p(t){switch(t.length){case 2:return w.okrug;case 4:return w.rayon;case 11:return w.kvartal;case 16:case 18:return w.parcel;case 21:return w.oks}}function m(t){var e=t.split(":");t="";var i={};return e.length>=1&&(i.okrugNumber=e[0]),e.length>=2&&(i.rayonNumber=i.okrugNumber+":"+e[1]),e.length>=3&&(i.kvartalNumber=i.rayonNumber+":"+e[2]),i}function f(t){switch(t){case w.okrug:return B.cadastreOkrugId;case w.rayon:return B.cadastreRayonId;case w.kvartal:return B.cadastreKvartalId;case w.parcel:return B.parcelId;case w.oks:return B.oksId;case w.subject:return B.subjectId;case w.mo1Level:return B.mo1LevelId;case w.mo2Level:return B.mo2LevelId;case w.settlement:return B.settlementId}}function g(t,e){t==w.okrug||t==w.rayon||t==w.kvartal||t==w.parcel||t==w.oks?e.sort(function(t,e){t.attributes[B.cadastreNumber]||(t.attributes[B.cadastreNumber]=""),e.attributes[B.cadastreNumber]||(e.attributes[B.cadastreNumber]="");for(var i=t.attributes[B.cadastreNumber].split(":"),n=e.attributes[B.cadastreNumber].split(":"),o=0,r=i.length;r>o;o++){var s=parseInt(i[o],10),a=parseInt(n[o],10);if(s>a)return 1;if(a>s)return-1}return 0}):(t==w.subject||t==w.mo1Level||t==w.mo2Level||t==w.settlement)&&e.sort(function(t,e){t.attributes[B.name]||(t.attributes[B.name]=""),e.attributes[B.name]||(e.attributes[B.name]="");var i=t.attributes[B.name],n=e.attributes[B.name];return i==n?0:i>n?1:n>i?-1:void 0});for(var i="",n=!1,o=t,r=0;r<e.length;r++){e[r].attributes.ItemNumber=r+1,e[r].attributes[B.geometryError]?(n=!0,i=" *"):i="";for(var s in e[r].attributes)("Null"==e[r].attributes[s]||"undefined"==typeof e[r].attributes[s]||null==e[r].attributes[s])&&(e[r].attributes[s]=" ");e[r].attributes.ErrorSymbol=i,1===e[r].attributes.OKS_FLAG&&(o=w.oks)}}function _(t){for(var e in t)if(t[e].attributes[B.addressId])t[e].point=new Y(t[e].attributes[B.xCoord],t[e].attributes[B.yCoord],q);else if(t[e].location){t[e].point=new Y(t[e].location.x,t[e].location.y,t[e].location.spatialReference);var i=M[t[e].attributes[B.locatorField]];t[e].attributes[B.locatorIntField]=i}else t[e].attributes.XC&&t[e].attributes.YC?t[e].point=new Y(t[e].attributes.XC,t[e].attributes.YC,q):t[e].attributes.XMIN&&t[e].attributes.YMIN&&(t[e].point=new Y((t[e].attributes.XMAX+t[e].attributes.XMIN)/2,(t[e].attributes.YMAX+t[e].attributes.YMIN)/2,q))}function v(n,o){ue.popup.fire("loaderend");var r=ue.popup,s=ue.layer._map,r=ue.popup;J?s.removeLayer(ue.popup):X||r.openOn(s);var a='<div class="cadastreTitle">'+e(n,o.features[0])+"</div>",l=o.features[0].attributes.CAD_NUM;J&&(te.properties.KN=l),t(o.features[0].attributes),_(o.features),g(n,o.features);var h=i(n,o.features[0]);r.setContent(a+h),J&&(te.properties.status="",P());var u=n.fieldId||o.displayFieldName||B.cadastreNumber;J||ae.setImageOverlay({fieldId:u,layerId:n.layerId,value:o.features[0].attributes[u]})}function y(t,e){e.f="json",e.returnGeometry=!1;var i=he.getRequestParams("other",t,e);L.gmxUtil.requestJSONP(i.url,i.params,i.options).then(function(e){v(t,e)},function(){Q()})}function x(t,e){var i=he.getRequestParams("searchObject",t,{where:e});L.gmxUtil.requestJSONP(i.url,i.params,i.options).then(function(e){v(t,e)},function(){Q()})}function b(t){ee++,createInfo(t)}function P(){ee--,ie.length&&1>ee&&b(C())}function C(){for(;ie.length;)return ie.shift()}var w={okrug:{layerId:4,fieldId:"PKK_ID",layerUrl:"http://maps.rosreestr.ru/arcgis/rest/services/Cadastre/CadastreSelected/MapServer/4",title:" "},kvartal:{layerId:2,fieldId:"PKK_ID",layerUrl:"http://maps.rosreestr.ru/arcgis/rest/services/Cadastre/CadastreSelected/MapServer/2",title:" "},rayon:{layerId:3,fieldId:"PKK_ID",layerUrl:"http://maps.rosreestr.ru/arcgis/rest/services/Cadastre/CadastreSelected/MapServer/3",title:" "},parcel:{layerId:1,fieldId:"PARCEL_ID",layerUrl:"http://maps.rosreestr.ru/arcgis/rest/services/Cadastre/CadastreSelected/MapServer/exts/GKNServiceExtension/online/parcel/find",title:"Parcel"},oks:{fieldId:"PKK_ID",layerUrl:"http://maps.rosreestr.ru/arcgis/rest/services/Cadastre/CadastreSelected/MapServer/exts/GKNServiceExtension/online/parcel/find",title:"Oks"},subject:{},mo1Level:{},mo2Level:{},settlement:{}},T=[" "," "," "," ",""],M={Municipality1:1,Municipality2:2,Region:0,Settlement:3},S={" ":"",building:"",construction:"",flat:""},D=[" ","","",""," ()","","  ",""],I={"003":"","004":"","005":"","006":"","008":"","009":"","047":". .","050":". ","051":". ","053":". ","055":". ","058":". . ","059":"","061":". ",109:"",359:".",360:".",361:".",362:".",364:".",365:".",366:".",383:".",384:". .",385:". .",386:". .",1000:".",1001:".",1002:".  . ",1003:".  ",1004:".  ",1005:"","null":""},k=" ",E={"003001000000":"  ","003002000000":"  (  )","003003000000":" , , , , , , ,     ,  ,      ","003004000000":"     ","003005000000":"  ","003006000000":"  ","003007000000":" ","003008000000":"  "},A={141000000000:"       ",141001000000:"  ",141001010000:"     ",141001020000:"  , , ,   ,      ",141001030000:"     ",141001040000:"   ",141002000000:"   () ",141003000000:"    ",141004000000:"     ",141005000000:"   ",141006000000:"  ",141007000000:"  - ,        () ,    ",141008000000:" - ",141009000000:"  ",141010000000:"     ",141011000000:" ",141012000000:"    ",141013000000:"    ",141014000000:"    ",142000000000:"  ,    ",142001000000:"   ",142001010000:"   ",142001020000:"  ",142001020100:"  ",142001020200:"  ",142001020300:"  ",142001020400:"    ",142001030000:"   , ,    ()  ",142001040000:"   ,         ",142002000000:"  - ",142002010000:"     - ",142002020000:"   ",142002030000:"   ",142002040000:"   ",142002040100:"    ",142002040200:"    ",142002050000:"    ",142002060000:"    ",142002070000:"        ",142002080000:"   ",142002090000:"  - ",142002100000:"   ",142002110000:"   ",142002120000:"    ,     ",142002130000:"    ",142002140000:"  ",142002150000:"     ",142002160000:"   ",142002170000:"    - ,   ",142003000000:"   ( )",142004000000:"    ",142004010000:"  ",142004020000:"  ",142004030000:"  ",142004040000:"    ",142004050000:"    ",142005000000:"  ,  ",142006000000:"   - ",142007000000:"   ,    ",143000000000:"   , , , , , , ,   , ,     ",143001000000:"   ",143001010000:"     , ,     ",143001010100:"   ",143001010200:"  ",143001010300:"   ",143001010400:"   ",143001010500:"   ",143001010600:"  - ",143001010700:"    ",143001020000:"     ",143001030000:"    ",143002000000:"   ",143002010000:"       ",143002010100:"  ",143002010200:"   ",143002010300:"   ",143002010400:"         ",143002010500:"    ",143002010600:"   ",143002010700:"    ",143002010800:"      ",143002020000:"    ",143002020100:"    ",143002020200:"      ",143002020300:"  ",143002020400:"   ",143002020500:"       ",143002030000:"    ",143003000000:"   ",143003010000:"      ",143003010100:"       ",143003010200:"     ",143003010300:" , ,    , , ,     ,  ,      ,   , , , , ,     , , ,      ",143003010301:"   ",143003010302:"   ",143003010303:"     ,   , , , , ,     , , ,      ",143003020000:"          ",143003020100:"       ",143003020200:"   ",143003020300:"         ",143003020400:"   ",143003020500:"    ",143003020600:"        ",143003030000:"     ,   ",143003030100:"      ",143003030200:"     , , ",143003030300:"    ,   ",143003030400:"   ",143003040000:"      ",143003040100:"    ",143003040200:"  ",143003040300:"  - ",143003040400:"      ",143003050000:"      ",143003050100:"  ",143003050200:"  ",143003050300:"   ",143003050400:"     ",143003060000:"      ",143004000000:"   , , , ",143004010000:"        ",143004020000:"  ,                     ",143004030000:"             ",143004040000:"               ",143004050000:"       ",143004060000:"    , , , ",143005000000:"  ,     ",143005010000:"  ,     ",143005020000:"  - ,       , ,    ",143005030000:"     ",143005040000:"       - ",143005050000:"        ",143005060000:"       ",143005070000:"      ,     ",143006000000:"  ,      ",143006010000:"   ",143006010100:"   ,    ",143006010200:"     ",143006010300:"     ",143006010400:"  ",143006010500:"      ",143006010600:"          (,   )",143006010700:"    ",143006020000:"   (),        ",143006020100:"    -   ",143006020200:"     ",143006020300:"     ",143006020400:"    ",143006020500:"          ",143006020600:"           ",143006030000:"      ",143007000000:"    , , , , , , ,   , ,     ",144000000000:"    -    ()",144001000000:"      ()",144001010000:"     (   )",144001020000:"    ",144001030000:"   ",144001040000:"   ",144001050000:"   ",144001060000:"   ",144001070000:"      ",144001080000:"   ,  ,    ",144001090000:"  ",144001100000:"       ()",144002000000:"   ()  ",144003000000:"   ()  ",144003010000:"   , , ",144003020000:"      ",144003030000:"   ,    - ,    ,   ",144003040000:"   ",144003050000:"  ",144003060000:"  -   ",144003070000:"     ",144003080000:"  , ,  ",144003090000:"  ",144003100000:"    ()  ",144004000000:"   - ",144004010000:"        (   ),      ",144004020000:"     ",144005000000:"     -    ()",145000000000:"    ",145001000000:"   ",145002000000:"   ",145003000000:"    ",146000000000:"    ",146001000000:"  ",146002000000:"   ",146003000000:"   ,    ",147000000000:"  ()","014001000000":"  ","014001001000":"        ","014001002000":"     ","014001003000":" ,    ","014002000000":" - ","014002001000":"   ","014002002000":"   ,  ,  ,    ,  ","014002003000":"     ,           ,   ,  ","014002004000":"  --   ,  , ,  , ,    ","014002005000":"   () ","014003000000":"   ","014004000000":"   (  )","014005000000":"   , ,  ","014005001000":"   ","014005002000":"   ","014005003000":"  ,   ","014005004000":"   ","014005005000":"   , ,  ","014006000000":"  ","014006001000":"   () ","014006002000":"  ,   ","014006003000":"      ","014006004000":"      ","014006005000":"   ","014006006000":"    ","014006007000":"   ","014006008000":"  ","014006009000":"   ","014007000000":"     (    ),  - ,      (   , , , )","014008000000":",   ,     ,   ,         ,      , .","014009000000":"      ","014010000000":"     ","014011000000":",        (  )","014012000000":"","014013000000":" "},O="  ",R={"001":" ","002":" ","003":"   ","004":"   ","005":" ","007":" ","008":" ","009":" ","010":" ","011":" ","012":"     ","013":"     ","014":"    ","015":"    ","020":" ","021":" ","022":"  "},N={100:"",200:"",300:"  "},U={" ":"","-1":"002001001000",building:"002001002000",flat:"002001003000",construction:"002001004000",2:"002001005000"},B={address:"OBJECT_ADDRESS",addressId:"FULLADDRESSID",addressName:"NAME",area:"AREA_VALUE",areaType:"AREA_TYPE",areaUnit:"AREA_UNIT",atdId:"BS_ID",borderName:"BS_NAME",borderSub1:" 1",borderSub2:" 2",borderType:" ",build:"BUILDING",builderInn:"OKS_INN",builderName:"OKS_EXECUTOR",cadastreEngineerFirstName:"CI_FIRST",cadastreEngineerSecondName:"CI_SURNAME",cadastreEngineerThirdName:"CI_PATRONYMIC",cadastreKvartalCount:"KVARTALS_CNT",cadastreKvartalId:"PKK_ID",cadastreKvartalNumber:"KVARTALNUMBER",cadastreNumber:"CAD_NUM",cadastreOkrugId:"PKK_ID",cadastreOkrugNumber:"OKRUGNUMBER",cadastreOksCount:"OKS_CNT",cadastreParcelCount:"PARCELS_CNT",cadastrePrice:"CAD_COST",cadastrePriceUnit:"CAD_UNIT",cadastreRayonCount:"RAYONS_CNT",cadastreRayonId:"PKK_ID",cadastreRayonNumber:"RAYONNUMBER",category:"CATEGORY_TYPE",endBuildingYear:"YEAR_BUILT",formRights:"FORM_RIGHTS",geometryError:"ERROR_CODE",hasMO2Level:"HASMUNICIPALITY2",hasPolygon:"HASPOLYGON",hasStreet:"HASSTREET",house:"HOUSE",inventoryCost:"OKS_INVENTORY_COST",inventoryCostDate:"OKS_COST_DATE",isCenter:"ISCENTER",kladr:"KLADR",letter:"LETTER",loadDate:"RC_DATE",location:"location",locatorField:"Loc_name",locatorIntField:"LocatorInt",locatorNameField:"LocatorName",matchAddress:"Match_addr",mo1LevelId:"MUNICIPALITY1ID",mo2LevelId:"MUNICIPALITY2ID",name:"NAME",objectId:"OBJECTID",oksCadastreNumber:"CADNUMOLD",oksId:"PKK_ID",oksNumber:"OKSNUMBEROLD",oksType:"OKS_TYPE",organizationCode:"ORG_CODE",parcelId:"PARCEL_ID",parcelNumber:"PARCELNUMBER",parentName:"ParentName",phone:"PHONENUMBER",postcode:"POSTCODE",score:"score",settlement:"SETTLEMENT",settlementId:"SETTLEMENTID",shortCadastreNumber:"SHORTNUMBER",sortField:"Sort",startOperationYear:"OKS_YEAR_USED",state:"STATE",stateCode:"PARCEL_STATUS",storeyCount:"OKS_FLOORS",street:"STREET",subjectId:"REGIONID",undergroundStoreyCount:"OKS_U_FLOORS",usrField:"User_fld",utilizationCode:"UTIL_CODE",utilizationDoc:"UTIL_BY_DOC",utilizationFact:"UTILIZATION_FACT",utilizationRef:"UTILIZATION_REFERENCEVALUES",utilizationValue:"UTILIZATION_VALUE",wallMaterial:"OKS_ELEMENTS_CONSTRUCT",xCoord:"X_COORD",xmax:"XMAX",xmin:"XMIN",yCoord:"Y_COORD",ymax:"YMAX",ymin:"YMIN"},z={"061001000000":"","061001001000":"","061001001001":"","061001001002":" ","061001001003":"  ","061001002000":"","061001002001":"","061001002002":"-","061001002003":"-","061001002004":"-","061001002005":"","061001002006":"   ","061001003000":"","061001003001":"  ","061001003002":"  ","061001004000":"   ","061001005000":"  ","061001006000":"","061001006001":"","061001006002":"   ","061001006003":"  ","061001007000":"","061001007001":"","061001007002":"-","061001007003":"","061001007004":"","061001007005":"   ","061001007006":"  ","061001008000":"","061001009000":"","061001999000":""},F={tabPanel:"<div class='portlet-nav-toolbar'><div class='portlet-nav-toolbar-box'><ul class='portlet-nav-tabs portlet-nav-tabs-content g-layout'><li class='tabs-item2-active'><a class='tabs-item2'><span><span><span class='tab_header'></span></span></span></a></li><li><a class='tabs-item2'><span><span><span class='tab_header'></span></span></span></a></li><li><a class='tabs-item2'><span><span><span class='tab_header'> ?</span></span></span></a></li><li><a class='tabs-item2'><span><span><span class='tab_header'></span></span></span></a></li></ul></div></div>",liteTabPanel:"<div class='portlet-nav-toolbar'><div class='portlet-nav-toolbar-box'><ul class='portlet-nav-tabs portlet-nav-tabs-content g-layout'><li class='tabs-item2-active'><a class='tabs-item2'><span><span><span class='tab_header'></span></span></span></a></li><li><a class='tabs-item2'><span><span><span class='tab_header'></span></span></span></a></li><li><a class='tabs-item2'><span><span><span class='tab_header'> ?</span></span></span></a></li></ul></div></div>",cadastreDiv:"<div class='portlet-nav-toolbar'><div class='portlet-nav-toolbar-box'><ul class='portlet-nav-tabs portlet-nav-tabs-content g-layout'><li class='tabs-item2-active'><a class='tabs-item2'><span><span><span class='tab_header'> </span></span></span></a></li></ul></div></div>",cadastreZoneTabPanel:"<div class='portlet-nav-toolbar'><div class='portlet-nav-toolbar-box'><ul class='portlet-nav-tabs portlet-nav-tabs-content g-layout'><li class='tabs-item2-active'><a class='tabs-item2'><span><span><span class='tab_header'> </span></span></span></a></li><li><a class='tabs-item2'><span><span><span class='tab_header'> ?</span></span></span></a></li></ul></div></div>",tabHeader:"<div class='portlet-content-wrap2'>",activeTabHeader:"<div class='portlet-content-wrap2 portlet-content-wrap2-active'>",tabFooter:"</div>",divHeader:"<div>",divFooter:"</div>",mapInfoContainerHeader:"<div class='mapInfoContainer'>",mapInfoContainerFooter:"</div>",mapInfoEmptyMessage:"<div class='emptyGeometry'><p><strong class='red'>!</strong>     .   .</p></div>",mapInfoTableHeader:"<table class='mapInfo'><tbody>",mapInfoTableFooter:"</tbody></table>",mapInfoAddressRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr>",mapInfoParcelRow:"<tr><td> :</td><td><a class='pseudoLink' onclick='parentCadastreNumberClick(\"{0}\");'><strong>{0}</strong></a></td></tr><tr class='emptyRow'></tr>",mapInfoCadastreKvartalRow:"<tr><td>:</td><td><a class='pseudoLink' onclick='parentCadastreNumberClick(\"{0}\");'><strong>{0}</strong></a></td></tr><tr class='emptyRow'></tr>",mapInfoCadastreRayonRow:"<tr><td>:</td><td><a class='pseudoLink' onclick='parentCadastreNumberClick(\"{0}\");'><strong>{0}</strong></a></td></tr><tr class='emptyRow'></tr>",mapInfoCadastreOkrugRow:"<tr><td>:</td><td><a class='pseudoLink' onclick='parentCadastreNumberClick(\"{0}\");'><strong>{0}</strong></a></td></tr><tr class='emptyRow'></tr>",infoTableHeader:"<div class='infoContainer'><table class='info'><tbody>",infoTableFooter:"</tbody></table></div>",infoStateRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr>",infoCategory:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoDateRow:"<tr><td class='leftColumn'>   :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoAttrActualDateRow:"<tr><td class='leftColumn'><div class='leftColumnExt'>    :</div></td><td><strong id='actual_date'>{0}</strong></td></tr></tr>",infoBorderActualDateRow:"<tr><td class='leftColumn'>    :</td><td><strong id='border_actual_date'>{0}</strong></td></tr></tr>",infoParcelAttrActualDateRow:"<tr><td class='leftColumn'>     :</td><td><strong id='actual_date'>{0}</strong></td></tr></tr>",infoParcelBorderActualDateRow:"<tr><td class='leftColumn'>     :</td><td><strong id='border_actual_date'>{0}</strong></td></tr></tr>",infoOksAttrActualDateRow:"<tr><td class='leftColumn'>     :</td><td><strong>{0}</strong></td></tr></tr>",infoOksBorderActualDateRow:"<tr><td class='leftColumn'>     :</td><td><strong>{0}</strong></td></tr></tr>",infoKLADRRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoLetterRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoWallMaterialRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoStartOperationYearRow:"<tr><td class='leftColumn'>  :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoEndBuildingYearRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoInventoryCostRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoInventoryCostDateRow:"<tr><td class='leftColumn'>  :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoBuilderNameRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoBuilderInnRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoStoreyCountRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoUndergroundStoreyCountRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoUtilizationRow:"<tr><td class='leftColumn' colspan='2'> </td></tr><tr class='emptyRow'></tr>",infoUtilizationVRIZCodeRow:"<tr><td class='leftColumn smallFont'>&nbsp&nbsp&nbsp&nbsp  ():</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr>",infoUtilizationVRIZRow:"<tr><td class='leftColumn smallFont'>&nbsp&nbsp&nbsp&nbsp  ():</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr>",infoUtilizationDocRow:"<tr><td class='leftColumn smallFont'>&nbsp&nbsp&nbsp&nbsp :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoOwnership:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr><tr class='emptyRow'></tr>",infoAreaRow:"<tr><td class='leftColumn'>{0}:</td><td><strong>{1} {2}</strong></td></tr><tr class='emptyRow'></tr>",infoAreaDocRow:"<tr><td class='leftColumn'>  :</td><td><strong>{0} {1}</strong></td></tr><tr class='emptyRow'></tr>",infoAreaFactRow:"<tr><td class='leftColumn'> :</td><td><strong>{0} {1}</strong></td></tr><tr class='emptyRow'></tr>",infoAreaRefRow:"<tr><td class='leftColumn'> :</td><td><strong>{0} {1}</strong></td></tr><tr class='emptyRow'></tr>",infoCadastrePriceRow:"<tr><td class='leftColumn'> :</td><td><strong>{0} {1}</strong></td></tr><tr class='emptyRow'></tr>",infoCadastreEngineerRow:"<tr><td class='leftColumn'> :</td><td><strong>{0} {1} {2}</strong></td></tr><tr class='emptyRow'></tr>",infoOksTestRow:"<tr><td class='leftColumn'>{0}</td><td><strong>{1}</strong></td></tr><tr class='emptyRow'></tr>",zoneListHeader:"<ul id='zoneList' class='zoneList'>",zoneListFooter:"</ul>",zoneWaitListItem:"<li class='waitZoneItem'><img alt='loading' src='/portalonline/i/pin_load.gif'/><span> ...</span></li>",zoneErrorListItem:"<li class='errorZoneItem'><div class='errorZoneItemImg'></div><span>  .<br/>  .</span></li>",zoneEmptyListItem:"<li class='emptyZoneItem'><div class='emptyZoneItemImg'></div><span> .</span></li>",zoneHeaderListItem:"<li class='headerZoneItem'><strong>{0}</strong></li>",zoneListItem:"<li class='zoneItem'><div class='zoneItemMarker'></div><div class='zoneItemContent'><strong class='zoneItemTitle'>{0}</strong><br/>{1}</div></li>",linkListHeader:"<ul class='linkList'>",linkListFooter:"</ul>",linkListItems:["<li class='linkItem'><div class='linkIcon'></div><a target='_blank' href='https://rosreestr.ru/wps/portal/cc_information_online?KN={0}' onclick='__event(\"{0}\",ACTIONS.Service,\" \")' class='link'>       </a></li>","<li class='linkItem'><div class='linkIcon'></div><a target='_blank' href='https://rosreestr.ru/wps/portal/cc_gkn_form_new?KN={0}&objKind={1}' onclick='__event(\"{0}\",ACTIONS.Service,\"  (new)\")' class='link'>    </a></li>","<li class='linkItem'><div class='linkIcon'></div><a target='_blank' href='https://rosreestr.ru/wps/portal/cc_egrp_form_new?KN={0}&objKind={1}' onclick='__event(\"{0}\",ACTIONS.Service,\" \")' class='link'>    </a></li>"],cadastreMapInfoTableContainerHeader:"<div class='cadastreMapInfoContainerContainer' >",cadastreMapInfoTableContainerFooter:"</div>",cadastreMapInfoTableHeader:"<div class='cadastreMapInfoContainer'><table class='cadastreMapInfo'><tbody>",cadastreMapInfoTableFooter:"</tbody></table></div>",cadastreMapInfoEmptyRow:"<tr class='emptyRow'><td colspan='2'><div class='cadastreMapInfoSplitter'></div><td></tr>",cadastreMapInfoParcelCountRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",cadastreMapInfoKvartalCountRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",cadastreMapInfoRayonCountRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",cadastreMapInfoOkrugNumberRow:"<tr><td class='leftColumn'>:</td><td><a class='pseudoLink' onclick='parentCadastreNumberClick(\"{0}\"); return false;'><strong>{0}</strong></a></td></tr>",cadastreMapInfoRayonNumberRow:"<tr><td class='leftColumn'>:</td><td><a class='pseudoLink' onclick='parentCadastreNumberClick(\"{0}\"); return false;'><strong>{0}</strong></a></td></tr>",cadastreMapInfoPlansRow:"<tr class='emptyRow'><td colspan='2'><div class='cadastreMapInfoSplitter'></div><td></tr><tr><td colspan='2'><a class='pseudoLink' id='parcelPlan' target='_blank' href='http://maps.rosreestr.ru/PortalOnline/image.html?id={0}'><strong> </strong></a><a class='pseudoLink' id='kvartalPlan' target='_blank' href='image.html?id={0}&neighbour=true'><strong> </strong></a></td></tr>",cadastreMapInfoKvartalPlansRow:"<tr class='emptyRow'><td colspan='2'><div class='cadastreMapInfoSplitter'></div><td></tr><tr><td colspan='2'><a class='pseudoLink' id='parcelPlan' target='_blank' href='http://maps.rosreestr.ru/PortalOnline/image.html?id={0}'><strong> </strong></a></td></tr>",cadastreMapInfo3DRow:"<tr class='emptyRow'><td colspan='2'><div class='cadastreMapInfoSplitter'></div><td></tr><tr><td colspan='2'><a class='pseudoLink' id='parcelPlan' target='_blank' href='http://maps.rosreestr.ru/portalonline/Cadastre3d/{0}'><strong>3D </strong></a></td></tr>",cadastreMapInfoOksCountRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",cadastreZoneListHeader:"<ul id='zoneList' class='zoneList' style='height:155px;'>",zouitMapInfoTableHeader:"<div class='cadastreMapInfoContainer' style='height: 122px;'><table class='cadastreMapInfo'><tbody>",zouitMapInfoTableFooter:"</tbody></table></div>",zouitTypeMapInfoRow:"<tr><td class='leftColumnZone'>:</td><td><strong>{0}</strong></td></tr>",zouitDescriptionMapInfoRow:"<tr><td class='leftColumnZone'>:</td><td><strong>{0}</strong></td></tr>",zouitDocMapInfoRow:"<tr><td class='leftColumnZone'>:</td><td><strong><p id='zouitDocs'></p></strong></td></tr>",terrZoneMapInfoTableHeader:"<div class='cadastreMapInfoContainer' style='height: 122px;'><table class='cadastreMapInfo'><tbody>",terrZoneMapInfoTableFooter:"</tbody></table></div>",terrZoneTypeMapInfoRow:"<tr><td class='leftColumnZone'>:</td><td><strong>{0}</strong></td></tr>",terrZoneDescriptionMapInfoRow:"<tr><td class='leftColumnZone'>:</td><td><strong>{0}</strong></td></tr>",terrZoneDocMapInfoRow:"<tr><td class='leftColumnZone'>:</td><td><strong><p id='terrzoneDocs'></p></strong></td></tr>",borderMapInfoTableHeader:"<div class='cadastreMapInfoContainer' style='height: 122px'><table class='cadastreMapInfo'><tbody>",borderMapInfoTableFooter:"</tbody></table></div>",borderDescriptionMapInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",borderSubjectsMapInfoRow:"<tr><td>:</td><td><strong>{0}</strong></td></tr>",borderDocsMapInfoRow:"<tr><td class='leftColumn'>:</td><td><strong><p id='borderDocs'></p></strong></td></tr>",atdNameInfoRow:"<tr><td >:</td><td><strong>{0}</strong></td></tr>",atdMapInfoTableHeader:"<div class='cadastreMapInfoContainer' style='height: 122px'><table class='cadastreMapInfo'><tbody>",atdMapInfoTableFooter:"</tbody></table></div>",atdMapOkatoInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",atdMapOktmoInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",atdMapCapitalInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",atdMapCenterInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",atdMapParentInfoRow:"<tr class='emptyRow'></tr><tr><td class='leftColumn' colspan='2'> </td></tr>",atdMapSettlementInfoRow:"<tr><td class='leftColumn'>&nbsp&nbsp&nbsp&nbsp:</td><td><strong>{0}</strong></td></tr>",atdMapRayon1InfoRow:"<tr><td class='leftColumn'>&nbsp&nbsp&nbsp&nbsp:</td><td><strong>{0}</strong></td></tr>",atdMapRayon2InfoRow:"<tr><td class='leftColumn'>&nbsp&nbsp&nbsp&nbsp:</td><td><strong>{0}</strong></td></tr>",atdMapSubjectInfoRow:"<tr><td class='leftColumn'>&nbsp&nbsp&nbsp&nbsp :</td><td><strong>{0}</strong></td></tr><tr class='emptyRow'></tr>",atdMapMOInfoRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr>",atdMapNPInfoRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr>",atdMapRosreestrInfoRow:"<tr><td class='leftColumn'>  :</td><td><strong>{0}</strong></td></tr>",atdMapMO2InfoRow:"<tr><td class='leftColumn'> :</td><td><strong>{0}</strong></td></tr>",frameNameMapInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",frameHolderMapInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",frameScaleMapInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",frameDateMapInfoRow:"<tr><td class='leftColumn'>:</td><td><strong>{0}</strong></td></tr>",frameLinkMapInfoRow:"<tr><td class='leftColumn' colspan='2'><img id='frameInfoLinkLoadingIndicator' alt='loading' src='/portalonline/i/pin_load.gif'/><a id='frameInfoLink' style='display:none;' target='_blank' href='javascript: void 0'> </a></td></tr>"},Z=[2,2,7,5,5],H=1,G=2,j=3;
String.prototype.paddingLeft=function(t){return String(t+this).slice(-t.length)};var K=function(t){var e=t.split(":");switch(e.length){case 1:return w.okrug;case 2:return e[1].length>2?w.kvartal:w.rayon;case 3:return e[1].length>2?w.parcel:w.kvartal;case 4:return w.parcel;case 5:return w.oks}},V=function(t){var e=t.split(":");t="";for(var i=0;i<e.length;i++)"*"!=e[i]&&(e[i]=c(e[i],Z[i],"0",H),t+=e[i]);return t},W=function(t){var e=t.split(":");return e[0].length<=2&&isNumber(e[0])?!0:!1};String.prototype.pad=function(t,e,i){if(!this||!t||this.length>=e)return this;i=i||0;for(var n=this,o=(e-this.length)/t.length+1;--o;)n=i?n+t:t+n;return n};var q={latestWkid:"3857",wkid:"102100"},Y=function(t,e,i){this.spatialReference=i,this.type="point",this.x=t,this.y=e},X=!1,J=!1,Q=function(){ue.popup.fire("loaderend"),J&&(te.properties.status="   ",P())},$=function(t){ue.popup.setLatLng(t).fire("loaderstart");var e=he.getRequestParams("identify",ue.layer,{latlng:t});L.gmxUtil.requestJSONP(e.url,e.params,e.options).then(function(t){if(t&&t.results&&t.results.length>0){var e=[],i=t.results.length;if(ne&&i>1){for(var n=0;i>n;n++)if(t.results[n].value==ne){e=[t.results[n]],ne=null;break}}else e=[t.results[0]];if(i=e.length,i>0){for(var o=e[0],r=d(o),s="",a="",n=0;i>n;n++)s+=",'"+e[n].value+"'",a+=",'"+e[n].attributes[r==w.oks?" ":"  "]+"'";r==w.parcel||r==w.oks?y(r,{cadNums:"["+a.substring(1)+"]",onlyAttributes:!1}):r?x(r,f(r)+" IN ("+s.substring(1)+")"):(te.properties.status=" ",P())}else Q()}else Q()},function(){Q()})},te=null,ee=0,ie=[],W=function(t){var e="";if(t=t.trim(),t.lastIndexOf(":")==t.length-1&&(t=t.slice(0,-1)),/^[0-9]{1,2}$/.test(t)||/^[0-9]{1,2}:[0-9]{1,2}$/.test(t)||/^[0-9]{1,2}:[0-9]{1,2}:[0-9]{1,7}$/.test(t)||/^[0-9]{1,2}:[0-9]{1,2}:[0-9]{1,7}:[0-9]{1,4}$/.test(t)){var i=t.split(":");if(4==i.length)return e=t;i[0]&&i[0].length<2?e+=i[0].pad("0",2):i[0]&&2==i[0].length&&(e+=i[0]),i[1]&&i[1].length<2?e+=i[1].pad("0",2):i[1]&&2==i[1].length&&(e+=i[1]),i[2]&&i[2].length<7?e+=i[2].pad("0",7):i[2]&&7==i[2].length&&(e+=i[2]),i[3]&&i[3].length<4?e+=i[3].pad("0",4):i[3]&&4==i[3].length&&(e+=i[3])}return e},ne=null,oe=null,re=function(t){if(t=t.trim(),W(t)){var e=K(t),i=ue.layer._map;if(ue.popup.fire("loaderstart"),e==w.parcel){ne=V(t);var n=he.getRequestParams("cadastreSearch",e,{cadNum:t});L.gmxUtil.requestJSONP(n.url,n.params,n.options).then(function(t){if(ue.popup.fire("loaderend"),0==t.features.length)return alert(" ."),void 0;oe=t.features[0];var e=he.getFeatureExtent(t.features[0].attributes),n=i.getBoundsZoom(e.latLngBounds);i.setView(e.latlng,n),ue.setPopup(e)},function(){ue.popup.fire("loaderend")})}else{var o=V(t),n=he.getRequestParams("cadastreSearch1",e,{where:e.fieldId+" like '"+o+"%'"});L.gmxUtil.requestJSONP(n.url,n.params,n.options).then(function(t){if(ue.popup.fire("loaderend"),ue.removePopup(),0==t.features.length)return alert(" ."),void 0;var n=he.getFeatureExtent(t.features[0].attributes);i.fitBounds(n.latLngBounds,{animate:!1}),v(e,t)},function(){ue.popup.fire("loaderend")})}}};window.parentCadastreNumberClick=function(t){re(t)};var se=!1,ae={params:{format:"png32",dpi:96,transparent:"true",imageSR:102100,bboxSR:102100},infoOverlay:{lastAttr:null,arr:[]},thematicOverlay:{lastAttr:null,arr:[]},clearAll:function(){this.clear(!0,"infoOverlay"),this.clear(!0,"thematicOverlay")},clear:function(t,e){for(var i=ue.layer._map,n=e||"infoOverlay",o=ae[n],r=o.arr.length-(t?0:1),s=0;r>s;s++)o.arr.shift().onRemove(i);t&&(o.lastAttr=null)},setOverlay:function(t,e){if(e)ae[t].lastAttr=e;else{if(!ae[t].lastAttr)return;e=ae[t].lastAttr}var i=ue.layer._map,n=se;if(!n&&e.startLevel&&e.endLevel){var o=i.getZoom();(o<e.startLevel||o>e.endLevel)&&(n=!0)}if(n){var r=ae[t],s=r.arr.length-1;return s>=0&&r.arr[s].onRemove(i),ue.popup.fire("loaderend"),void 0}var a=he.getMapExtent(ue.layer),l=e.layerId,h=ue.layer.options.zIndex-2,u=L.Util.extend(ae.params,{layers:"show:"+l,size:a.size,bbox:a.bbox}),c=le+"Cadastre/Thematic/MapServer/export?f=image";if("fieldId"in e){var d=e.fieldId;c=le+"Cadastre/CadastreSelected/MapServer/export?f=image",u.layerDefs="PARCEL_ID"===d?'{"'+l+'":"'+d+" LIKE '"+e.value+"'\"}":l+":"+d+" LIKE '"+e.value+"'",h++}for(var p in u)c+="&"+p+"="+u[p];ae[t].arr.push(new L.ImageOverlay.Pane(c,i.getBounds()).on("load",function(){ae.clear(!1,t),ue.popup.fire("loaderend")}).addTo(i).setZIndex(h))},setThematicOverlay:function(t){ae.setOverlay("thematicOverlay",t)},setImageOverlay:function(t){ae.setOverlay("infoOverlay",t)},refresh:function(){ae.infoOverlay.arr.length&&ae.setOverlay("infoOverlay"),ae.thematicOverlay.arr.length&&ae.setOverlay("thematicOverlay")}},le="http://maps.rosreestr.ru/arcgis/rest/services/",he={getRequestParams:function(t,e,i){var n={options:{callbackParamName:"callback"}};if("identify"===t){var o=he.getShiftPointMercator(i.latlng,e.getShift()),r=he.getMapExtent(e);n.url=le+"Cadastre/CadastreSelected/MapServer/identify",n.params={f:"json",geometry:'{"x":'+o.x+',"y":'+o.y+',"spatialReference":{"wkid":102100}}',tolerance:"0",returnGeometry:!1,mapExtent:r.extent,imageDisplay:r.size+",96",geometryType:"esriGeometryPoint",sr:"102100",layers:"top"}}else"cadastreSearch1"===t?(n.url=e.layerUrl+"/query",n.params=L.Util.extend({f:"json",returnGeometry:!1,spatialRel:"esriSpatialRelIntersects",outFields:"*",outSR:"4326"},i)):"okrug"===t?(n.url=e.layerUrl+"/query",n.params=L.Util.extend({f:"json",returnGeometry:!1,outFields:"ONLINE_ACTUAL_DATE,ACTUAL_DATE"},i)):"searchObject"===t?(n.url=e.layerUrl+"/query",n.params=L.Util.extend({f:"json",returnGeometry:!1,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects",outFields:"*"},i)):"cadastreSearch"===t?(n.url=e.layerUrl,n.params=L.Util.extend({f:"json",returnGeometry:!1,onlyAttributes:!1},i)):(n.url=e.layerUrl,n.params=L.Util.extend({},i));return n},getMapExtent:function(t){var e=t._map,i=t.getShift(),n=256/L.gmxUtil.tileSizes[e.getZoom()],o=e.getCenter(),r=L.CRS.EPSG3857.project(o).y-e.options.crs.project(o).y-i.y,s=e.getPixelBounds(),a=e.options.crs.project(e.unproject(s.getTopRight())),l=e.options.crs.project(e.unproject(s.getBottomLeft()));l.y+=r,a.y+=r,l.x-=i.x,a.x-=i.x;var h={x:s.max.x-s.min.x,y:(a.y-l.y)*n};return{size:h.x+","+h.y,shiftY:r,bbox:[l.x,l.y,a.x,a.y].join(","),extent:"{xmin:"+l.x+",ymin:"+l.y+",xmax:"+a.x+",ymax:"+a.y+",spatialReference:{wkid:102100}}"}},getShiftPointMercator:function(t,e){return L.CRS.EPSG3857.project(t).subtract(e)},getShiftPointLatlng:function(t){var e=getShiftPointMercator(t),i=L.Projection.SphericalMercator;return i.unproject(e.divideBy(6378137))},getFeatureExtent:function(t){var e=6378137,i=L.Projection.SphericalMercator;return{latlng:i.unproject(L.point(t.XC,t.YC).divideBy(e)),latLngBounds:L.latLngBounds(i.unproject(L.point(t.XMIN,t.YMIN).divideBy(e)),i.unproject(L.point(t.XMAX,t.YMAX).divideBy(e)))}}},ue={layer:null,loaderIcon:{request:{},icon:{}},popup:L.popup({minWidth:400}),closePopup:function(){ae.clear(!0)},removePopup:function(){ae.clear(!0),this._map&&this._map.removeLayer(ue.popup)},setPopup:function(t){ue.layer._dragstate||(X=t.originalEvent.ctrlKey,X||ue.popup.setLatLng(t.latlng),$(t.latlng))}};ue.popup.on("close",ue.closePopup),L.Cadastre=L.Cadastre.extend({info:{overlays:ae,click:ue.setPopup,removePopup:ue.removePopup,cadastreSearch:re,init:function(t){ue.layer=t}}})}(),L.Map.addInitHook(function(){var t=this._controlCorners,e=this._controlContainer,i="leaflet-top leaflet-bottom",n="leaflet-left leaflet-right",o={bottom:"leaflet-bottom "+n,gmxbottomleft:"leaflet-bottom leaflet-left",gmxbottomcenter:"leaflet-bottom "+n,gmxbottomright:"leaflet-bottom leaflet-right",center:i+" "+n,right:"leaflet-right "+i,left:"leaflet-left "+i,top:"leaflet-top "+n};for(var r in o)t[r]||(t[r]=L.DomUtil.create("div",o[r],e))}),L.Map.addInitHook(function(){var t=this,e=null,i="leaflet-control-gmx-hidden",n={gmxHide:{},gmxZoom:{},gmxDrawing:{},gmxBottom:{},gmxLocation:{},gmxCopyright:{},gmxCenter:{},gmxLogo:{}};this.gmxControlsManager={_controls:{},add:function(t){var n=t.options,o=n.id;return this._controls[o]=t,t instanceof L.Control.gmxHide&&(e=t),!e||e.options.isActive||n.notHide||t._parent||!t._container||L.DomUtil.addClass(t._container,i),this},remove:function(t){return delete this._controls[t.options.id],this},get:function(t){return this._controls[t]},getAll:function(){return this._controls},init:function(e){e=e||{},t.zoomControl&&!e.zoomControl&&t.removeControl(t.zoomControl),t.attributionControl&&!e.attributionControl&&t.removeControl(t.attributionControl);for(var i in n)i in e&&null===e[i]||t.addControl(L.control[i](e[i]));return this}},this.gmxControlIconManager=this.gmxControlsManager}),L.Control.gmxIcon=L.Control.extend({includes:L.Mixin.Events,options:{position:"topleft",id:"defaultIcon",isActive:!1},setActive:function(t,e){var i=this.options,n=i.togglable||i.toggle;if(n){var o=i.isActive,r="leaflet-gmx-icon",s=r+"-"+i.id,a=this._container;i.isActive=t,this._img&&(t&&i.activeImageUrl?this._img.src=i.activeImageUrl:!t&&i.regularImageUrl&&(this._img.src=i.regularImageUrl)),t?(L.DomUtil.addClass(a,r+"-active"),L.DomUtil.addClass(a,s+"-active"),a.children.length&&L.DomUtil.addClass(a,r+"-externalImage-active"),i.styleActive&&this.setStyle(i.styleActive)):(L.DomUtil.removeClass(a,r+"-active"),L.DomUtil.removeClass(a,s+"-active"),a.children.length&&L.DomUtil.removeClass(a,r+"-externalImage-active"),i.style&&this.setStyle(i.style)),e||o===t||this.fire("statechange")}},onAdd:function(t){var e="leaflet-gmx-icon",i=null,n=null,o=this.options,r=e+"-"+o.id,s=L.DomUtil.create("div",e+" "+r);s._id=o.id,this._container=s,o.title&&(s.title=o.title),this.setStyle=function(t){for(var e in t)s.style[e]=t[e]},o.regularImageUrl&&(i=L.DomUtil.create("img","",s),i.src=o.regularImageUrl,this._img=i),o.className&&L.DomUtil.addClass(s,o.className),o.text?(L.DomUtil.addClass(s,e+"-text"),n=L.DomUtil.create("span","",s),n.innerHTML=o.text):L.DomUtil.addClass(s,e+"-img"),s.children.length&&L.DomUtil.addClass(s,e+"-externalImage"),o.style&&this.setStyle(o.style),this._iconClick=function(){s.parentNode&&(this.setActive(!this.options.isActive),this.fire("click"),this.options.stateChange&&this.options.stateChange(this))};var a=L.DomEvent.stopPropagation;return L.DomEvent.on(s,"mousemove",a).on(s,"touchstart",a).on(s,"mousedown",a).on(s,"dblclick",a).on(s,"click",a).on(s,"click",this._iconClick,this),o.onAdd&&o.onAdd(this),t.fire("controladd",this),o.notHide&&(s._notHide=!0),t.gmxControlsManager&&t.gmxControlsManager.add(this),s},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this);var e=this._container,i=L.DomEvent.stopPropagation;L.DomEvent.off(e,"mousemove",i).off(e,"touchstart",i).off(e,"mousedown",i).off(e,"dblclick",i).off(e,"click",i).off(e,"click",this._iconClick,this)},addTo:function(t){return L.Control.prototype.addTo.call(this,t),this.options.addBefore&&this.addBefore(this.options.addBefore),this},addBefore:function(t){var e=this._parent&&this._parent._container;if(e||(e=this._map&&this._map._controlCorners[this.getPosition()]),e)for(var i=0,n=e.childNodes.length;n>i;i++){var o=e.childNodes[i];if(t===o._id){e.insertBefore(this._container,o);break}}else this.options.addBefore=t;return this}}),L.control.gmxIcon=function(t){return new L.Control.gmxIcon(t)},function(){function t(t){return RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent)}L.Control.gmxIconGroup=L.Control.gmxIcon.extend({includes:L.Mixin.Events,options:{position:"topleft",id:"defaultIconGroup",isVertical:!0,isCollapsible:!0,isSortable:!1,singleSelection:!1},addIcon:function(t){return this.items.push(t),t._parent=this,this._map&&(this._container.appendChild(t.onAdd(this._map)),t.options.addBefore&&t.addBefore(t.options.addBefore)),t.on("click",function(){this.setActiveIcon(t)},this),this.options.isCollapsible&&t.on("click",this._minimize,this),this},removeIcon:function(t){for(var e=0,i=this.items.length;i>e;e++)if(t===this.items[e]){var n=t._container;n.parentNode&&n.parentNode.removeChild(n),this.items.splice(e,1);break}return this},getIconById:function(t){for(var e=0,i=this.items.length;i>e;e++){var n=this.items[e];if(n.options.id===t)return n}return null},setActiveIcon:function(t,e){this.activeIcon="";var i=this.items.length;if(i){if(this.options.singleSelection)for(var n=0;i>n;n++){var o=this.items[n],r=t===o&&(e||o.options.isActive);o.setActive(r),r&&(this.activeIcon=o.options.id)}var s=this._container;if(this.options.isSortable&&t&&s.firstChild&&s.insertBefore(t._container,s.firstChild),this.triangle){var a=this.options.isSortable?t:this.items[0];a&&a.options.isActive?L.DomUtil.addClass(this.triangle,"triangle-active"):L.DomUtil.removeClass(this.triangle,"triangle-active")}this.fire("activechange",this)}return this},_minimize:function(){var t=this._container.style;t.height="30px","auto"!==this.options.width&&(t.width="34px"),t.overflow="hidden",this.bg&&(this.bg.height=30),this.fire("collapse",this)},_maximize:function(){var t=this._container.style,e=this.options,i=1===this.items.length?30:34*this.items.length;e.isVertical?(this.bg&&(this.bg.height=i),t.height=i+"px","auto"!==e.width&&(t.width="34px")):(t.height="30px",t.width=i+"px"),t.overflow="unset",this.fire("expand",this)},onAdd:function(e){var i="leaflet-gmx-icon-group",n=this.options,o=i+"-"+n.id+" "+i+(n.isVertical?"-vertical":"-horizontal"),r=L.DomUtil.create("div",i+" "+o);if(n.isVertical){if(t(10)||t(9)){var s=L.DomUtil.create("span","icons-vertical",r),a=L.DomUtil.create("img","",s);a.width=a.height=30,a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABBJREFUeNpi+P//PwNAgAEACPwC/tuiTRYAAAAASUVORK5CYII=",this.bg=a}this.triangle=L.DomUtil.create("div","leaflet-gmx-icon-sprite triangle",r),this.triangle.width=this.triangle.height=30}return this._map=e,this._container=r,r._id=n.id,n.isCollapsible&&(L.DomEvent.on(r,"mousemove",L.DomEvent.stopPropagation).on(r,"mouseout",function(t){for(var e=t.toElement;e;){if(e===r)return;e=e.parentNode}this._minimize()},this).on(r,"mouseover",function(t){for(var e=t.fromElement;e;){if(e===r)return;e=e.parentNode}this._maximize()},this),this._minimize()),this.items=[],n.items.map(this.addIcon,this),n.onAdd&&n.onAdd(this),e.fire("controladd",this),n.isVertical&&(r.style.marginLeft=0),n.notHide&&(r._notHide=!0),e.gmxControlsManager&&e.gmxControlsManager.add(this),r},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this)}}),L.control.gmxIconGroup=function(t){return new L.Control.gmxIconGroup(t)}}(),function(){var t=["Point","Polygon","Polyline","Rectangle"];L.Control.gmxDrawing=L.Control.gmxIconGroup.extend({options:{position:"topleft",singleSelection:!0,isSortable:!0,id:"drawing",items:null},onAdd:function(e){var i=this;this.setActive=function(t){e.gmxDrawing&&(e.gmxDrawing.bringToFront(),e.gmxDrawing.create(t,i.options.drawOptions))},this.on("activechange",function(e){for(var n=e.activeIcon,o=0,r=t.length;r>o;o++)if(n===t[o])return;i.setActive()}),e.gmxDrawing&&e.gmxDrawing.on("drawstop",function(t){var e=t.object._obj.options||{};e.ctrlKey||e.shiftKey?i.setActive(t.object.options.type):i.setActiveIcon()},this);var n=function(t){return new L.Control.gmxIcon({id:t,className:"leaflet-gmx-icon-sprite",title:i._locale&&"getText"in i._locale?i._locale.getText(t):t,togglable:!0}).on("statechange",function(t){var e=t.target.options,n=e.id;n===i.activeIcon?i.setActive():e.isActive&&i.setActive(n)})},o=this.options.items||t;return this.options.items=[],o.forEach(function(t){i.options.items.push(t instanceof L.Control.gmxIcon?t:n(t))}),L.Control.gmxIconGroup.prototype.onAdd.call(this,e)}}),L.control.gmxDrawing=function(t){return new L.Control.gmxDrawing(t)},L.Control.gmxDrawing.locale={},L.Control.gmxDrawing.addInitHook(function(){this._locale=L.Control.gmxDrawing.locale,L.extend(this._locale,L.gmxLocaleMixin)})}(),L.extend(L.Control.gmxDrawing.locale,{rus:{Point:"",Polygon:"",Polyline:"",Rectangle:""}}),L.extend(L.Control.gmxDrawing.locale,{eng:{Point:"Point",Polygon:"Polygon",Polyline:"Polyline",Rectangle:"Rectangle"}}),L.Control.gmxCenter=L.Control.extend({options:{position:"center",id:"center",notHide:!0,color:"#216b9c"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this)},onAdd:function(t){var e="leaflet-gmx-center",i=L.DomUtil.create("div",e),n=L.DomUtil.create("div",e),o=L.Path.prototype._createElement("svg"),r=document.createElementNS(L.Path.SVG_NS,"g"),s=document.createElementNS(L.Path.SVG_NS,"path");return this._container=i,i._id=this.options.id,this.options.notHide&&(i._notHide=!0),s.setAttribute("stroke-width",1),s.setAttribute("stroke-opacity",1),s.setAttribute("d","M6 0L6 12M0 6L12 6"),this._path=s,r.appendChild(s),o.appendChild(r),o.setAttribute("width",12),o.setAttribute("height",12),n.appendChild(o),i.appendChild(n),this.setColor(this.options.color),t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),i},setColor:function(t){return this.options.color=t,this._map&&this._path.setAttribute("stroke",t),this}}),L.control.gmxCenter=function(t){return new L.Control.gmxCenter(t)},L.Control.gmxHide=L.Control.gmxIcon.extend({options:{id:"hide",isActive:!0,togglable:!0,notHide:!0,position:"topleft"},setActive:function(t,e){if(this._map){for(var i=this._map._controlContainer,n="leaflet-control-gmx-hidden",o=t?L.DomUtil.removeClass:L.DomUtil.addClass,r=0,s=i.children.length;s>r;r++)for(var a=0,l=i.children[r].children,h=l.length;h>a;a++){var u=l[a];(!u._notHide||e)&&o(u,n)}this.options.isActive=!this.options.isActive,this.fire("statechange")}},onAdd:function(t){var e=L.Control.gmxIcon.prototype.onAdd.call(this,t),i="Hide/Show";return L.gmxLocale&&(i=L.gmxLocale.addText({eng:{hide:i},rus:{hide:"/"}}).getText("hide")),e._id=this.options.id,e.title=i,e._notHide=this.options.notHide,L.DomUtil.removeClass(e,"leaflet-gmx-icon"),L.DomUtil.addClass(e,"leaflet-gmx-icon-sprite"),e}}),L.control.gmxHide=function(t){return new L.Control.gmxHide(t)},L.Control.gmxLayers=L.Control.Layers.extend({options:{collapsed:!1,autoZIndex:!1,id:"layers"},initialize:function(t,e){L.setOptions(this,e),this._layers={},this._lastZIndex=0,this._handlingClick=!1,this._blm=t,L.extend(this,{_onBaseLayerActiveIDs:function(t){var e,i;for(e in this._layers)this._layers[e].overlay||delete this._layers[e];for(e=0,i=t.activeIDs.length;i>e;e++)this._addBaseLayer(this._blm.get(t.activeIDs[e]),!0);return this._update(),!0},_onBaseLayerChange:function(t){t.baseLayer&&this.setActiveBaseLayer(t.baseLayer.id)},_onBaseLayerOptionsChange:function(t){this._addBaseLayer(t.baseLayer)}})},addBaseLayer:function(){return console.log("Warning: Use `gmxBaseLayersManager.add` instead `addBaseLayer`!"),this},_addBaseLayer:function(t,e){return t&&(this._addLayer(t,t.options[L.gmxLocale.getLanguage()]||t.id),e||this._update()),this},_addItemObject:function(t){var e=this._addItem(t);t.layer&&t.layer._gmx&&t.layer._gmx.layerID&&(e.className="_"+t.layer._gmx.layerID)},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i,n=!1,o=!1,r=this._blm.getActiveIDs(),s={};for(t in this._layers)i=this._layers[t],i.overlay?(this._addItemObject(i),o=!0):(s[i.layer.id]=i,n=!0);for(t=0,e=r.length;e>t;t++)s[r[t]]&&this._addItemObject(s[r[t]]);this.options.hideBaseLayers&&(n=!1,this._baseLayersList.style.display="none"),this._separator.style.display=o&&n?"":"none",this._container.style.display=o||n?"":"none"}},onAdd:function(t){var e=L.Control.Layers.prototype.onAdd.call(this,t);this._container=e,e.id=this.options.id,"activeBaseLayerInput"in this||(this.activeBaseLayerInput=this.getActiveBaseLayer(!0)),L.DomEvent.on(e,"mousemove",L.DomEvent.stopPropagation),t.gmxLayersControl=this,t.fire("controladd",this),this._blm.on("baselayeroptionschange",this._onBaseLayerOptionsChange,this).on("baselayeractiveids",this._onBaseLayerActiveIDs,this).on("baselayerchange",this._onBaseLayerChange,this);var i=this;this._blm.getActiveIDs().map(function(t){i._addBaseLayer(i._blm.get(t))});var n=this._blm.getCurrentID();return n&&this.setActiveBaseLayer(n),t.gmxControlsManager&&t.gmxControlsManager.add(this),e},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),L.Control.Layers.prototype.onRemove.call(this,t),this._blm.off("baselayeroptionschange",this._onBaseLayerOptionsChange,this).off("baselayeractiveids",this._onBaseLayerActiveIDs,this).off("baselayerchange",this._onBaseLayerChange,this),t.fire("controlremove",this)},unSetActiveBaseLayer:function(t){this._toogleActiveBaseLayer(t,!1)},setActiveBaseLayer:function(t){this._toogleActiveBaseLayer(t,!0)},_toogleActiveBaseLayer:function(t,e){for(var i=null,n=this._form.getElementsByTagName("input"),o=null,r=this._getLayerByName(t),s=r.layer._leaflet_id,a=r&&r.overlay,l=0,h=n.length;h>l;l++){var u=n[l],c=u.layerId,d=this._layers[c],p=d.layer,m=this._map.hasLayer(p),f=d.overlay||!1;if(f){if(s===c)return e?m||this._map.addLayer(p):m&&this._map.removeLayer(p),this}else a||s===c&&(e?i=u:m&&(u.checked=!1,i=null,this._map.removeLayer(p)),o=u)}return i&&o&&(this._map.addLayer(this._layers[o.layerId].layer),o.checked=!0),this.activeBaseLayerInput=i,this},getActiveBaseLayer:function(t){for(var e=this._form.getElementsByTagName("input"),i=0,n=e.length;n>i;i++){var o=e[i];if(o.checked){if(t)return o;var r=o.layerId,s=this._layers[r];if(!s.overlay)return s.name}}return null},_getLayerByName:function(t){for(var e in this._layers){var i=this._layers[e];if(t===i.name||t===i.layer.id)return i}return null},_onInputClick:function(t){if(t){var e=t.target,i=this._layers[e.layerId].name,n=this._getLayerByName(i),o=this.activeBaseLayerInput&&e.layerId===this.activeBaseLayerInput.layerId?!1:e.checked;this._handlingClick=!0,o&&n&&!n.overlay?this._blm.setCurrentID(n.layer.id):this._toogleActiveBaseLayer(i,o),this._handlingClick=!1,this._refocusOnMap()}}}),L.control.gmxLayers=function(t,e){return new L.Control.gmxLayers(t,e)},function(){var t=function(t){var e=L.gmxLocale?L.gmxLocale.getText(t):null;return e||""},e=["M 1:500 000 000","M 1:300 000 000","M 1:150 000 000","M 1:80 000 000","M 1:40 000 000","M 1:20 000 000","M 1:10 000 000","M 1:5 000 000","M 1:2500 000","M 1:1 000 000","M 1:500 000","M 1:300 000","M 1:150 000","M 1:80 000","M 1:40 000","M 1:20 000","M 1:10 000","M 1:5 000","M 1:2 500","M 1:1 250","M 1:625"];L.Control.gmxLocation=L.Control.extend({options:{position:"gmxbottomright",id:"location",notHide:!0,scaleFormat:"bar"},setScaleFormat:function(t){this.options.scaleFormat="bar"===t?"bar":"text",this.scaleBar.style.visibility="bar"===t?"visible":"hidden",this._checkPositionChanged()},onAdd:function(i){var n="leaflet-gmx-location",o=L.DomUtil.create("div",n),r=L.Control.gmxLocation.Utils,s=this;this._container=o,o._id=this.options.id,this.options.notHide&&(o._notHide=!0),L.gmxLocale&&L.gmxLocale.addText({eng:{gmxLocation:{locationTxt:"Current center coordinates",coordFormatChange:"Toggle coordinates format",scaleBarChange:"Toggle scale bar format"}},rus:{gmxLocation:{locationTxt:"   ",coordFormatChange:"  ",scaleBarChange:"  "}}}),this.prevCoordinates="",this.locationTxt=L.DomUtil.create("span","leaflet-gmx-locationTxt",o),this.locationTxt.title=t("gmxLocation.locationTxt"),this.coordFormatChange=L.DomUtil.create("span","leaflet-gmx-coordFormatChange",o),this.coordFormatChange.title=t("gmxLocation.coordFormatChange"),this.scaleBar=L.DomUtil.create("span","leaflet-gmx-scaleBar",o),this.scaleBarTxt=L.DomUtil.create("span","leaflet-gmx-scaleBarTxt",o),this.scaleBarTxt.title=this.scaleBar.title=t("gmxLocation.scaleBarChange"),this._map=i;var a={coordFormat:null,setCoordinatesFormat:function(t){t=t||this.coordFormat||0,0>t?t=this.coordFormatCallbacks.length-1:t>=this.coordFormatCallbacks.length&&(t=0),this.coordFormat=t;var e=a.getCoordinatesText()+this.coordFormatCallbacks[t];e&&s.prevCoordinates!==e&&(s.locationTxt.innerHTML=e),s.prevCoordinates=e,this._redrawTimer&&clearTimeout(this._redrawTimer),this._redrawTimer=setTimeout(function(){s._map&&s._map.fire("onChangeLocationSize",{locationSize:o.clientWidth})},100)},coordFormatCallbacks:["",""," (EPSG:3395)"," (EPSG:3857)"],getCoordinatesText:function(){var t=s._map.getCenter();return r.getCoordinatesText(t,this.coordFormat,this.coordFormatCallbacks.length)},showCoordinates:function(){var t=a.getCoordinatesText();if(s.options.onCoordinatesClick)s.options.onCoordinatesClick(t);else{if(this.coordFormat>2)return;var e=window.prompt(s.locationTxt.title+":",t);if(e&&e!==t){var i=r.parseCoordinates(e);i&&s._map.panTo(i)}}},nextCoordinatesFormat:function(){this.coordFormat+=1,this.setCoordinatesFormat(this.coordFormat||0)}};this._checkPositionChanged=function(){var t=i.getZoom();if(t){var n={txt:e[t],width:0};if("bar"===this.options.scaleFormat&&(n=r.getScaleBarDistance(t,i.getCenter())),!n||n.txt===s._scaleBarText&&n.width===s._scaleBarWidth)return;s._scaleBarText=n.txt,s._scaleBarWidth=n.width,s._scaleBarText&&(s.scaleBar.style.width=s._scaleBarWidth+"px",s.scaleBarTxt.innerHTML=s._scaleBarText),a.setCoordinatesFormat(a.coordFormat||0)}},this._setCoordinatesFormat=function(){a.setCoordinatesFormat(a.coordFormat||0)};var l=function(){this.setScaleFormat("bar"===this.options.scaleFormat?"text":"bar")};return this._toggleHandlers=function(t){var e=t?"on":"off",n=L.DomEvent[e],r=L.DomEvent.stopPropagation;n(o,"mousemove",r),n(this.coordFormatChange,"click",r),n(this.coordFormatChange,"click",a.nextCoordinatesFormat,a),n(this.locationTxt,"click",r),n(this.locationTxt,"click",a.showCoordinates,a),n(this.scaleBarTxt,"click",r),n(this.scaleBarTxt,"click",l,this),n(this.scaleBar,"click",r),n(this.scaleBar,"click",l,this),L.Browser.mobile||(n(this.coordFormatChange,"dblclick",r),n(this.scaleBarTxt,"dblclick",r),n(this.scaleBar,"dblclick",r)),i[e]("moveend",this._checkPositionChanged,this),i[e]("move",this._setCoordinatesFormat,this)},this._toggleHandlers(!0),this.setScaleFormat(this.options.scaleFormat),this._checkPositionChanged(),i.fire("controladd",this),i.gmxControlsManager&&i.gmxControlsManager.add(this),o},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this),this.prevCoordinates=this._scaleBarText=null,this._toggleHandlers(!1)}});var i={getScaleBarDistance:function(t,e){for(var i=L.Projection.Mercator.project(e),n=L.Projection.Mercator.unproject(new L.Point(i.x+40,i.y+30)),o=156543.033928041*Math.pow(2,-t)*this.distVincenty(e.lng,e.lat,n.lng,n.lat)/50,r=0;30>r;r++){var s=[1,2,5][r%3]*Math.pow(10,Math.floor(r/3)),a=Math.floor(s/o);if(a>50)return{txt:this.prettifyDistance(s),width:a}}return null},getCoordinatesText:function(t,e,i){var n,o=t.lng,r=t.lat;return e=e||0,i=i||4,o>180&&(o-=360),-180>o&&(o+=360),0===e%i?this.LatLonFormatCoordinates(o,r):1===e%i?this.LatLonFormatCoordinates2(o,r):2===e%i?(n=L.Projection.Mercator.project(new L.LatLng(r,o)),""+Math.round(n.x)+", "+Math.round(n.y)):(n=L.CRS.EPSG3857.project(new L.LatLng(r,o)),""+Math.round(n.x)+", "+Math.round(n.y))}};L.gmxUtil?(i.prettifyDistance=L.gmxUtil.prettifyDistance,i.formatDegrees=L.gmxUtil.formatDegrees,i.pad2=L.gmxUtil.pad2,i.trunc=L.gmxUtil.trunc,i.LatLonFormatCoordinates=L.gmxUtil.LatLonFormatCoordinates,i.LatLonFormatCoordinates2=L.gmxUtil.LatLonFormatCoordinates2,i.degRad=L.gmxUtil.degRad,i.distVincenty=L.gmxUtil.distVincenty,i.parseCoordinates=L.gmxUtil.parseCoordinates):(i.prettifyDistance=function(e){var i="",n=t("units.km")||"km",o=" "+n;return"km"===i?Math.round(e)/1e3+o:2e3>e||"m"===i?(n=t("units.m")||"m",Math.round(e)+" "+n):2e5>e?Math.round(e/10)/100+o:Math.round(e/1e3)+o},i.formatDegrees=function(t){t=Math.round(1e7*t)/1e7+1e-8;var e=Math.floor(t),i=Math.floor(60*(t-e)),n=this.pad2(3600*(t-e-i/60)).substring(0,2);return this.pad2(e)+""+this.pad2(i)+"'"+n+'"'},i.pad2=function(t){return 10>t?"0"+t:""+t},i.trunc=function(t){return(""+(Math.round(1e7*t)/1e7+1e-8)).substring(0,9)},i.LatLonFormatCoordinates=function(t,e){return this.formatDegrees(Math.abs(e))+(e>0?" N, ":" S, ")+this.formatDegrees(Math.abs(t))+(t>0?" E":" W")},i.LatLonFormatCoordinates2=function(t,e){return this.trunc(Math.abs(e))+(e>0?" N, ":" S, ")+this.trunc(Math.abs(t))+(t>0?" E":" W")},i.degRad=function(t){return t*(Math.PI/180)},i.distVincenty=function(t,e,i,n){var o={},r={};o.lon=this.degRad(t),o.lat=this.degRad(e),r.lon=this.degRad(i),r.lat=this.degRad(n);for(var s=6378137,a=6356752.3142,l=1/298.257223563,h=r.lon-o.lon,u=Math.atan((1-l)*Math.tan(o.lat)),c=Math.atan((1-l)*Math.tan(r.lat)),d=Math.sin(u),p=Math.cos(u),m=Math.sin(c),f=Math.cos(c),g=h,_=2*Math.PI,v=20;Math.abs(g-_)>1e-12&&--v>0;){var y=Math.sin(g),L=Math.cos(g),x=Math.sqrt(f*y*f*y+(p*m-d*f*L)*(p*m-d*f*L));if(0===x)return 0;var b=d*m+p*f*L,P=Math.atan2(x,b),C=p*f*y/x,w=1-C*C,T=b-2*d*m/w;isNaN(T)&&(T=0);var M=l/16*w*(4+l*(4-3*w));_=g,g=h+(1-M)*l*C*(P+M*x*(T+M*b*(-1+2*T*T)))}if(0===v)return 0/0;var S=w*(s*s-a*a)/(a*a),D=1+S/16384*(4096+S*(-768+S*(320-175*S))),I=S/1024*(256+S*(-128+S*(74-47*S))),k=I*x*(T+I/4*(b*(-1+2*T*T)-I/6*T*(-3+4*x*x)*(-3+4*T*T))),E=a*D*(P-k);return E=E.toFixed(3)},i.parseCoordinates=function(t){if(t.match(/[qrtyuiopadfghjklzxcvbmQRTYUIOPADFGHJKLZXCVBM_:]/))return!1;-1!==t.indexOf(" ")&&(t=t.replace(/,/g,"."));for(var e=/(-?\d+(\.\d+)?)([^\d\-]*)/g,i=[],n=null;n=e.exec(t);)i.push(n[1]);if(i.length<2)return!1;var o,r=Math.floor(i.length/2),s=0,a=1;for(o=0;r>o;o++)s+=parseFloat(i[o])*a,a/=60;var l=0;for(a=1,o=r;o<i.length;o++)l+=parseFloat(i[o])*a,a/=60;if(Math.abs(s)>180||Math.abs(l)>180){var h=L.Projection.Mercator.unproject(new L.Point(s,l));s=h.lng,l=h.lat}return-1!==t.indexOf("W")&&(s=-s),-1!==t.indexOf("S")&&(l=-l),[s,l]}),L.Control.gmxLocation.Utils=i,L.control.gmxLocation=function(t){return new L.Control.gmxLocation(t)}}(),function(){var t=function(t){var e=L.gmxLocale?L.gmxLocale.getText(t):null;return e||""};L.Control.gmxCopyright=L.Control.extend({options:{position:"gmxbottomleft",type:"window",notHide:!0,mapCopyright:"",id:"copyright"},onAdd:function(e){L.gmxLocale&&L.gmxLocale.addText({eng:{gmxCopyright:{showHide:"Show/Hide copyrights"}},rus:{gmxCopyright:{showHide:"/ "}}}),this._currentText="",this._container=L.DomUtil.create("span","leaflet-gmx-copyright"),this.options.notHide&&(this._container._notHide=!0),this._container._id=this.options.id,this._window=L.DomUtil.create("div","leaflet-gmx-copyright-window",this._container),this._copyrights=L.DomUtil.create("span","leaflet-gmx-copyrights",this._container),this.setWindowVisible=function(t){if("window"===this.options.type){var e=this._window.style;e.display=t?"block":"none",this._currentText="",this._redraw()}},this.closeWindow=function(){this.setWindowVisible(!1)},this.toggleWindow=function(){this.setWindowVisible("none"===this._window.style.display?!0:!1)},this.setFormat=function(e){"window"===e?(this._copyrights.title=t("gmxCopyright.showHide"),this._copyrights.innerHTML=" Copyrights",this._container.style.width="auto"):this._copyrights.title="",this.options.type=e,this.toggleWindow(),this._window.style.display="none"},this.setFormat(this.options.type);var i=L.DomEvent.stopPropagation;return L.DomEvent.on(this._window,"dblclick",i).on(this._window,"click",i).on(this._container,"mousemove",i).on(this._copyrights,"dblclick",i).on(this._copyrights,"click",i).on(this._copyrights,"click",this.toggleWindow,this),e.on("click",this.closeWindow,this).on("onChangeLocationSize",this._chkWidth,this).on("moveend",this._redraw,this).on("layeradd",this._redraw,this).on("layerremove",this._redraw,this),this._redraw(),e.fire("controladd",this),e.gmxControlsManager&&e.gmxControlsManager.add(this),this._container
},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this);var e=L.DomEvent.stopPropagation;L.DomEvent.off(this._window,"dblclick",e).off(this._window,"click",e).off(this._container,"mousemove",e).off(this._copyrights,"dblclick",e).off(this._copyrights,"click",e).off(this._copyrights,"click",this.toggleWindow,this),t.off("click",this.closeWindow,this).off("onChangeLocationSize",this._chkWidth,this).off("moveend",this._redraw,this).off("layeradd",this._redraw,this).off("layerremove",this._redraw,this)},_chkWidth:function(t){if("window"!==this.options.type){var e=this._map._size.x-t.locationSize-25;this._container.style.width=(e>0?e:0)+"px"}},setMapCopyright:function(t){this.options.mapCopyright=t||"",this._redraw()},_redrawItems:function(){var t='<a target="_blank"',e=[t+' href="http://maps.kosmosnimki.ru/Apikey/License.html">&copy; 2007-2015 '+"RDC ScanEx"+"</a> - Terms of Service"],i=this._map._layers,n=this._map._zoom,o=this._map.getBounds(),r=[],s={};this.options.mapCopyright&&e.push(this.options.mapCopyright);for(var a in i)i[a].options&&r.push(i[a].options);r=r.sort(function(t,e){return t.zIndex-e.zIndex}),r.forEach(function(i){var r=i.attribution;r&&!s[r]&&(s[r]=!0,e.push(r.split("<a").join(t))),i.gmxCopyright&&i.gmxCopyright.forEach(function(i){var r=i.attribution;s[r]||n<i.minZoom||n>i.maxZoom||(!i.bounds||(i.bounds instanceof L.LatLngBounds||(i.bounds=L.latLngBounds(i.bounds)),o.intersects(i.bounds)))&&(s[r]=!0,e.push(r.split("<a").join(t)))})}),e.push(t+' href="http://leafletjs.com">&copy; Leaflet</a>');var l=e.join(" ");this._currentText!==l&&(this._currentText=l,"window"===this.options.type?this._window.innerHTML=e.join("<br>"):this._copyrights.innerHTML=l)},_redraw:function(){var t=this;this._redrawTimer&&clearTimeout(this._redrawTimer),this._redrawTimer=setTimeout(function(){t._redrawTimer=null,t._map&&t._redrawItems()},100)}}),L.control.gmxCopyright=function(t){return new L.Control.gmxCopyright(t)}}(),L.Control.gmxZoom=L.Control.Zoom.extend({options:{position:"topleft",id:"zoom",zoomslider:!0},_stepY:7,_minY:9,_maxY:9,onAdd:function(t){var e="leaflet-gmx",i=L.DomUtil.create("div",e+"-zoomParent");this._container=i,i._id=this.options.id,i._isZoomControl=!0,this._map=t,this._zoomPlaque=L.DomUtil.create("div",e+"-zoomPlaque",i);var n="Zoom in",o="Zoom out";return L.gmxLocale&&(L.gmxLocale.addText({eng:{"Zoom in":"Zoom in","Zoom out":"Zoom out"},rus:{"Zoom in":"","Zoom out":""}}),n=L.gmxLocale.getText("Zoom in"),o=L.gmxLocale.getText("Zoom out")),this._zoomInButton=this._createDiv(i,e+"-zoomPlus "+e+"-icon-sprite",n,this._zoomIn,this),this._zoomOutButton=this._createDiv(i,e+"-zoomMinus "+e+"-icon-sprite",o,this._zoomOut,this),t.on("zoomend zoomlevelschange",this._updateDisabled,this),this.options.zoomslider&&this._chkZoomLevelsChange(i),t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),i},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this),L.Control.Zoom.prototype.onRemove.call(this,t)},_createDiv:function(t,e,i,n,o){var r=L.DomUtil.create("div",e,t);i&&(r.title=i);var s=L.DomEvent.stopPropagation;return L.DomEvent.on(r,"click",s).on(r,"mousedown",s).on(r,"dblclick",s).on(r,"click",L.DomEvent.preventDefault).on(r,"click",n||s,o),r},_setPosition:function(){if(this._zoomVal){var t=this._map.getMinZoom(),e=this._maxY-(this._zoom-t)*this._stepY;this._zoomVal.innerHTML=this._zoom,L.DomUtil.setPosition(this._zoomPointer,L.point(4,e))}},_getZoomByY:function(t){return t<this._minY?t=this._minY:t>this._maxY&&(t=this._maxY),Math.floor((this._maxY-t)/this._stepY)},_setSliderSize:function(){var t=this._map,e=this._stepY*(t.getMaxZoom()-t.getMinZoom()+1);this._maxY=e+3,this._zoomSliderBG.style.height=e+"px",e+=66,"block"!==this._zoomSliderCont.style.display&&(e=60),this._zoomPlaque.style.height=e+"px"},_chkZoomLevelsChange:function(t){var e=this,i=this._map,n="leaflet-gmx",o=i.getMinZoom(),r=i.getMaxZoom();if(o!==this._MinZoom||r!==this._MaxZoom){var s=r-o;if(100>r&&s>=0){if(!this._zoomSliderCont){this._zoomSliderCont=this._createDiv(t,n+"-sliderCont"),this._zoomSliderBG=this._createDiv(this._zoomSliderCont,n+"-sliderBG"),L.DomEvent.on(this._zoomSliderBG,"click",function(t){this._zoom=this._getZoomByY(t.layerY)+i.getMinZoom(),this._map.setZoom(this._zoom)},this),this._zoomPointer=this._createDiv(this._zoomSliderCont,n+"-zoomPointer "),this._zoomVal=this._createDiv(this._zoomPointer,n+"-zoomVal "+n+"-icon-sprite"),L.DomEvent.on(t,"mouseover",function(){this._zoomSliderCont.style.display="block",this._setSliderSize()},this);var a=function(){e._zoomSliderCont.style.display="none",e._setSliderSize()};L.DomEvent.on(t,"mouseout",function(){this._draggable._moving||a()},this);var l=new L.Draggable(this._zoomPointer);l.on("dragstart",function(){},this),l.on("drag",function(t){var e=t.target._newPos;this._zoom=this._getZoomByY(e.y)+i.getMinZoom(),this._setPosition()},this),l.on("dragend",function(){this._map.setZoom(this._zoom),a()},this),l.enable(),this._draggable=l}this._setSliderSize()}this._MinZoom=o,this._MaxZoom=r}this._zoom=i._zoom,this._setPosition()},_updateDisabled:function(t){L.Control.Zoom.prototype._updateDisabled.call(this,t),this._zoom=this._map._zoom,this.options.zoomslider&&("zoomlevelschange"===t.type&&this._chkZoomLevelsChange(this._container),this._setPosition())},setVisible:function(t){this._container&&(this._container.style.display=t?"block":"none")}}),L.control.gmxZoom=function(t){return new L.Control.gmxZoom(t)},L.Control.gmxBottom=L.Control.extend({options:{position:"bottom",notHide:!0,id:"bottom"},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this);var e=t._controlCorners;["bottomleft","bottomright","right","left"].map(function(t){e[t]&&L.DomUtil.removeClass(e[t],"gmx-bottom-shift")})},onAdd:function(t){var e="leaflet-gmx-copyright-location",i=L.DomUtil.create("div",e);this._container=i,i._id=this.options.id,this.options.notHide&&(i._notHide=!0),L.DomEvent.on(i,"mousemove",L.DomEvent.stopPropagation).on(this._map._controlContainer,"dblclick",L.DomEvent.stopPropagation),L.DomUtil.create("div",e+"-bg",i),t.fire("controladd",this);var n=t._controlCorners;return["bottomleft","bottomright","right","left"].map(function(t){n[t]&&L.DomUtil.addClass(n[t],"gmx-bottom-shift")}),t.gmxControlsManager&&t.gmxControlsManager.add(this),i}}),L.control.gmxBottom=function(t){return new L.Control.gmxBottom(t)},L.Control.gmxLogo=L.Control.extend({options:{position:"gmxbottomcenter",notHide:!0,id:"logo"},onAdd:function(t){var e=L.DomUtil.create("a","");this._container=e,this.options.notHide&&(e._notHide=!0),e.id=this.options.id,e.setAttribute("href","http://geomixer.ru"),e.setAttribute("target","_blank"),this._logoPrefix="leaflet-gmx-logo"+(this.options.type?"-"+this.options.type:"");var i=this._logoPrefix+"-shift";return this._shift=!1,this._updatePosition=function(t){if(e.parentNode){var n=(e.clientWidth-e.parentNode.clientWidth)/2+t.locationSize>0?!0:!1;this._shift!==n&&(this._shift=n,n?L.DomUtil.addClass(e,i):L.DomUtil.removeClass(e,i))}},t.fire("controladd",this),t.gmxControlsManager&&t.gmxControlsManager.add(this),e},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this),t.off("onChangeLocationSize",this._updatePosition,this)},addTo:function(t){return L.Control.prototype.addTo.call(this,t),L.DomUtil.addClass(this._container,this._logoPrefix),t.on("onChangeLocationSize",this._updatePosition,this),this}}),L.control.gmxLogo=function(t){return new L.Control.gmxLogo(t)},L.Map.addInitHook(function(){this._controlCorners.bottom||(this._controlCorners.bottom=L.DomUtil.create("div","leaflet-bottom leaflet-left leaflet-right",this._controlContainer))}),L.Control.gmxSidebar=L.Control.extend({options:{id:"defaultSidebar",position:"right"},onAdd:function(t){var e=document.createElement("div");return this._container=e,e._id=this.options.id,e.className="leaflet-gmx-sidebar","number"==typeof this.options.width&&e.setAttribute("style","width: "+this.options.width+"px"),"string"==typeof this.options.className&&L.DomUtil.addClass(e,this.options.className),L.DomEvent.on(e,"mousemove",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation),t.gmxControlsManager&&t.gmxControlsManager.add(this),e},onRemove:function(t){t.gmxControlsManager&&t.gmxControlsManager.remove(this),t.fire("controlremove",this)},expand:function(){L.DomUtil.addClass(this._container,"leaflet-gmx-sidebar_expanded")},collapse:function(){L.DomUtil.removeClass(this._container,"leaflet-gmx-sidebar_expanded")},isExpanded:function(){return L.DomUtil.hasClass(this._container,"leaflet-gmx-sidebar_expanded")},getContentContainer:function(){return this.getContainer()},setWidth:function(t){"number"==typeof t&&this._container.setAttribute("style","width: "+t+"px")}}),L.control.gmxSidebar=function(t){return new L.Control.gmxSidebar(t)},+function(){var t=function(t){return t.extend({options:{tilesCRS:L.CRS.EPSG3395},_update:function(){if(this._map){var t=this._map,e=t.getZoom();if(!(e>this.options.maxZoom||e<this.options.minZoom)){var i=t.getPixelBounds();this._shiftY=this._getShiftY(),i.min.y+=this._shiftY,i.max.y+=this._shiftY;var n=this._getTileSize(),o=L.bounds(i.min._divideBy(n)._floor(),i.max._divideBy(n)._floor());this._addTilesFromCenterOut(o),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(o)}}},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();n._pos={x:i.x,y:i.y},this._setShiftPosition(n),n._tilePoint=t,this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getShiftY:function(){var t=this._map,e=L.CRS.scale(t.getZoom()),i=t.getCenter(),n=t.options.crs.project(i).y-this.options.tilesCRS.project(i).y;return Math.floor(e*n/40075016.685578495)},_setShiftPosition:function(t){var e={x:t._pos.x,y:t._pos.y-this._shiftY};L.DomUtil.setPosition(t,e,L.Browser.chrome)},_updateShiftY:function(){this._shiftY=this._getShiftY();for(var t in this._tiles)this._setShiftPosition(this._tiles[t])},onAdd:function(e){t.prototype.onAdd.call(this,e),e.on("moveend",this._updateShiftY,this),this.options.clickable===!1&&(this._container.style.pointerEvents="none")},onRemove:function(e){e.off("moveend",this._updateShiftY,this),t.prototype.onRemove.call(this,e)}})};L.TileLayer.Mercator=t(L.TileLayer),L.TileLayer.Canvas.Mercator=t(L.TileLayer.Canvas),L.tileLayer.Mercator=function(t,e){return new L.TileLayer.Mercator(t,e)}}();var k=L.Class.extend({includes:L.Mixin.Events,options:{stateVersion:"1.0.0"},initialize:function(t){this._map=t,this._baseLayers={},this._alias={},this._currentID=null,this._activeIDs=[],this._zIndexOffset=-1e6;var e=this;this._baseLayer=L.LayerGroup.extend({getLayerId:function(t){return"_"+L.stamp(t)},setOptions:function(t,i){i&&(this.options={}),L.setOptions(this,t),e.fire("baselayeroptionschange",{baseLayer:this})},addLayer:function(t){L.LayerGroup.prototype.addLayer.call(this,t);var i=t.options;return i._zIndexOffset||(i._zIndexOffset=e._zIndexOffset,t.setZIndex(i._zIndexOffset+(i.zIndex||0))),e.fire("baselayerlayerschange",{baseLayer:this}),!0},removeLayer:function(t){L.LayerGroup.prototype.removeLayer.call(this,t);var i=t.options;i._zIndexOffset&&(t.setZIndex(t.options.zIndex-i._zIndexOffset),i._zIndexOffset=0),e.fire("baselayerlayerschange",{baseLayer:this})}})},add:function(t,e){if(!t||this._baseLayers[t])return null;e=e||{};var i=new this._baseLayer(e.layers||[]);return delete e.layers,i.id=t||"default",i.options=e,this._baseLayers[t]=i,this.fire("baselayeradd",{baseLayer:i}),i},remove:function(t){var e=this._baseLayers[t]||null;return t===this._currentID&&(this._currentID=null),e&&(this._map.removeLayer(e),delete this._baseLayers[t],this.fire("baselayerremove",{baseLayer:e})),e},get:function(t){return this._baseLayers[t]||null},getAll:function(){var t=[];for(var e in this._baseLayers)t.push(this._baseLayers[e]);return t},getActiveIDs:function(){return this._activeIDs},setActiveIDs:function(t){return this._activeIDs=t||[],this.fire("baselayeractiveids",{activeIDs:this._activeIDs}),this},addActiveID:function(t,e){if(!t)return null;for(var i=this._activeIDs.length,n=0;i>n;n++)if(t===this._activeIDs[n]){this._activeIDs.splice(n,1);break}return i=this._activeIDs.length,void 0===e||e>i-1?(e=i,this._activeIDs.push(t)):this._activeIDs.splice(e,0,t),this.fire("baselayeractiveids",{activeIDs:this._activeIDs}),e},isActiveID:function(t){for(var e=0,i=this._activeIDs.length;i>e;e++)if(t===this._activeIDs[e])return!0;return!1},setCurrentID:function(t){this._currentID&&(this._map.removeLayer(this._baseLayers[this._currentID]),this._currentID=null);var e=this._baseLayers[t]||null;return e&&this.isActiveID(t)&&(this._currentID=t,this._map.addLayer(e)),this.fire("baselayerchange",{baseLayer:e}),e},getCurrentID:function(){return this._currentID},loadState:function(t){return t=t||{},t.activeIDs&&this.setActiveIDs(t.activeIDs),this.setCurrentID(t.currentID),this},saveState:function(){return{version:this.options.stateVersion,currentID:this._currentID||"",activeIDs:this._activeIDs||[]}}});L.gmxBaseLayersManager=k,L.Map.addInitHook(function(){this._gmxBaseLayersManager||(this.gmxBaseLayersManager=new k(this))}),k.prototype.initDefaults=function(t){var e=this,i=2e6,n=t&&t.mapID?t.mapID:"1D30C72D02914C5FB90D1D448159CAB6",o=L.gmxLocale.getLanguage(),r=function(t){return L.gmxLocale.getText(t)||t},s={collinsbartholomew:'&copy; <a href="http://www.collinsbartholomew.com/">Collins Bartholomew Ltd.</a>',geocenter:'&copy; <a href="http://www.geocenter-consulting.ru/">'+r(" -","Geocentre-Consulting")+"</a>",openStreetMap:"&copy; "+r(' OpenStreetMap <a href="http://www.openstreetmap.org/copyright">ODbL</a>','OpenStreetMap contributers <a href="http://opendatacommons.org/licenses/odbl/">ODbL</a>'),cgiar:'&copy; <a href="http://srtm.csi.cgiar.org/">CGIAR-CSI</a>',"2gis":'&copy; <a href="http://help.2gis.ru/api-rules/#kart">'+r(" ","2GIS")+"</a>",naturalearthdata:'&copy; <a href="http://www.naturalearthdata.com/">Natural Earth</a>',nasa:'&copy; <a href="http://www.nasa.gov">NASA</a>',earthstar:'&copy; <a href="http://www.es-geo.com">Earthstar Geographics</a>',antrix:'&copy; <a href="http://www.antrix.gov.in/">ANTRIX</a>',geoeye:'&copy; <a href="http://www.geoeye.com">GeoEye Inc.</a>'},a=function(){return[{minZoom:1,maxZoom:7,attribution:s.collinsbartholomew+", "+r("2014","2012")},{minZoom:1,maxZoom:7,attribution:s.naturalearthdata+", 2013"},{minZoom:8,maxZoom:17,attribution:s.openStreetMap}]},l=function(t){return"http://{s}.tile.cart.kosmosnimki.ru/"+t+"/{z}/{x}/{y}.png"},h="http://maps.kosmosnimki.ru/api/img/baseLayers/",u={OSM:{icon:h+"basemap_osm_"+("rus"===o?"ru":"eng")+".png",layers:[L.tileLayer("http://{s}.tile.osm.kosmosnimki.ru/kosmo"+("rus"===o?"":"-en")+"/{z}/{x}/{y}.png",{maxZoom:18,gmxCopyright:a()})]},"2GIS":{layers:[L.tileLayer("http://tile2.maps.2gis.com/tiles?x={x}&y={y}&z={z}&v=4",{maxZoom:18,attribution:s["2gis"]})]},relief:{rus:"",eng:"Relief",icon:h+"basemap_terrain.png",layers:[L.tileLayer.Mercator(l("r"),{maxZoom:18,maxNativeZoom:13,gmxCopyright:[{minZoom:1,maxZoom:17,attribution:s.collinsbartholomew+r(", 2014",", 2012")},{minZoom:1,maxZoom:17,attribution:s.geocenter+", 2014"},{minZoom:1,maxZoom:17,attribution:s.cgiar+", 2008"}]})]},outline:{rus:"",eng:"Outline",icon:h+"basemap_contour.png",layers:[L.tileLayer.Mercator(l("mo"),{maxZoom:18,maxNativeZoom:13,gmxCopyright:[{minZoom:1,maxZoom:9,attribution:s.collinsbartholomew+r(", 2014",", 2012")},{minZoom:1,maxZoom:17,attribution:s.geocenter+", 2014"}]})]},grey:{rus:"",eng:"Grey",icon:h+"basemap_grey.png",layers:[L.tileLayer.Mercator(l("mg"),{maxZoom:18,maxNativeZoom:13,gmxCopyright:[{minZoom:1,maxZoom:9,attribution:s.collinsbartholomew+r(", 2014",", 2012")},{minZoom:1,maxZoom:17,attribution:s.geocenter+", 2014"}]})]},osm_spring:{rus:"OSM ",eng:"OSM Spring",icon:h+"basemap_osm_spring.png",layers:[L.tileLayer(l("spring"),{maxZoom:18,gmxCopyright:a()})]},osm_summer:{rus:"OSM ",eng:"OSM Summer",icon:h+"basemap_osm_summer.png",layers:[L.tileLayer(l("summer"),{maxZoom:18,gmxCopyright:a()})]},osm_autumn:{rus:"OSM ",eng:"OSM Autumn",icon:h+"basemap_osm_autumn.png",layers:[L.tileLayer(l("autumn"),{maxZoom:18,gmxCopyright:a()})]},osm_winter:{rus:"OSM ",eng:"OSM Winter",icon:h+"basemap_osm_winter.png",layers:[L.tileLayer(l("winter"),{maxZoom:18,gmxCopyright:a()})]},osm_night:{rus:"OSM ",eng:"OSM Night",icon:h+"basemap_night.png",layers:[L.tileLayer(l("night"),{maxZoom:18,gmxCopyright:a()})]}};u.OSMHybrid={rus:"OSM ",eng:"OSM Hybrid",overlayColor:"#ffffff",icon:"http://maps.kosmosnimki.ru/api/img/baseLayers/basemap_osm_hybrid.png",layers:[L.tileLayer(l("kosmohyb"),{maxZoom:18,gmxCopyright:a()})]},u.OSMHybrid.layers[0].setZIndex(i);var c=[{mapID:n,layerID:"C9458F2DCB754CEEACC54216C7D1EB0A",type:"satellite",rus:"",eng:"Satellite",overlayColor:"#ffffff",icon:h+"basemap_satellite.png"}];"rus"===o?u.map={rus:"",eng:"Map",icon:h+"basemap_rumap.png",layers:[L.tileLayer.Mercator(l("m"),{maxZoom:19,maxNativeZoom:17,gmxCopyright:[{minZoom:1,maxZoom:9,attribution:s.collinsbartholomew+r(", 2014",", 2012")},{minZoom:1,maxZoom:17,attribution:s.geocenter+", 2014",bounds:[[40,29],[80,180]]}]})]}:(c.push({mapID:n,layerID:"5269E524341E4E7DB9D447C968B20A2C",type:"map",rus:"",eng:"Map",icon:h+"basemap_rumap.png"}),c.push({mapID:n,layerID:"BCCCE2BDC9BF417DACF27BB4D481FAD9",type:"hybrid",rus:"",eng:"Hybrid"}));var d=new L.gmx.Deferred;return t=t||{},L.gmx.loadLayers(c,t).then(function(){var t,n,r={},s=null;for(t=0,n=arguments.length;n>t;t++){var a=arguments[t],p=a._gmx,m=p.mapName,f=p.layerID;m in r||(r[m]={}),r[m][f]=a}for(t=0,n=c.length;n>t;t++){var g=c[t],_=g.type;if("hybrid"!==_){if("satellite"===_){var v=r[g.mapID][g.layerID];"rus"===o?s=L.tileLayer.Mercator(l("o"),{maxZoom:19,maxNativeZoom:17,clickable:!1}):(s=r[g.mapID].BCCCE2BDC9BF417DACF27BB4D481FAD9,s.options.clickable=!1),u.hybrid={rus:"",eng:"Hybrid",overlayColor:"#ffffff",icon:h+"basemap_hybrid.png",layers:[v,s]},u.hybrid.layers[1].setZIndex(i),u.OSMHybrid.layers.unshift(v)}u[_]={rus:g.rus,eng:g.eng,icon:g.icon,overlayColor:g.overlayColor||"#00",layers:[r[g.mapID][g.layerID]]}}}for(var y in u){var x=u[y];x.rus||(x.rus=y),x.eng||(x.eng=y),e.add(y,x)}d.resolve()}),d},function(){function t(e,i){var n={};for(var o in e)if("icon"!==o&&"map"!==o)if("iconAnchor"===o||"iconSize"===o||"popupAnchor"===o||"shadowSize"===o){if(!i[o])continue;(i[o][0]!==e[o][0]||i[o][1]!==e[o][1])&&(n[o]=e[o])}else"lineStyle"===o||"pointStyle"===o?n[o]=t(e[o],i[o]):i&&i[o]===e[o]&&"fill"!==o||(n[o]=e[o]);return n}var e=function(t){var e=L.gmxLocale?L.gmxLocale.getText(t):null;return e||t},i=null,n=1e-7,o="1.0.0",r={mode:"",map:!0,editable:!0,lineStyle:{opacity:1,weight:2,noClip:!0,clickable:!1,className:"leaflet-drawing-lines",color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,fill:!1,fillColor:null,fillOpacity:.2,smoothFactor:1,stroke:!0},pointStyle:{className:"leaflet-drawing-points",noClip:!0,smoothFactor:0,opacity:1,shape:"circle",fill:!0,fillColor:"#ffffff",fillOpacity:1,size:L.Browser.mobile?40:8,weight:2,clickable:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,stroke:!0},markerStyle:{mode:"",editable:!1,options:{alt:"",title:"",clickable:!0,draggable:!1,keyboard:!0,opacity:1,zIndexOffset:0,riseOffset:250,riseOnHover:!1,icon:{className:"",iconUrl:"",iconAnchor:[12,41],iconSize:[25,41],popupAnchor:[1,-34],shadowSize:[41,41]}}}};L.GmxDrawing=L.Class.extend({options:{type:""},includes:L.Mixin.Events,initialize:function(t){if(this._map=t,this.items=[],this.current=null,L.gmxUtil&&L.gmxUtil.prettifyDistance){var e=document.createElementNS(L.Path.SVG_NS,"g");L.DomUtil.addClass(e,"gmxTooltip");var i=document.createElementNS(L.Path.SVG_NS,"rect");i.setAttributeNS(null,"rx",4),i.setAttributeNS(null,"ry",4),i.setAttributeNS(null,"height",16),L.DomUtil.addClass(i,"gmxTooltipBG");var n=document.createElementNS(L.Path.SVG_NS,"text"),o=L.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);n.style[o]="none",e.appendChild(i),e.appendChild(n),this.hideTooltip=function(){e.setAttributeNS(null,"visibility","hidden")},this.showTooltip=function(t,o){var r=t.x+11,s=t.y-14;n.setAttributeNS(null,"x",r),n.setAttributeNS(null,"y",s),n.textContent=o,"visible"!==e.getAttributeNS(null,"visibility")&&(this._map._pathRoot.appendChild(e),e.setAttributeNS(null,"visibility","visible"));var a=n.getComputedTextLength();i.setAttributeNS(null,"width",a+8),i.setAttributeNS(null,"x",r-4),i.setAttributeNS(null,"y",s-12)}}},bringToFront:function(){for(var t=0,e=this.items.length;e>t;t++){var i=this.items[t];i._map&&"bringToFront"in i&&i.bringToFront()}},addGeoJSON:function(t,e){var i=[],n=t instanceof L.GeoJSON;if(n||(t=L.geoJson(t,e)),t instanceof L.GeoJSON){var o=t.getLayers();if(o)for(var r=0,s=o.length;s>r;r++)i.push(this.add(o[r],e))}return i},add:function(t,e){var i=null;return t instanceof L.GmxDrawing.Feature?i=t:(e=e||{},"editable"in e||(e.editable=!0),t instanceof L.Rectangle?e.type="Rectangle":t instanceof L.Polygon?e.type="Polygon":t instanceof L.MultiPolygon?(e.type="MultiPolygon",e.editable=!1):t instanceof L.Polyline?e.type="Polyline":t instanceof L.MultiPolyline?(e.type="MultiPolyline",e.editable=!1):t instanceof L.Marker&&(e.type="Point",e.editable=!1),i=new L.GmxDrawing.Feature(this,t,e)),"map"in e||(e.map=!0),e.map&&!i._map?this._map.addLayer(i):this._addItem(i),"setEditMode"in i&&i.setEditMode(),i},_disableDrag:function(){this._map.dragging.disable(),L.DomUtil.disableTextSelection(),L.DomUtil.disableImageDrag(),this._map.doubleClickZoom.removeHooks()},_enableDrag:function(){this._map.dragging.enable(),L.DomUtil.enableTextSelection(),L.DomUtil.enableImageDrag(),this._map.doubleClickZoom.addHooks()},_clearCreate:function(){this._createKey&&("Rectangle"===this._createKey.type&&L.Browser.mobile?L.DomEvent.off(this._map._container,"touchstart",this._createKey.fn,this):this._map.off(this._createKey.eventName,this._createKey.fn,this),this._enableDrag()),this._createKey=null},create:function(t,e){if(this._clearCreate(null),t){"Rectangle"===t&&(this._map._initPathRoot(),this._map.dragging.disable());var i,o=this;e=e||{},e.iconUrl&&(i={iconUrl:e.iconUrl},delete e.iconUrl,e.iconAnchor&&(i.iconAnchor=e.iconAnchor,delete e.iconAnchor),e.iconSize&&(i.iconSize=e.iconSize,delete e.iconSize),e.popupAnchor&&(i.popupAnchor=e.popupAnchor,delete e.popupAnchor),e.shadowSize&&(i.shadowSize=e.shadowSize,delete e.shadowSize),e.markerStyle={iconStyle:i}),this._createKey={type:t,eventName:"Rectangle"===t?L.Browser.mobile?"touchstart":"mousedown":"click",fn:function(i){var s,a,l={},h=i.latlng;for(a in e)a in r||(l[a]=e[a]);if("Point"===t){var u=e.markerStyle||{},c={draggable:!0};i&&i.originalEvent&&(c.ctrlKey=i.originalEvent.ctrlKey,c.shiftKey=i.originalEvent.shiftKey,c.altKey=i.originalEvent.altKey),u.iconStyle&&(c.icon=L.icon(u.iconStyle)),s=o.add(L.marker(h,c),l)}else if(e.pointStyle&&(l.pointStyle=e.pointStyle),e.lineStyle&&(l.lineStyle=e.lineStyle),"Rectangle"===t){if(L.Browser.mobile){var d=L.GmxDrawing.utils.getDownType.call(o,i,o._map);h=d.latlng}l.mode="edit",s=o.add(L.rectangle(L.latLngBounds(L.latLng(h.lat+n,h.lng-n),h)),l),L.Browser.mobile?s._startTouchMove(i,!0):s._pointDown(i),s._drawstop=!0}else"Polygon"===t?(l.mode="add",s=o.add(L.polygon([h]),l).setAddMode()):"Polyline"===t&&(l.mode="add",s=o.add(L.polyline([h]),l).setAddMode());o._clearCreate()}},"Rectangle"===t&&L.Browser.mobile?L.DomEvent.on(o._map._container,"touchstart",this._createKey.fn,this):this._map.on(this._createKey.eventName,this._createKey.fn,this),L.DomUtil.addClass(o._map._mapPane,"leaflet-clickable"),this.fire("drawstart",{mode:t})}this.options.type=t},getFeatures:function(){for(var t=[],e=0,i=this.items.length;i>e;e++)t.push(this.items[e]);return t},loadState:function(t){var e=this,i=t.featureCollection;L.geoJson(i,{onEachFeature:function(t,i){var n=t.properties;if("Rectangle"===n.type)i=L.rectangle(i.getBounds());else if("Point"===n.type){n=n.options;var o=n.icon;o&&(delete n.icon,o.iconUrl&&(n.icon=L.icon(o))),i=L.marker(i.getLatLng(),n)}e.add(i,n)}})},saveState:function(){for(var e=L.featureGroup(),i=[],n=0,s=this.items.length;s>n;n++){var a=this.items[n];if("Point"===a.options.type){var l=a.toGeoJSON();l.properties=t(a.options,r.markerStyle),a._map||(l.properties.map=!1);var h=t(a._obj.options,r.markerStyle.options);Object.keys(h).length&&(l.properties.options=h),h=t(a._obj.options.icon.options,r.markerStyle.options.icon),Object.keys(h).length&&(l.properties.options||(l.properties.options={}),l.properties.options.icon=h),i.push(l)}else e.addLayer(a)}var u=e.toGeoJSON();return u.features=u.features.concat(i),{version:o,featureCollection:u}},_addItem:function(t){for(var e=!0,i=0,n=this.items.length;n>i;i++){var o=this.items[i];if(o===t){e=!1;break}}e&&this.items.push(t),this.fire("add",{mode:t.mode,object:t})},_removeItem:function(t,e){for(var i=0,n=this.items.length;n>i;i++){var o=this.items[i];if(o===t){if(e){this.items.splice(i,1);var r={type:o.options.type,mode:o.mode,object:o};this.fire("remove",r),o.fire("remove",r)}return o}}return null},clear:function(){for(var t=0,e=this.items.length;e>t;t++){var i=this.items[t];i&&i._map&&i._map.removeLayer(i);var n={type:i.options.type,mode:i.mode,object:i};this.fire("remove",n),i.fire("remove",n)}return this.items=[],this},remove:function(t){var e=this._removeItem(t,!0);return e&&e._map&&e._map.removeLayer(e),e}}),L.Map.addInitHook(function(){this.gmxDrawing=new L.GmxDrawing(this)}),L.GmxDrawing.Feature=L.LayerGroup.extend({options:{mode:""},includes:L.Mixin.Events,bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},onAdd:function(t){if(L.LayerGroup.prototype.onAdd.call(this,t),this._parent._addItem(this),"Point"===this.options.type){t.addLayer(this._obj);var e=this;setTimeout(function(){e._fireEvent("drawstop",e._obj.options)},0)}this._fireEvent("addtomap"),this.setEditMode()},onRemove:function(t){this.points&&(this._pointUp(),this.removeAddMode(),this.removeEditMode(),"hideTooltip"in this&&this.hideTooltip()),L.LayerGroup.prototype.onRemove.call(this,t),"Point"===this.options.type&&t.removeLayer(this._obj),this._fireEvent("removefrommap")},remove:function(){return this._parent.remove(this),this},setOptions:function(t){L.setOptions(this,t),t.lineStyle&&this._setLinesStyle(t.lineStyle),t.pointStyle&&this._setPointsStyle(t.pointStyle),"editable"in t&&(t.editable?this.enableEdit():this.disableEdit()),this._fireEvent("optionschange")},_setLinesStyle:function(t){this.lines&&(this.lines.setStyle(t),this.lines.redraw(),this._fireEvent("stylechange"))},_setPointsStyle:function(t){this.points&&(this.points.setStyle(t),this.points.redraw(),this._fireEvent("stylechange"))},getOptions:function(){var e=L.extend({},this.options);e.lineStyle=this.options.lineStyle,e.pointStyle=this.options.pointStyle;var i=t(e,r);return Object.keys(i.lineStyle).length||delete i.lineStyle,Object.keys(i.pointStyle).length||delete i.pointStyle,this._map||(i.map=!1),i},toGeoJSON:function(){var t,e=this.options.type;if(this.points)t=L.GeoJSON.latLngsToCoords(this.points.getLatLngs()),("Polygon"===e||"Rectangle"===e)&&(t=[t]);else{var i=this._obj.toGeoJSON();t=i.geometry.coordinates}"Rectangle"===e?e="Polygon":"Polyline"===e?e="LineString":"MultiPolyline"===e&&(e="MultiLineString");var n=this.getOptions();return delete n.mode,L.GeoJSON.getFeature({feature:{type:"Feature",properties:n}},{type:e,coordinates:t})},getType:function(){return this.options.type},getLatLngs:function(){var t=this.points||this._obj;return"getLatLngs"in t?t.getLatLngs():null},getLatLng:function(){var t=this.points||this._obj;return"getLatLng"in t?t.getLatLng():null},setLatLngs:function(t){this.points?(this.fill.setLatLngs(t),this.lines.setLatLngs(t),"Polyline"!==this.options.type&&"edit"===this.mode&&t.length>2&&(this.lines.addLatLng(t[0]),this.fill.addLatLng(t[0])),this.points.setLatLngs(t)):"setLatLngs"in this._obj&&this._obj.setLatLngs(t),this._fireEvent("edit")},addLatLng:function(t){this.points?this._setPoint(t,this.points._latlngs.length,"node"):"addLatLng"in this._obj&&this._obj.addLatLng(t)},getBounds:function(){var t=null;if("Point"===this.options.type){var e=this.getLatLng();t=L.latLngBounds([e.lat,e.lng],[e.lat,e.lng])}else t=(this.lines||this._obj).getBounds();return t},initialize:function(t,e,i){i=i||{},i.mode="",L.setOptions(this,i),this._layers={},this._obj=e,this._parent=t,this._initialize(t,e)},enableEdit:function(){this.options.mode="edit";var t=this.options.type;return"Point"!==t&&-1===t.indexOf("Multi")&&(this.options.editable=!0,this._initialize(this._parent,this._obj)),this.setEditMode(),this},disableEdit:function(){var t=this.options.type;return"Point"!==t&&-1===t.indexOf("Multi")&&(this.removeEditMode(),this.options.editable=!1,this._obj.setLatLngs(this.getLatLngs()),this._initialize(this._parent,this._obj)),this},_initialize:function(t,n){this.clearLayers(),delete this.lines,delete this.fill,delete this.points,this.mode="";var o={opacity:1,weight:2,noClip:!0,clickable:!1,className:"leaflet-drawing-lines"};if(("Polygon"===this.options.type||"Rectangle"===this.options.type)&&(o.fill="fill"in this.options?this.options.fill:!0),this.options.lineStyle)for(var r in this.options.lineStyle)("fill"!==r||"Polyline"!==this.options.type)&&(o[r]=this.options.lineStyle[r]);if("Point"!==this.options.type&&n.setStyle(o),this.options.editable){var s=n.getLatLngs(),a=this.options.mode||(s.length?"edit":"add");if(this.lines=new L.Polyline(s,o),this.addLayer(this.lines),this.fill=new L.GmxDrawing._Fill(s),this.addLayer(this.fill),"Polyline"!==this.options.type&&"edit"===a&&(this.lines.addLatLng(s[0]),this.fill.addLatLng(s[0])),this.mode=a,this.points=new L.GmxDrawing.PointMarkers(s,this.options.pointStyle||{}),this.points._parent=this,this.addLayer(this.points),L.gmxUtil&&L.gmxUtil.prettifyDistance){var l=this;this._showTooltip=function(t,n){if(!i||i===this){var o=l.points._latlngs,r=l._map.options||{},s=r.distanceUnit||"km",a=r.squareUnit||"ha",h="",u=[];if("Area"===t){if(!L.gmxUtil.getArea)return;n.originalEvent.ctrlKey?(u=o.slice(0,o.length),u.push(o[0]),h=e("Perimeter")+": "+L.gmxUtil.prettifyDistance(L.gmxUtil.getLength(u),s)):h=e(t)+": "+L.gmxUtil.prettifyArea(L.gmxUtil.getArea(o),a),l._parent.showTooltip(n.layerPoint,h)}else if("Length"===t){var c=L.GmxDrawing.utils.getDownType.call(l,n,l._map);"node"===c.type?u=o.slice(0,c.num+1):(u=o.slice(c.num-1,c.num+1),1===u.length&&u.push(o[0]));var d=L.gmxUtil.getLength(u);h=e(t)+": "+L.gmxUtil.prettifyDistance(d,s),l._parent.showTooltip(n.layerPoint,h)}l._fireEvent("onMouseOver")}},this.hideTooltip=function(){i&&i!==this||(this._parent.hideTooltip(),this._fireEvent("onMouseOut"))},this.points.on("mouseover mousemove",function(t){this._showTooltip("Polyline"===this.options.type?"Length":"Area",t)},this).on("mouseout",this.hideTooltip,this),this.fill.on("mouseover mousemove",function(t){this._showTooltip("Length",t)},this).on("mouseout",this.hideTooltip,this)}}else"Point"===this.options.type?this._setMarker(n):this.addLayer(n)},_setMarker:function(t){var e=this,i=this._parent;t.bindPopup(null,{maxWidth:1e3}).on("dblclick",function(){this._map.removeLayer(this),e.remove()}).on("dragstart",function(){e._fireEvent("dragstart")}).on("drag",function(){e._fireEvent("drag"),e._fireEvent("edit")}).on("dragend",function(){e._fireEvent("dragend")}).on("popupopen",function(e){var i=e.popup;i._input||(i._input=L.DomUtil.create("textarea","leaflet-gmx-popup-textarea",i._contentNode),i._input.placeholder=t.options.title||"",i._contentNode.style.width="auto"),L.DomEvent.on(i._input,"keyup",function(){var e=this.value.split("\n"),n=this.cols||0;
e.forEach(function(t){t.length>n&&(n=t.length)}),this.rows=e.length,n&&(this.cols=n),i.update(),t.options.title=this.value},i._input),i.update()}),i._map.addLayer(t)},_setPoint:function(t,e,i){if(this.points){var n=this.points._latlngs;"Rectangle"===this.options.type?"edge"===i?(e--,0===e?n[0].lng=n[1].lng=t.lng:1===e?n[1].lat=n[2].lat=t.lat:2===e?n[2].lng=n[3].lng=t.lng:3===e&&(n[0].lat=n[3].lat=t.lat)):(n[e]=t,0===e?(n[3].lat=t.lat,n[1].lng=t.lng):1===e?(n[2].lat=t.lat,n[0].lng=t.lng):2===e?(n[1].lat=t.lat,n[3].lng=t.lng):3===e&&(n[0].lat=t.lat,n[2].lng=t.lng)):n[e]=t,this.setLatLngs(n)}},_pointDown:function(t){if(t.originalEvent&&t.originalEvent.ctrlKey)return this._onDragStart(t),void 0;var e=L.GmxDrawing.utils.getDownType.call(this,t,this._map),n=e.num,o=e.type,r=this.points._latlngs,s=this.options,a=t.latlng;if(this.down=e,"edge"===o&&"Rectangle"!==s.type){if(s.disableAddPoints)return;r.splice(n,0,r[n]),this._setPoint(a,n,o)}i=this,this._map.on("mousemove",this._pointMove,this).on("mouseup",this._pointUp,this),this._parent._enableDrag()},_pointMove:function(t){this.down&&("Polyline"!==this.options.type&&this.lines.setStyle({fill:!0}),this._setPoint(t.latlng,this.down.num,this.down.type),this.skipClick=!0,"_showTooltip"in this&&this._showTooltip("Polyline"===this.options.type?"Length":"Area",t))},_pointUp:function(){if(this.points){i=null,this._map&&this._map.off("mousemove",this._pointMove,this).off("mouseup",this._pointUp,this),this._drawstop&&(this._fireEvent("drawstop"),this.skipClick=!1),this._drawstop=!1,this.down=null;var t=this.options.lineStyle||{};t.fill||"Polyline"===this.options.type||this.lines.setStyle({fill:!1})}},_lastPointClickTime:0,_removePoint:function(t){var e=this.points._latlngs;e.length>t&&(e.splice(t,1),"Rectangle"===this.options.type||e.length<2||e.length<3&&"Polygon"===this.options.type?this.remove():this._setPoint(e[0],0))},_pointClick:function(t){if(!t.originalEvent||!t.originalEvent.ctrlKey){var e=L.GmxDrawing.utils.getDownType.call(this,t,this._map),i=(new Date).getTime(),n=this._lastPointClickTime;if(this._lastPointClickTime=i+300,"node"===e.type&&!this.skipClick){var o=e.num;if(n>i)this.addLinePointTimer&&(clearTimeout(this.addLinePointTimer),this.addLinePointTimer=null),this._removePoint(o),this.setEditMode();else if("Polyline"===this.options.type&&e.end&&!this.addLinePointTimer){var r=this,s=e.latlng;this.addLinePointTimer=setTimeout(function(){clearTimeout(r.addLinePointTimer),r.addLinePointTimer=null,r._pointUp(),0===o&&r.points._latlngs.reverse(),L.Browser.mobile||r.points.addLatLng(s),r.setAddMode(),r._fireEvent("drawstop")},300)}}this.skipClick=!1}},_onDragEnd:function(){this._map.off("mouseup",this._onDragEnd,this).off("mousemove",this._onDrag,this),this._fireEvent("dragend")},_onDragStart:function(t){this._dragstartPoint=t.latlng,this._map.on("mouseup",this._onDragEnd,this).on("mousemove",this._onDrag,this),this._fireEvent("dragstart")},_onDrag:function(t){var e=this._dragstartPoint.lat-t.latlng.lat,i=this._dragstartPoint.lng-t.latlng.lng,n=this.points._latlngs;n.forEach(function(t){t.lat-=e,t.lng-=i}),this._dragstartPoint=t.latlng,this.setLatLngs(n),this._fireEvent("drag")},_fireEvent:function(t){var e={mode:this.mode||"",object:this};this.fire(t,e),this._parent.fire(t,e),"drawstop"===t&&L.DomUtil.removeClass(this._map._mapPane,"leaflet-clickable")},_startTouchMove:function(t,e){var i=L.GmxDrawing.utils.getDownType.call(this,t,this._map);if("node"===i.type){this._parent._disableDrag(),this.down=i;var n=this,o=function(t){i=L.GmxDrawing.utils.getDownType.call(n,t,n._map),1===t.touches.length&&n._pointMove(i)},r=function(){L.DomEvent.off(n._map._container,"touchmove",o,n).off(n._map._container,"touchend",r,n),n._parent._enableDrag(),n.skipClick=!1,e&&n._parent.fire("drawstop",{mode:n.options.type,object:n})};L.DomEvent.on(n._map._container,"touchmove",o,n).on(n._map._container,"touchend",r,n)}},_editHandlers:function(t){if(this.points){var e=L.DomEvent.stopPropagation;if(this.touchstart&&L.DomEvent.off(this.points._container,"touchstart",this.touchstart,this),this.touchstartFill&&L.DomEvent.off(this.fill._container,"touchstart",this.touchstartFill,this),this.touchstart=null,this.touchstartFill=null,t)if(this.points.on("dblclick click",e,this).on("click",this._pointClick,this),L.Browser.mobile){this._EditOpacity&&this._setPointsStyle({fillOpacity:this._EditOpacity});var i=this;this.touchstart=function(t){i._startTouchMove(t)},L.DomEvent.on(this.points._container,"touchstart",this.touchstart,this),this.touchstartFill=function(t){var e=L.GmxDrawing.utils.getDownType.call(i,t,i._map);if("edge"===e.type&&"Rectangle"!==i.options.type){var n=i.points._latlngs;n.splice(e.num,0,n[e.num]),i._setPoint(e.latlng,e.num,e.type)}},L.DomEvent.on(this.fill._container,"touchstart",this.touchstartFill,this)}else this.points.on("mousemove",e).on("mousedown",this._pointDown,this),this.fill.on("dblclick click",e,this).on("mousedown",this._pointDown,this),this._fireEvent("editmode");else this._pointUp(),this.points.off("dblclick click",e,this).off("click",this._pointClick,this),L.Browser.mobile||(this.points.off("mousemove",e).off("mousedown",this._pointDown,this),this.fill.off("dblclick click",e,this).off("mousedown",this._pointDown,this))}},_createHandlers:function(t){if(this.points){var e=L.DomEvent.stopPropagation,i=this.options.lineStyle||{};t?(this._parent._enableDrag(),L.Browser.mobile?(this._EditOpacity=this.points.options.fillOpacity,this._setPointsStyle({fillOpacity:.5}),this.points.redraw(),this._map.on("dblclick",e).on("click",this._mouseClick,this).on("mousemove",this._moseMove,this),this.points.on("dblclick click",e,this).on("click",this._mouseClick,this)):this._map.on("dblclick",e).on("mousedown",this._mousedown,this).on("mouseup",this._mouseup,this).on("mousemove",this._moseMove,this),this._fireEvent("addmode"),"Polyline"!==this.options.type&&this.lines.setStyle({fill:!0})):(L.Browser.mobile?this._map&&(this._map.off("dblclick",e).off("click",this._mouseClick,this).off("mousemove",this._moseMove,this),this.points.off("dblclick click",e,this).off("click",this._mouseClick,this)):this._map&&this._map.off("dblclick",e).off("mousedown",this._mousedown,this).off("mouseup",this._mouseup,this).off("mousemove",this._moseMove,this),i.fill||"Polyline"===this.options.type||this.lines.setStyle({fill:!1}))}},setEditMode:function(){return this.options.editable&&(this._editHandlers(!1),this._createHandlers(!1),this._editHandlers(!0),this.mode="edit"),this},setAddMode:function(){return this.options.editable&&(this._editHandlers(!1),this._createHandlers(!1),this._createHandlers(!0),this.mode="add"),this},removeAddMode:function(){this._createHandlers(!1),this.mode=""},removeEditMode:function(){this._editHandlers(!1),this.mode=""},_moseMove:function(t){if(this.points){var e=this.points._latlngs;1===e.length&&this._setPoint(t.latlng,1),this._setPoint(t.latlng,e.length-1)}},_mousedown:function(){this._lastTime=(new Date).getTime()+300},_mouseClick:function(t){var e=L.GmxDrawing.utils.getDownType.call(this,t,this._map),i=this.points._latlngs;if("node"===e.type&&e.end&&(0===e.num||(e.prev||L.Browser.mobile)&&e.num===i.length-1)){this.setEditMode(),L.Browser.mobile||i.pop();var n=i.length,o=this.options;return n>2||n>1&&"Polyline"===o.type?(this.skipClick=!0,0===e.num&&"Polyline"===o.type&&(o.type="Polygon"),this._setPoint(i[0],0)):this.remove(),this._fireEvent("drawstop"),void 0}this.addLatLng(t.latlng),this._parent._clearCreate()},_mouseup:function(t){(new Date).getTime()<this._lastTime&&"add"===this.mode&&this._mouseClick(t)}}),L.GmxDrawing._Fill=L.Polyline.extend({options:{className:"leaflet-drawing-lines-fill",opacity:0,noClip:!0,fill:!0,fillOpacity:0,size:10,weight:1},_getPathPartStr:function(t){for(var e,i=this.options.size/2,n=L.GmxDrawing.utils.getEquidistancePolygon(t,1.5*i),o=0,r=n.length,s="";r>o;o++)e=n[o],s+="M"+e[0][0]+" "+e[0][1]+"L"+e[1][0]+" "+e[1][1]+"L"+e[2][0]+" "+e[2][1]+"L"+e[3][0]+" "+e[3][1]+"L"+e[0][0]+" "+e[0][1];return s},_updatePath:function(){this._map&&(this._clipPoints(),L.Path.prototype._updatePath.call(this))}}),L.GmxDrawing.PointMarkers=L.Polygon.extend({options:{className:"leaflet-drawing-points",noClip:!0,smoothFactor:0,opacity:1,shape:"circle",fill:!0,fillColor:"#ffffff",fillOpacity:1,size:L.Browser.mobile?40:8,weight:2},_getPathPartStr:function(t){for(var e,i=L.Path.VML,n=this.options.size/2,o="add"!==this._parent.mode||L.Browser.mobile?0:1,r="circle"===this.options.shape?!0:!1,s=0,a=t.length-o,l="";a>s;s++)if(e=t[s],i&&e._round(),r)l+="M"+e.x+","+(e.y-n)+" A"+n+","+n+",0,1,1,"+(e.x-.1)+","+(e.y-n)+" ";else{var h=e.x,u=h-n,c=h+n,d=e.y,p=d-n,m=d+n;l+="M"+u+" "+p+"L"+c+" "+p+"L"+c+" "+m+"L"+u+" "+m+"L"+u+" "+p}return l},_onMouseClick:function(t){this._fireMouseEvent(t)},_updatePath:function(){this._map&&(this._path.setAttribute("fill-rule","inherit"),this._clipPoints(),L.Path.prototype._updatePath.call(this))}}),L.GmxDrawing.utils={getEquidistancePolygon:function(t,e){var i=[];if(t.length)for(var n=t[0],o=1,r=t.length;r>o;o++){var s=t[o],a=s.x-n.x,l=s.y-n.y,h=a*a+l*l;if(h>0){var u=e/Math.sqrt(h),c=s.x+u*a,d=s.y+u*l,p=s.x-a-u*a,m=s.y-l-u*l,f=d-s.y,g=s.x-c,_=m-n.y,v=n.x-p;i.push([[c+f,d+g],[c-f,d-g],[p+_,m+v],[p-_,m-v]])}n=s}return i},getDownType:function(t,e){var i=t.layerPoint,n=!1,o=t.latlng;if(t.originalEvent&&t.originalEvent.ctrlKey&&(n=!0),t.touches&&1===t.touches.length){var r=t.touches[0],s=e.mouseEventToContainerPoint(r);i=e.containerPointToLayerPoint(s),o=e.layerPointToLatLng(i)}var a={type:"",latlng:o,ctrlKey:n},l=this.points?this.points._parts[0]:[],h=l.length;if(0===h)return a;var u=(this.points.options.size||10)/2;u+=1+(this.points.options.weight||2);var c=new L.Bounds(L.point(i.x-u,i.y-u),L.point(i.x+u,i.y+u)),d=l[h-1];if(a={type:"node",latlng:o,ctrlKey:n,num:0,end:!0},c.contains(l[0]))return a;if(a.num=h-1,a.prev=h>1?c.contains(l[h-2]):!1,c.contains(d))return a;a={latlng:o};for(var p=0;h>p;p++){var m=l[p];if(c.contains(m))return{type:"node",num:p,end:0===p?!0:!1,ctrlKey:n,latlng:o};var f=L.LineUtil.pointToSegmentDistance(i,d,m);u>f&&(a={type:"edge",num:0===p?h:p,ctrlKey:n,latlng:o}),d=m}return a}}}()}();